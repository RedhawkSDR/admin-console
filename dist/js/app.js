/*!                                                                                           
  * This file is protected by Copyright. Please refer to the COPYRIGHT file                    
  * distributed with this source distribution.                                                 
  *                                                                                            
  * This file is part of REDHAWK redhawk-admin-console.                                              
  *                                                                                            
  * REDHAWK redhawk-admin-console is free software: you can redistribute it and/or modify it         
  * under the terms of the GNU Lesser General Public License as published by the               
  * Free Software Foundation, either version 3 of the License, or (at your                     
  * option) any later version.                                                                 
  *                                                                                            
  * REDHAWK redhawk-admin-console is distributed in the hope that it will be useful, but WITHOUT     
  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or                      
  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License               
  * for more details.                                                                          
  *                                                                                            
  * You should have received a copy of the GNU Lesser General Public License                   
  * along with this program.  If not, see http://www.gnu.org/licenses/.                        
  *                                                                                            
  * redhawk-admin-console - v2.1.0 - 2015-04-01          
  */
function dashOn(e,a,d){return e.setLineDash?(e.setLineDash([a,d]),!0):void 0!==e.mozDash?(e.mozDash=[a,d],!0):e.webkitLineDash&&0===e.webkitLineDash.length?(e.webkitLineDash=[a,d],!0):!1}function dashOff(e){e.setLineDash?e.setLineDash([]):e.mozDash?e.mozDash=null:e.webkitLineDash&&(e.webkitLineDash=[])}function getKeyCode(e){return e=window.event||e,e=e.charCode||e.keyCode}function setKeypressHandler(e){window.addEventListener?window.addEventListener("keypress",e,!1):window.attachEvent&&window.attachEvent("onkeypress",e)}angular.module("RedhawkConfig",[]).provider("RedhawkConfig",[function(){var getWSBasePath=function(){var new_uri,loc=window.location;return new_uri="https:"===loc.protocol?"wss:":"ws:",new_uri+="//"+loc.host};this.restPath="/redhawk/rest",this.wsPath="/redhawk/rest",this.websocketUrl=getWSBasePath()+this.wsPath,this.restUrl=this.restPath,this.setLocation=function(host,port,basePath){this.restUrl="http://"+host+(port?":"+port:"")+(basePath?"/"+basePath:"")+this.restPath,this.websocketUrl="ws://"+host+(port?":"+port:"")+(basePath?"/"+basePath:"")+this.wsPath};var provider=this;this.$get=function(){return{restPath:provider.restPath,websocketPath:provider.wsPath,websocketUrl:provider.websocketUrl,restUrl:provider.restUrl}}}]),angular.module("redhawkDirectives",["RecursionHelper","webSCAServices"]).factory("PropertyProcessorService",["RecursionHelper",function(RecursionHelper){return{compile:function(element){return RecursionHelper.compile(element,function(scope){scope.$watch("properties",function(){scope.form={},angular.forEach(scope.properties,function(prop){prop.canEdit=!1,"simple"==prop.scaType&&(prop.canEdit="readonly"!=prop.mode&&prop.kinds&&prop.kinds.indexOf("configure")>-1),prop.canEdit&&(scope.form[prop.id]=prop.value)})})})}}}]).directive("properties",function(PropertyProcessorService){return{restrict:"E",scope:{properties:"=info",compact:"=?",title:"=?",canEdit:"@?",configure:"&"},templateUrl:"components/redhawk/templates/properties.html",compile:PropertyProcessorService.compile,controller:function($scope){$scope.booleanSelectOptions=[{name:"True",value:!0},{name:"False",value:!1}],$scope.toggleEdit=function(){$scope.edit=!$scope.edit,1==$scope.edit&&angular.forEach($scope.properties,function(item){$scope.form[item.id]&&($scope.form[item.id]=item.value)})},$scope.submit=function(){$scope.edit=!1,$scope.configure({properties:$scope.form})}}}}).directive("property",function(PropertyProcessorService){return{restrict:"E",scope:{prop:"=info"},templateUrl:"components/redhawk/templates/property.html",compile:PropertyProcessorService.compile}}).directive("status",function(){return{restrict:"E",scope:{status:"=info"},templateUrl:"components/redhawk/templates/status.html"}}).directive("startStatus",function(){return{restrict:"E",scope:{isStarted:"=info"},template:'<span ng-if="isStarted" class="label label-success">Started</span><span ng-if="!isStarted" class="label label-danger">Stopped</span>'}}).directive("waveform",["RedhawkREST","RedhawkDomain",function(RedhawkREST,RedhawkDomain){return{restrict:"E",scope:{id:"=",domainId:"="},templateUrl:"components/redhawk/templates/waveform.html",link:function(scope){scope.$watchCollection("[id, domainId]",function(newValues){var id=newValues[0],domainId=newValues[1];id&&domainId&&(scope.waveform=RedhawkDomain.getDomain(domainId).getWaveform(id))}),scope.configure=function(properties){var data=[];angular.forEach(properties,function(value,key){data.push({id:key,value:value})}),scope.waveform.configure(data)},scope.messages=[]}}}]).directive("component",["RedhawkREST","RedhawkDomain",function(RedhawkREST,RedhawkDomain){return{restrict:"E",scope:{id:"=",waveformId:"=",domainId:"="},templateUrl:"components/redhawk/templates/component.html",link:function(scope){scope.$watchCollection("[id, domainId, waveformId]",function(newValues){var id=newValues[0],domainId=newValues[1],waveformId=newValues[2];id&&domainId&&waveformId&&(scope.component=RedhawkDomain.getDomain(domainId).getComponent(id,waveformId))}),scope.configure=function(properties){var data=[];angular.forEach(properties,function(value,key){data.push({id:key,value:value})}),scope.component.configure(data)}}}}]).directive("device",["RedhawkDomain",function(RedhawkDomain){return{restrict:"E",scope:{id:"=",managerId:"=",domainId:"="},templateUrl:"components/redhawk/templates/device.html",link:function(scope){scope.$watchCollection("[id, domainId, managerId]",function(newValues){var id=newValues[0],domainId=newValues[1],managerId=newValues[2];id&&domainId&&managerId&&(scope.device=RedhawkDomain.getDomain(domainId).getDevice(id,managerId))})}}}]),angular.module("ngAnimate",[]),angular.module("redhawk-notifications",["toaster"]).service("RedhawkNotificationService",["toaster",function(toastr){var self=this;self.msg=function(severity,message,subject){var title=subject||severity.toUpperCase();switch(console.log("["+severity.toUpperCase()+"] :: "+message),severity){case"error":toastr.pop("error",title,message);break;case"success":toastr.pop("success",title,message);break;case"info":default:toastr.pop("info",title,message)}},self.error=function(text,subject){self.msg("error",text,subject)},self.info=function(text,subject){self.msg("info",text,subject)},self.success=function(text,subject){self.msg("success",text,subject)}}]),angular.module("RedhawkREST",["ngResource","RedhawkConfig"]).service("RedhawkREST",["$resource","RedhawkConfig",function($resource,RedhawkConfig){this.sysinfo=$resource(RedhawkConfig.restUrl+"/sysinfo",{},{query:{method:"GET"}}),this.domain=$resource(RedhawkConfig.restUrl+"/domains",{},{queryLocation:{method:"GET",url:RedhawkConfig.restUrl+"/domains/:host\\:"},query:{method:"GET",url:RedhawkConfig.restUrl+"/domains"},add:{method:"POST"},info:{method:"GET",url:RedhawkConfig.restUrl+"/domains/:domainId"},configure:{method:"PUT",url:RedhawkConfig.restUrl+"/domains/:domainId/configure"},events:{method:"GET",url:RedhawkConfig.restUrl+"/domains/:domainId/eventChannels",isArray:!0}}),this.fileSystem=$resource(RedhawkConfig.restUrl+"/domains/:domainId/fs/:path",{},{query:{method:"GET"}}),this.deviceManager=$resource(RedhawkConfig.restUrl+"/domains/:domainId/deviceManagers/:id",{},{query:{method:"GET"}}),this.device=$resource(RedhawkConfig.restUrl+"/domains/:domainId/deviceManagers/:managerId/devices/:deviceId",{},{query:{method:"GET"}}),this.waveform=$resource(RedhawkConfig.restUrl+"/domains/:domainId/applications",{},{query:{method:"GET",url:RedhawkConfig.restUrl+"/domains/:domainId/applications/:id"},status:{method:"GET",url:RedhawkConfig.restUrl+"/domains/:domainId/applications"},launch:{method:"POST",url:RedhawkConfig.restUrl+"/domains/:domainId/applications"},release:{method:"DELETE",url:RedhawkConfig.restUrl+"/domains/:domainId/applications/:id"},update:{method:"POST",url:RedhawkConfig.restUrl+"/domains/:domainId/applications/:id"},configure:{method:"PUT",url:RedhawkConfig.restUrl+"/domains/:domainId/applications/:id/properties"}}),this.component=$resource(RedhawkConfig.restUrl+"/domains/:domainId/applications/:applicationId/components/:componentId",{},{query:{method:"GET"},configure:{method:"PUT",url:RedhawkConfig.restUrl+"/domains/:domainId/applications/:applicationId/components/:componentId/properties"}})}]),angular.module("redhawkServices",["webSCAConfig","SubscriptionSocketService","redhawk-notifications","RedhawkConfig","RedhawkREST"]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.transformResponse.unshift(function(response,headersGetter){var ctype=headersGetter("content-type");if(ctype&&ctype.indexOf("json")>-1){var reg=/:\s?(Infinity|-Infinity|NaN)\s?\,/g;return response.replace(reg,': "$1", ')}return response})}]).factory("RedhawkSysinfo",["RedhawkREST",function(RedhawkREST){return function(){return RedhawkREST.sysinfo.query().$promise}}]).factory("RedhawkDomain",["RedhawkREST","RedhawkSocket","RedhawkNotificationService","$q",function(RedhawkREST,RedhawkSocket,RedhawkNotificationService,$q){var notify=RedhawkNotificationService,redhawk={domainIds:null,__domains:{}};redhawk.getDomainIds=function(hosts,locationFlag){redhawk.domainIds=[];var promises=[];if(angular.forEach(hosts,function(host){var queryResult=locationFlag?RedhawkREST.domain.queryLocation({host:host}):RedhawkREST.domain.query();promises.push(queryResult.$promise.then(function(data){var domains=[];return angular.forEach(data.domains,function(item){this.push({domain:item,host:host})},domains),domains},function(error){var d={domain:void 0,host:host,error:error.data.message};return d.error||(d.error="An unknown "+error.status+" error."),d}))}),promises.length)return $q.all(promises).then(function(data){var merged=[];return merged=merged.concat.apply(merged,data)});var deferred=$q.defer();return deferred.resolve([]),deferred.promise},redhawk.getDomain=function(id){return redhawk.__domains[id]||(redhawk.__domains[id]=new Domain(id)),redhawk.__domains[id]},redhawk.addDomain=function(id,name,uri){var defer=$q.defer();return RedhawkREST.domain.add({id:id,name:name,uri:uri},function(){RedhawkREST.domain.query(function(data){angular.copy(data,redhawk.domainIds),defer.resolve(redhawk.domainIds)})}),defer.promise};var uniqueId=function(){return $.makeArray(arguments).join("::")},portDataTypeRegex=/^data(.*)$/,processPorts=function(ports){angular.forEach(ports,function(port){if("Uses"!=port.direction)return void(port.canPlot=!1);var idl=port.idl,matches=portDataTypeRegex.exec(idl.type);"BULKIO"==idl.namespace&&matches?(port.canPlot=!0,port.plotType=matches[1].toLowerCase()):(port.canPlot=!1,console.log("DEBUG: "+port.name+" port has unrecognized repid: "+port.repId))})},Domain=function(id){var self=this;self.getEvents=function(){return self.events},self._update=function(updateData){updateData&&(angular.extend(self,updateData),processPorts(self.ports))},self._load=function(id){self._restId=id,self.events=new EventChannel(id),self.devicemanagers={},self.waveforms={},self.components={},self.devices={},self.$promise=RedhawkREST.domain.info({domainId:self._restId},function(data){self._update(data)}).$promise},self._reload=function(){self._load(self._restId)},self.configure=function(properties){RedhawkREST.domain.configure({domainId:self._restId},{properties:properties})},self.getFileSystem=function(path){return RedhawkREST.fileSystem.query({domainId:self._restId,path:path})},self.getEventChannels=function(){return RedhawkREST.domain.events({domainId:self._restId})},self.getDevice=function(id,deviceManagerId){var devId=uniqueId(id,deviceManagerId);return self.devices[devId]||(self.devices[devId]=new Device(id,self._restId,deviceManagerId)),self.devices[devId]},self.getDeviceManager=function(id){return self.devicemanagers[id]||(self.devicemanagers[id]=new DeviceManager(id,self._restId)),self.devicemanagers[id]},self.getComponent=function(id,applicationId){var compId=uniqueId(id,applicationId);return self.components[compId]||(self.components[compId]=new Component(id,self._restId,applicationId)),self.components[compId]},self.getWaveform=function(id){return self.waveforms[id]||(self.waveforms[id]=new Waveform(id,self._restId)),self.waveforms[id]},self.getLaunchableWaveforms=function(){return redhawk.availableWaveforms||(redhawk.availableWaveforms=[],redhawk.availableWaveforms.$promise=RedhawkREST.waveform.status({domainId:self._restId}).$promise.then(function(data){return angular.forEach(data.waveforms,function(item){this.push(item.name)},redhawk.availableWaveforms),redhawk.availableWaveforms})),redhawk.availableWaveforms},self.launch=function(name){return RedhawkREST.waveform.launch({domainId:self._restId},{name:name},function(data){notify.success("Waveform "+data.launched+" launched"),self._reload()},function(){notify.error("Waveform "+name+" failed to launch.")})},self._load(id)},EventChannel=function(domainId){var self=this;self.messages=[],self.channels=[];var on_connect=function(){redhawk.getDomain(domainId).getEventChannels().$promise.then(function(channels){angular.forEach(channels,function(chan){-1==self.channels.indexOf(chan.id)&&(eventMessageSocket.addChannel(chan.id,domainId),self.channels.push(chan.id))})})},on_msg=function(json){self.messages.push(json),self.messages.length>500&&angular.copy(self.messages.slice(-500),self.messages)},eventMessageSocket=RedhawkSocket.eventChannel(on_msg,on_connect);eventMessageSocket.socket.addBinaryListener(function(){console.log("WARNING Event Channel Binary Data!")}),self.getMessages=function(){return self.messages},self.getChannelNames=function(){return self.channels}},Waveform=function(id,domainId){var self=this;self._update=function(updateData){updateData&&(angular.extend(self,updateData),processPorts(self.ports))},self._load=function(id,domainId){self.$promise=RedhawkREST.waveform.query({id:id,domainId:domainId},function(data){self._update(data),self.domainId=domainId}).$promise},self._reload=function(){self._load(self.id,self.domainId),self.$promise.then(function(wf){angular.forEach(wf.components,function(comp){var obj=redhawk.getDomain(self.domainId).getComponent(comp.id,self.id);obj.$promise.then(function(){obj._reload()})})})},self.start=function(){return RedhawkREST.waveform.update({id:self.id,domainId:domainId},{started:!0},function(){notify.success("Waveform "+self.name+" started."),self._reload()},function(){notify.error("Waveform "+self.name+" failed to start.")})},self.stop=function(){return RedhawkREST.waveform.update({id:self.id,domainId:domainId},{started:!1},function(){notify.success("Waveform "+self.name+" stopped."),self._reload()},function(){notify.error("Waveform "+self.name+" failed to stop.")})},self.release=function(){return RedhawkREST.waveform.release({id:self.id,domainId:self.domainId},{},function(){notify.success("Waveform "+self.name+" released."),redhawk.getDomain(self.domainId)._reload()},function(){notify.error("Waveform "+self.name+" failed to release.")})},self.configure=function(properties){return RedhawkREST.waveform.configure({id:self.id,domainId:self.domainId},{properties:properties})},self._load(id,domainId)},Component=function(id,domainId,applicationId){var self=this;self._update=function(updateData){updateData&&(angular.extend(this,updateData),processPorts(this.ports))},self._load=function(id,domainId,applicationId){self.$promise=RedhawkREST.component.query({componentId:id,applicationId:applicationId,domainId:domainId},function(data){self._update(data),self.waveform={id:applicationId},self.domainId=domainId}).$promise},self._reload=function(){self._load(self.id,self.domainId,self.waveform.id)},self.configure=function(properties){return RedhawkREST.component.configure({componentId:self.id,applicationId:self.waveform.id,domainId:self.domainId},{properties:properties},function(){self._reload()})},self._load(id,domainId,applicationId)},Device=function(id,domainId,managerId){var self=this;self._update=function(updateData){updateData&&angular.extend(this,updateData)},self._load=function(id,domainId,managerId){self.$promise=RedhawkREST.device.query({deviceId:id,managerId:managerId,domainId:domainId},function(data){self._update(data),self.deviceManager={id:managerId},self.domainId=domainId}).$promise},self._reload=function(){self._load(self.id,self.domainId,self.deviceManager.id)},self.configure=function(properties){return RedhawkREST.device.configure({deviceId:self.id,managerId:self.deviceManager.id,domainId:self.domainId},{properties:properties},function(){self._reload()})},self._load(id,domainId,managerId)},DeviceManager=function(id,domainId){var self=this;this._update=function(updateData){updateData&&angular.extend(self,updateData)},self._load=function(id,domainId){self.$promise=RedhawkREST.deviceManager.query({id:id,domainId:domainId},function(data){self._update(data),self.domainId=domainId}).$promise},self._reload=function(){self._load(self.id,self.domainId)},self.configure=function(properties){return RedhawkREST.component.configure({id:self.id,domainId:self.domainId},{properties:properties},function(){self._reload()})},self._load(id,domainId)},findPropertyByDCE=function(properties,propertyId){var res=void 0;return angular.forEach(properties,function(prop){prop.id==propertyId?res=prop:prop.structs&&(res=findPropertyByDCE(prop.structs,propertyId))}),res},updateProperty=function(properties,propertyId,newProp){var prop=findPropertyByDCE(properties,propertyId);prop&&(prop.name==newProp.name&&angular.extend(prop,newProp),angular.forEach(prop.simples,function(simple){simple.id==newProp.id&&angular.extend(simple,newProp)}))},updateProperties=function(path,newProperty){var nav=path.split("/"),domainId=nav[2],type=nav[3],typeId=nav[4],subType=nav[5],subTypeId=nav[6],domain=redhawk.__domains[domainId];if(domain){var propertyId=nav[nav.indexOf("properties")+1];0==propertyId&&(console.log("RedhawkDomain::updateProperties::WARNING - Cannot find propertiesId"),console.log(nav));var properties;if("properties"==type)properties=domain.properties;else if("waveforms"==type&&"properties"==subType){var waveform=domain.waveforms[typeId];waveform&&(properties=waveform.properties)}else if("waveforms"==type&&"components"==subType){var id=uniqueId(subTypeId,typeId),component=domain.components[id];component&&(properties=component.properties)}else if("deviceManagers"==type&&"properties"==subType){var deviceManager=domain.devicemanagers[typeId];deviceManager&&(properties=deviceManager.properties)}else if("deviceManagers"==type&&"devices"==subType){var id=uniqueId(subTypeId,typeId),device=domain.devices[id];device&&(properties=device.properties)}else console.log("RedhawkDomain::updateProperties - Unknown Properties Container - "+path);properties&&updateProperty(properties,propertyId,newProperty)}};return RedhawkSocket.status.addJSONListener(function(event){var element=event.ChangedElement,elementType=element.eobj_type,domain=redhawk.__domains[event.domain];if(!domain)return void(event.domain&&console.log("Skipping notification for other domain '"+event.domain+"'."));switch(elementType){case"ScaWaveformFactory":redhawk.domain&&domain._reload();break;case"ScaWaveform":var applicationId=event.waveformInstance;domain.waveforms[applicationId]&&domain.waveforms[applicationId]._update(element);break;case"ScaComponent":var compId=uniqueId(event.componentInstance,event.waveformInstance);domain.components[compId]&&domain.components[compId]._update(element);break;case"ScaSimpleProperty":var path=event.Notification.path;updateProperties(path,element)}}),redhawk}]).factory("RedhawkSocket",["SubscriptionSocket","RedhawkConfig",function(SubscriptionSocket,RedhawkConfig){var statusSocket=function(){var socket=SubscriptionSocket.createNew();return socket},RedhawkSocket={};RedhawkSocket.status=statusSocket(),RedhawkSocket.port=function(options,on_data,on_sri){var portSocket=SubscriptionSocket.createNew(),url=RedhawkConfig.websocketUrl;return options.domain&&(url+="/domains/"+options.domain),options.waveform&&(url+="/applications/"+options.waveform),options.component&&(url+="/components/"+options.component),options.port&&(url+="/ports/"+options.port),url+="/bulkio",on_data&&portSocket.addBinaryListener(on_data),on_sri&&portSocket.addJSONListener(on_sri),portSocket.connect(url,function(){console.log("Connected to Port "+options.port)}),portSocket};var EventChannelSocket=function(on_msg){var self=this;self.close=function(){console.log("Disconnected from Event Channel"),self.socket.close()};var Msg=function(command,topic,domainId){return{command:command,topic:topic,domainId:domainId}};self.addChannel=function(topic,domainId){console.log('Adding topic "'+topic+'".'),self.socket.send(JSON.stringify(new Msg("ADD",topic,domainId)))},self.removeChannel=function(topic,domainId){console.log('Removing topic "'+topic+'".'),self.socket.send(JSON.stringify(new Msg("REMOVE",topic,domainId)))},self.socket=SubscriptionSocket.createNew();RedhawkConfig.websocketUrl+"/msg";on_msg&&self.socket.addJSONListener(on_msg)};return RedhawkSocket.eventChannel=function(on_msg,on_connect){return new EventChannelSocket(on_msg,on_connect)},RedhawkSocket}]),angular.module("SubscriptionSocketService",[]).service("SubscriptionSocket",["$rootScope",function($rootScope){var Socket=function(){var self=this;this.callbacks={message:[],json:[],binary:[]},this._call=function(callbacks,data){var scope=this.ws;angular.forEach(callbacks,function(callback){$rootScope.$apply(function(){callback.call(scope,data)})})},this.connect=function(path,callback){self.path=path,self.ws=new WebSocket(path),self.ws.onopen=function(data){console.log("Socket opened: "+self.path),self.ws.binaryType="arraybuffer",callback.call(this.ws,data)},self.ws.onmessage=function(e){if(self._call(self.callbacks.message),e.data instanceof ArrayBuffer)self._call(self.callbacks.binary,e.data);else{var reg=/:\s?(Infinity|-Infinity|NaN)\s?\,/g,myData=e.data.replace(reg,': "$1", ');self._call(self.callbacks.json,JSON.parse(myData))}}},this.addListener=function(callback){this.callbacks.message.push(callback)},this.addJSONListener=function(callback){this.callbacks.json.push(callback)},this.addBinaryListener=function(callback){this.callbacks.binary.push(callback)},this.send=function(data){var self=this;self.ws.send(data)},this.close=function(){console.log("Socket closed: "+self.path),self.ws.close()}};return{createNew:function(){return new Socket}}}]),angular.module("webSCADirectives",[]).directive("jsonWindow",["$window","$compile",function($window){return{restrict:"EA",scope:{info:"="},template:"<button class='btn btn-link' ng-click='openWindow(info);'><small>JSON</small></button>",link:function($scope){$scope.openWindow=function(info){var win=$window.open("http://yahoo.com","_blank");win.document.open("text/html","replace"),win.document.write(angular.toJson(info,!0)),win.document.close()}}}}]),angular.module("webSCA",["webSCAConfig","redhawkServices","webSCADirectives","redhawkDirectives","ngRoute","ui.bootstrap","LocalStorageModule"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/overview",{templateUrl:"views/overview.html",controller:"Overview"}).when("/preferences",{templateUrl:"views/preferences.html",controller:"UserSettings"}).when("/waveforms/:action?",{templateUrl:"views/waveforms.html",controller:"Waveforms"}).when("/deviceManagers",{templateUrl:"views/device-managers.html",controller:"DeviceManagers"}).when("/manager/:managerId/device/:deviceId",{templateUrl:"views/device.html",controller:"Device"}).when("/plot/waveform/:waveformId/port/:portName/:dataType?",{templateUrl:"views/plot.html",controller:"Plot"}).when("/plot/waveform/:waveformId/component/:componentId/port/:portName/:dataType?",{templateUrl:"views/plot.html",controller:"Plot"}).otherwise({redirectTo:"/overview"})}]).config(function($logProvider){$logProvider.debugEnabled(!0)}).filter("reverse",function(){return function(items){return items.slice().reverse()}}).filter("limit",function(){return function(items,num){return items.slice(0,num)}}).factory("user",["RedhawkDomain","RedhawkSysinfo","localStorageService",function(RedhawkDomain,RedhawkSysinfo,localStorageService){var user={domain:void 0,hosts:void 0,domains:[],alldomains:[],hoststatus:{},sysinfo:{}};return user.getStoredHosts=function(){var storedHosts=localStorageService.get("hosts");return Array.isArray(storedHosts)&&0!=storedHosts.length||(storedHosts=["localhost"]),storedHosts},user.hosts=user.getStoredHosts(),RedhawkSysinfo().then(function(data){console.debug("Got sysinfo data ",data),user.sysinfo=data,user.refreshData()},function(err){console.warn("No sysinfo data ",err),user.refreshData()}),user.refreshData=function(){return console.debug("Refreshing locations"),new Promise(function(resolve){RedhawkDomain.getDomainIds(user.hosts,user.sysinfo.supportsRemoteLocations).then(function(data){user.setData(data),user.hosts=user.getStoredHosts(),resolve()})})},user.uniquePush=function(array,obj){return array.indexOf(obj)<0?(array.push(obj),!0):!1},user.setData=function(data){var i,found=!1,firstValid=void 0,tmpdomains=[],tmpstatus={};for(this.alldomains=data,i=0;i<data.length;i++)firstValid=firstValid||data[i].domain,data[i].domain?tmpdomains.push(data[i]):tmpstatus[data[i].host]={error:data[i].error},this.domain===data[i].domain&&(found=!0);return this.domain&&found||(this.domain=firstValid),this.domains=tmpdomains,this.hoststatus=tmpstatus,this},user}]).controller("UserSettings",["$scope","user","$timeout","RedhawkDomain","localStorageService",function($scope,user,$timeout,RedhawkDomain,localStorageService){$scope.user=user,$scope.hosts=user.getStoredHosts(),localStorageService.bind($scope,"hosts"),$scope.add_host=function(newhost){newhost&&(user.uniquePush($scope.user.hosts,newhost),$scope.hosts=angular.copy($scope.user.hosts),$scope.newhost="",$scope.user.refreshData())},$scope.remove_host=function(index){$scope.user.hosts.splice(index,1),$scope.hosts=angular.copy($scope.user.hosts),$scope.user.refreshData()}}]).controller("Overview",["$scope","RedhawkSocket","RedhawkDomain","user","$location","RedhawkNotificationService",function($scope,RedhawkSocket,RedhawkDomain,user,$location,RedhawkNotificationService){user.refreshData().then(function(){0==user.domains.length&&(0==user.hosts.length?(RedhawkNotificationService.error("No Remote Hosts Specified: Please add a host"),$location.path("/preferences")):RedhawkNotificationService.info("No domains found on any of the configured hosts"))}),$scope.user=user,$scope.$watch("user.domain",function(domainId){if(domainId){$scope.domain=RedhawkDomain.getDomain(domainId);var events=$scope.domain.getEvents();$scope.messages=events.getMessages(),$scope.channels=events.getChannelNames()}}),$scope.configure=function(properties){var data=[];angular.forEach(properties,function(value,key){data.push({id:key,value:value})}),$scope.redhawk.configure(data)}}]).controller("Waveforms",["$scope","RedhawkDomain","user","$location","RedhawkNotificationService",function($scope,RedhawkDomain,user,$location,RedhawkNotificationService){user.refreshData().then(function(){0==user.domains.length&&(0==user.hosts.length?(RedhawkNotificationService.error("No Remote Hosts Specified: Please add a host"),$location.path("/preferences")):RedhawkNotificationService.info("No domains found on any of the configured hosts"))}),$scope.user=user,$scope.$watch("user.domain",function(domainId){$scope.domain=RedhawkDomain.getDomain(domainId),$scope.waveforms=$scope.domain.getLaunchableWaveforms(),$scope.currentWaveform=null}),$scope.$watch("domain.applications",function(waveforms){waveforms&&waveforms.length&&$scope.setWaveform(waveforms[0].id)}),$scope.setWaveform=function(id){return id&&($scope.currentWaveform=id),$scope.currentWaveform},$scope.launch=function(name){$scope.domain.launch(name).$promise.then(function(waveform){$scope.domain.$promise.then(function(){$scope.setWaveform(waveform.id)})})}}]).controller("DeviceManagers",["$scope","RedhawkDomain","user","$location","RedhawkNotificationService",function($scope,RedhawkDomain,user,$location,RedhawkNotificationService){user.refreshData().then(function(){0==user.domains.length&&(0==user.hosts.length?(RedhawkNotificationService.error("No Remote Hosts Specified: Please add a host"),$location.path("/preferences")):RedhawkNotificationService.info("No domains found on any of the configured hosts"))}),$scope.user=user,$scope.$watch("user.domain",function(domainId){$scope.redhawk=RedhawkDomain.getDomain(domainId)}),$scope.$watch("redhawk.deviceManagers",function(deviceMgrs){deviceMgrs&&deviceMgrs.length>0&&-1==deviceMgrs.indexOf($scope.currentManager)&&$scope.setManager(deviceMgrs[0].id)}),$scope.setManager=function(id){return id?($scope.manager=$scope.redhawk.getDeviceManager(id),$scope.currentManager=id,$scope.currentManager):$scope.currentManager}}]).controller("Device",["$scope","$window","$filter","$routeParams","RedhawkDomain","user","$location","RedhawkNotificationService",function($scope,$window,$filter,$routeParams,RedhawkDomain,user,$location,RedhawkNotificationService){user.refreshData().then(function(){0==user.domains.length&&(0==user.hosts.length?(RedhawkNotificationService.error("No Remote Hosts Specified: Please add a host"),$location.path("/preferences")):RedhawkNotificationService.info("No domains found on any of the configured hosts"))}),$scope.user=user,$scope.$watch("user.domain",function(domainId){$scope.device=RedhawkDomain.getDomain(domainId).getDevice($routeParams.deviceId,$routeParams.managerId)})}]).controller("Plot",["$scope","$routeParams","RedhawkSocket","user",function($scope,$routeParams,RedhawkSocket,user){$scope.waveformId=$routeParams.waveformId,$scope.componentId=$routeParams.componentId,$scope.name=$routeParams.portName;var dataType=$routeParams.dataType?$routeParams.dataType:"float",defaultOverrides={xdelta:0,xstart:0,ydelta:0,ystart:0,yunits:0,xunits:1,subsize:4096};$scope.plotOverrides=angular.copy(defaultOverrides),console.log("plotOverrides initial values"),angular.forEach($scope.plotOverrides,function(value,key){console.log(key+" "+value)}),$scope.useSRISettings=!0,$scope.customSettings=angular.copy(defaultOverrides),$scope.$watch("useSRISettings",function(value){value&&($scope.customSettings=angular.copy($scope.plotOverrides)),reloadSri=!0,$scope.updateCustomSettings()});var plot=null,raster=null,layer=void 0,layer2=void 0,fillStyle=["rgba(255, 255, 100, 0.7)","rgba(255, 0, 0, 0.7)","rgba(0, 255, 0, 0.7)","rgba(0, 0, 255, 0.7)"],createPlot=function(settings){plot=new sigplot.Plot(document.getElementById("plot"),angular.extend(settings,{expand:!0,autol:5,autohide_panbars:!0,autox:3,legend:!1,xcnt:0,cmode:"MA",colors:{bg:"#222",fg:"#888"}})),plot.change_settings({fillStyle:fillStyle})},overlayPlot=function(overrides,options){options=options||{};var optionsCopy=angular.extend(options,{layerType:sigplot.Layer1D});layer=plot.overlay_array(null,overrides,optionsCopy)};createPlot({});var createRaster=function(settings){settings=settings||{},raster=new sigplot.Plot(document.getElementById("raster"),angular.extend(settings,{expand:!0,autol:5,autox:3,autohide_panbars:!0,xcnt:0,colors:{bg:"#222",fg:"#888"},nogrid:!0,cmode:"D2"}))},overlayRaster=function(overrides){var overridesCopy=angular.copy(overrides);layer2=raster.overlay_pipe(angular.extend(overridesCopy,{pipe:!0,pipsesize:5242880}),{layerType:sigplot.Layer2D})};createRaster(),raster.mimic(plot,{xzoom:!0,unzoom:!0,xpan:!0}),plot.mimic(raster,{xzoom:!0,unzoom:!0,xpan:!0});var reloadSri,useCustomSettings;$scope.updateCustomSettings=function(){useCustomSettings=!$scope.useSRISettings,reloadSri=!0};var getDataConverter=function(){var conversionMap={"byte":Int8Array,"char":Uint8Array,octet:Uint8Array,ushort:Uint16Array,"short":Int16Array,"long":Int32Array,ulong:Uint32Array,longlong:void 0,ulonglong:void 0,"float":Float32Array,"double":Float64Array},defaultConversion=Float32Array;return function(type){var fn=conversionMap[type];return console.log("Requesting dataconverter for type '"+type+"'."+fn),"octet"==type&&console.log("Plot::DataConverter::WARNING - Data type is 'octet' assuming unsigned."),fn||(console.log("Plot::DataConverter::WARNING - Data type is '"+type+"' using default."),fn=defaultConversion),function(data){return new fn(data)}}}(),dataConverter=getDataConverter(dataType),defaultSubsize=1024,on_data=function(data){defaultSubsize=1024;var bpa;switch(dataType){case"double":bpa=8;break;case"float":bpa=4;break;case"octet":case"short":bpa=1;break;default:return}var ape;switch(mode){case"S":ape=1;break;case"C":ape=2;break;default:return}void 0===$scope.plotOverrides.subsize&&($scope.plotOverrides.subsize=defaultSubsize);var frameSize=$scope.plotOverrides.subsize*bpa*ape;data.byteLength/bpa/ape<defaultSubsize&&(defaultSubsize=data.byteLength/bpa/ape,defaultSubsize>=100?defaultSubsize%100!=0&&(defaultSubsize=100*Math.floor(defaultSubsize/100)):defaultSubsize>10?defaultSubsize%10!=0&&(defaultSubsize=10*Math.floor(defaultSubsize/10)):console.log("data with subsize < 10 will not be plotted"),$scope.plotOverrides.subsize!==defaultSubsize&&($scope.plotOverrides.subsize=defaultSubsize,frameSize=defaultSubsize*bpa*ape,reloadSri=!0)),data=data.slice(0,frameSize);
var array=dataConverter(data);if(plot&&raster){if(array.length!==frameSize/bpa&&array.length!==frameSize)return;reloadPlots(array)}},reloadPlots=function(data){var overrides;overrides=useCustomSettings?$scope.customSettings:$scope.plotOverrides,void 0===layer&&overlayPlot(overrides),void 0===layer2&&overlayRaster(overrides),reloadSri?(plot.reload(layer,data,overrides),plot.refresh(),raster.push(layer2,data,overrides),raster.refresh(),reloadSri=!1):(plot.reload(layer,data),raster.push(layer2,data))},mode="",updatePlotSettings=function(data){var isDirty=!1;angular.forEach(data,function(item,key){angular.isDefined($scope.plotOverrides[key])&&!angular.equals($scope.plotOverrides[key],item)&&("ydelta"!==key&&"subsize"!==key||0!==item)&&(isDirty=!0,console.log("Plot settings change "+key+": "+$scope.plotOverrides[key]+" -> "+item),$scope.plotOverrides[key]=item)}),data.subsize||$scope.plotOverrides.subsize!==defaultSubsize&&($scope.plotOverrides.subsize=defaultSubsize,$scope.plotOverrides.ydelta=$scope.plotOverrides.xdelta*defaultSubsize,isDirty=!0),data.ydelta||$scope.plotOverrides.ydelta&&Math.abs($scope.plotOverrides.ydelta-$scope.plotOverrides.xdelta*$scope.plotOverrides.subsize)>$scope.plotOverrides.ydelta/10&&($scope.plotOverrides.ydelta=$scope.plotOverrides.xdelta*$scope.plotOverrides.subsize,isDirty=!0),$scope.plotOverrides.type=2e3,$scope.plotOverrides.size=1;var format="";switch(data.mode){case 0:mode="S";break;case 1:mode="C";break;default:mode="S"}switch(dataType){case"float":format=mode+"F";break;case"double":format=mode+"D";break;case"short":case"octet":format=mode+"B";break;default:format=mode+"F"}$scope.plotOverrides.format!==format&&($scope.plotOverrides.format=format,isDirty=!0),isDirty&&$scope.useSRISettings&&(reloadSri=!0,$scope.customSettings=angular.copy($scope.plotOverrides))},sriData={},on_sri=function(sri){"string"!=typeof sri&&(updatePlotSettings(sri),angular.forEach(sri,function(value,key){if(angular.isArray(value))sriData[key]=value.join(", ");else if(angular.isObject(value)&&"string"!=typeof value){var str=[];angular.forEach(value,function(value,key){str.push(key+": "+value)}),sriData[key]="{"+str.join(", ")+"}"}else sriData[key]=value}),$scope.sri=sriData)};user.refreshData().then(function(){$scope.port=RedhawkSocket.port({domain:user.domain,waveform:$scope.waveformId,component:$scope.componentId,port:$scope.name},on_data,on_sri)}),$scope.$on("$destroy",function(){$scope.port.close()})}]),angular.module("webSCAConfig",[]),angular.module("webSCAServices",[]);var ArrayBuffer,ArrayBufferView,Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,DataView;!function(){function e(){throw document&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}function a(c){if(Object.getOwnPropertyNames&&Object.defineProperty){var r,q=Object.getOwnPropertyNames(c);for(r=0;r<q.length;r+=1)Object.defineProperty(c,q[r],{value:c[q[r]],writable:!1,enumerable:!1,configurable:!1})}}function d(c){function q(r){Object.defineProperty(c,r,{get:function(){return c._getter(r)},set:function(q){c._setter(r,q)},enumerable:!0,configurable:!1})}if(Object.defineProperty){var r;for(r=0;r<c.length;r+=1)q(r)}}function x(c){return[255&c]}function s(c){return B(c[0],8)}function h(c){return[255&c]}function g(c){return q(c[0],8)}function f(c){return[c>>8&255,255&c]}function k(c){return B(c[0]<<8|c[1],16)}function p(c){return[c>>8&255,255&c]}function F(c){return q(c[0]<<8|c[1],16)}function u(c){return[c>>24&255,c>>16&255,c>>8&255,255&c]}function C(c){return B(c[0]<<24|c[1]<<16|c[2]<<8|c[3],32)}function A(c){return[c>>24&255,c>>16&255,c>>8&255,255&c]}function z(c){return q(c[0]<<24|c[1]<<16|c[2]<<8|c[3],32)}function E(c){var q=[];for(c=c.join("");c.length;)q.push(parseInt(c.substring(0,8),2)),c=c.substring(8);return q}function K(c){var r,w,q=[];for(r=c.length;r;r-=1)for(b=c[r-1],w=8;w;w-=1)q.push(b%2?1:0),b>>=1;return q.reverse(),q}function Q(c){return[255&c]}function U(c){return B(c[0],8)}function O(c){return[255&c]}function P(c){return q(c[0],8)}function G(c){return[255&c,c>>8&255]}function T(c){return B(c[1]<<8|c[0],16)}function c(c){return[255&c,c>>8&255]}function w(c){return q(c[1]<<8|c[0],16)}function D(c){return[255&c,c>>8&255,c>>16&255,c>>24&255]}function y(c){return B(c[3]<<24|c[2]<<16|c[1]<<8|c[0],32)}function t(c){return[255&c,c>>8&255,c>>16&255,c>>24&255]}function l(c){return q(c[3]<<24|c[2]<<16|c[1]<<8|c[0],32)}function X(c){var q=[];for(c=c.join("");c.length;)q.push(parseInt(c.substring(c.length-8,c.length),2)),c=c.substring(0,c.length-8);return q}function Y(c){var r,w,q=[];for(r=0;r<c.length;r++)for(b=c[r],w=8;w;w-=1)q.push(b%2?1:0),b>>=1;return q.reverse(),q}function B(c,q){var r=32-q;return c<<r>>r}function q(c,q){var r=32-q;return c<<r>>>r}function r(c,q,r){var n,a,v,w=(1<<q-1)-1;for(isNaN(c)?(a=(1<<w)-1,w=Math.pow(2,r-1),n=0):1/0===c||-1/0===c?(a=(1<<w)-1,w=0,n=0>c?1:0):0===c?(w=a=0,n=-1/0===1/c?1:0):(n=0>c,c=Math.abs(c),c>=Math.pow(2,1-w)?(v=Math.min(Math.floor(Math.log(c)/Math.LN2),w),a=v+w,w=Math.round(c*Math.pow(2,r-v)-Math.pow(2,r))):(a=0,w=Math.round(c/Math.pow(2,1-w-r)))),c=[];r;r-=1)c.push(w%2?1:0),w=Math.floor(w/2);for(r=q;r;r-=1)c.push(a%2?1:0),a=Math.floor(a/2);return c.push(n?1:0),c.reverse(),Z(c)}function v(c,q,r){var n,a,w=[],w=$(c);return n=w.join(""),c=(1<<q-1)-1,w=parseInt(n.substring(0,1),2)?-1:1,a=parseInt(n.substring(1,1+q),2),n=parseInt(n.substring(1+q),2),a===(1<<q)-1?0!==n?0/0:1/0*w:a>0?w*Math.pow(2,a-c)*(1+n/Math.pow(2,r)):0!==n?w*Math.pow(2,-(c-1))*(n/Math.pow(2,r)):0>w?-0:0}function n(c){return v(c,11,52)}function H(c){return r(c,11,52)}function I(c){return v(c,8,23)}function J(c){return r(c,8,23)}var M={ToInt32:function(c){return c>>0},ToUint32:function(c){return c>>>0}};Object.prototype.__defineGetter__&&!Object.defineProperty&&(Object.defineProperty=function(c,q,r){r.hasOwnProperty("get")&&c.__defineGetter__(q,r.get),r.hasOwnProperty("set")&&c.__defineSetter__(q,r.set)});var aa=window.BIG_ENDIAN_ARRAYBUFFERS?x:Q,ba=window.BIG_ENDIAN_ARRAYBUFFERS?s:U,R=window.BIG_ENDIAN_ARRAYBUFFERS?h:O,N=window.BIG_ENDIAN_ARRAYBUFFERS?g:P,W=window.BIG_ENDIAN_ARRAYBUFFERS?f:G,ca=window.BIG_ENDIAN_ARRAYBUFFERS?k:T,da=window.BIG_ENDIAN_ARRAYBUFFERS?p:c,ea=window.BIG_ENDIAN_ARRAYBUFFERS?F:w,fa=window.BIG_ENDIAN_ARRAYBUFFERS?u:D,ga=window.BIG_ENDIAN_ARRAYBUFFERS?C:y,ha=window.BIG_ENDIAN_ARRAYBUFFERS?A:t,L=window.BIG_ENDIAN_ARRAYBUFFERS?z:l,Z=window.BIG_ENDIAN_ARRAYBUFFERS?E:X,$=window.BIG_ENDIAN_ARRAYBUFFERS?K:Y;ArrayBuffer||function(){function c(q,r,w){var n;return n=function(c,q,r){var w,v,D;if(arguments.length&&"number"!=typeof arguments[0])if("object"==typeof arguments[0]&&arguments[0].constructor===n)for(w=arguments[0],this.length=w.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),v=this.byteOffset=0;v<this.length;v+=1)this._setter(v,w._getter(v));else if("object"!=typeof arguments[0]||arguments[0]instanceof ArrayBuffer){if(!("object"==typeof arguments[0]&&arguments[0]instanceof ArrayBuffer))throw new TypeError("Unexpected argument type(s)");if(this.buffer=c,this.byteOffset=M.ToUint32(q),this.byteOffset>this.buffer.byteLength&&e(),this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");3>arguments.length?(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT&&e(),this.length=this.byteLength/this.BYTES_PER_ELEMENT):(this.length=M.ToUint32(r),this.byteLength=this.length*this.BYTES_PER_ELEMENT),this.byteOffset+this.byteLength>this.buffer.byteLength&&e()}else for(w=arguments[0],this.length=M.ToUint32(w.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),v=this.byteOffset=0;v<this.length;v+=1)D=w[v],this._setter(v,Number(D));else{if(this.length=M.ToInt32(arguments[0]),0>r)throw new RangeError("ArrayBufferView size is not a small enough positive integer.");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new ArrayBuffer(this.byteLength),this.byteOffset=0}this.constructor=n,a(this),d(this)},n.prototype=new ArrayBufferView,n.prototype.BYTES_PER_ELEMENT=q,n.prototype.emulated=!0,n.prototype._pack=r,n.prototype._unpack=w,n.BYTES_PER_ELEMENT=q,n.prototype._getter=function(c){if(1>arguments.length)throw new SyntaxError("Not enough arguments");if(c=M.ToUint32(c),!(c>=this.length)){var r,w,q=[];for(r=0,w=this.byteOffset+c*this.BYTES_PER_ELEMENT;r<this.BYTES_PER_ELEMENT;r+=1,w+=1)q.push(this.buffer._bytes[w]);return this._unpack(q)}},n.prototype.get=n.prototype._getter,n.prototype._setter=function(c,q){if(2>arguments.length)throw new SyntaxError("Not enough arguments");if(c=M.ToUint32(c),!(c>=this.length)){var w,n,r=this._pack(q);for(w=0,n=this.byteOffset+c*this.BYTES_PER_ELEMENT;w<this.BYTES_PER_ELEMENT;w+=1,n+=1)this.buffer._bytes[n]=r[w]}},n.prototype.set=function(){if(1>arguments.length)throw new SyntaxError("Not enough arguments");var r,w,n,a,v,d;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor)if(r=arguments[0],w=M.ToUint32(arguments[1]),w+r.length>this.length&&e(),d=this.byteOffset+w*this.BYTES_PER_ELEMENT,w=r.length*this.BYTES_PER_ELEMENT,r.buffer===this.buffer){for(n=[],a=0,v=r.byteOffset;w>a;a+=1,v+=1)n[a]=r.buffer._bytes[v];for(a=0;w>a;a+=1,d+=1)this.buffer._bytes[d]=n[a]}else for(a=0,v=r.byteOffset;w>a;a+=1,v+=1,d+=1)this.buffer._bytes[d]=r.buffer._bytes[v];else{if("object"!=typeof arguments[0]||"undefined"==typeof arguments[0].length)throw new TypeError("Unexpected argument type(s)");for(r=arguments[0],n=M.ToUint32(r.length),w=M.ToUint32(arguments[1]),w+n>this.length&&e(),a=0;n>a;a+=1)v=r[a],this._setter(w+a,Number(v))}},n.prototype.subarray=function(c,q){c=M.ToInt32(c),q=M.ToInt32(q),1>arguments.length&&(c=0),2>arguments.length&&(q=this.length),0>c&&(c=this.length+c),0>q&&(q=this.length+q);var r=this.length;return c=0>c?0:c>r?r:c,r=this.length,r=(0>q?0:q>r?r:q)-c,0>r&&(r=0),new this.constructor(this.buffer,c*this.BYTES_PER_ELEMENT,r)},n}ArrayBuffer=function(c){if(c=M.ToInt32(c),0>c)throw new RangeError("ArrayBuffer size is not a small enough positive integer.");for(this.byteLength=c,this._bytes=[],this._bytes.length=c,c=0;c<this.byteLength;c+=1)this._bytes[c]=0;a(this)},ArrayBuffer.isNative=!1,ArrayBufferView=function(){},Int8Array=Int8Array||c(1,aa,ba),Uint8Array=Uint8Array||c(1,R,N),Int16Array=Int16Array||c(2,W,ca),Uint16Array=Uint16Array||c(2,da,ea),Int32Array=Int32Array||c(4,fa,ga),Uint32Array=Uint32Array||c(4,ha,L),Float32Array=Float32Array||c(4,J,I),Float64Array=Float64Array||c(8,H,n)}(),DataView||function(){function c(q,r){return"function"==typeof q.get?q.get(r):q[r]}function q(r){return function(q,n){q=M.ToUint32(q),q+r.BYTES_PER_ELEMENT>this.byteLength&&e(),q+=this.byteOffset;var d,a=new Uint8Array(this.buffer,q,r.BYTES_PER_ELEMENT),v=[];for(d=0;d<r.BYTES_PER_ELEMENT;d+=1)v.push(c(a,d));return Boolean(n)===Boolean(w)&&v.reverse(),c(new r(new Uint8Array(v).buffer),0)}}function r(q){return function(r,n,a){r=M.ToUint32(r),r+q.BYTES_PER_ELEMENT>this.byteLength&&e(),n=new q([n]),n=new Uint8Array(n.buffer);var d,v=[];for(d=0;d<q.BYTES_PER_ELEMENT;d+=1)v.push(c(n,d));Boolean(a)===Boolean(w)&&v.reverse(),new Uint8Array(this.buffer,r,q.BYTES_PER_ELEMENT).set(v)}}var w=function(){var q=new Uint16Array([4660]),q=new Uint8Array(q.buffer);return 18===c(q,0)}();DataView=function(c,q,r){if(!("object"==typeof c&&c instanceof ArrayBuffer))throw new TypeError("TypeError");this.buffer=c,this.byteOffset=M.ToUint32(q),this.byteOffset>this.buffer.byteLength&&e(),this.byteLength=3>arguments.length?this.buffer.byteLength-this.byteOffset:M.ToUint32(r),this.byteOffset+this.byteLength>this.buffer.byteLength&&e(),a(this)},ArrayBufferView&&(DataView.prototype=new ArrayBufferView),DataView.prototype.getUint8=q(Uint8Array),DataView.prototype.getInt8=q(Int8Array),DataView.prototype.getUint16=q(Uint16Array),DataView.prototype.getInt16=q(Int16Array),DataView.prototype.getUint32=q(Uint32Array),DataView.prototype.getInt32=q(Int32Array),DataView.prototype.getFloat32=q(Float32Array),DataView.prototype.getFloat64=q(Float64Array),DataView.prototype.setUint8=r(Uint8Array),DataView.prototype.setInt8=r(Int8Array),DataView.prototype.setUint16=r(Uint16Array),DataView.prototype.setInt16=r(Int16Array),DataView.prototype.setUint32=r(Uint32Array),DataView.prototype.setInt32=r(Int32Array),DataView.prototype.setFloat32=r(Float32Array),DataView.prototype.setFloat64=r(Float64Array)}()}(),window.ArrayBuffer&&!ArrayBuffer.prototype.slice&&(ArrayBuffer.prototype.slice=function(e,a){var d=new Uint8Array(this);void 0===a&&(a=d.length);for(var x=new ArrayBuffer(a-e),s=new Uint8Array(x),h=0;h<s.length;h++)s[h]=d[h+e];return x}),Array.prototype.remove=function(e,a){var d=this.slice((a||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,d)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCanelAnimationFrame||function(a){window.clearTimeout(a)}}(),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),window.Float64Array||(window.Float64Array=function(){return window.Float64Array||function(e,a,d){if(!(e instanceof ArrayBuffer))throw"Invalid type";var x=new DataView(e),s=[];for(e=(e.byteLength-a)/8,s.length=void 0===d?e:Math.min(d,e),d=0;d<s.length;d++)s[d]=x.getFloat64(8*d+a,!0);return s.subarray=function(a,d){return s.slice(a,d)},s}}()),function(){var e=function(){};if(window.console||(window.console={log:e,info:e,warn:e,debug:e,error:e}),new Int8Array([0,1,0]).subarray(1).subarray(1)[0]){var a=function(a,e){return 0===arguments.length?(a=0,e=this.length):(0>a&&(a+=this.length),a=Math.max(0,Math.min(this.length,a)),1===arguments.length?e=this.length:(0>e&&(e+=this.length),e=Math.max(a,Math.min(this.length,e)))),new this.constructor(this.buffer,this.byteOffset+a*this.BYTES_PER_ELEMENT,e-a)};[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].forEach(function(d){d.prototype.subarray=a})}}(),function(e,a){function d(a,d,k,p){a[s](x+d,"wheel"===h?k:function(a){!a&&(a=e.event);var d={originalEvent:a,target:a.target||a.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===a.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){a.preventDefault?a.preventDefault():a.returnValue=!1}};return"mousewheel"===h?(d.deltaY=-.025*a.wheelDelta,a.wheelDeltaX&&(d.deltaX=-.025*a.wheelDeltaX)):d.deltaY=a.detail,k(d)},p||!1)}var s,h,x="";e.addEventListener?s="addEventListener":(s="attachEvent",x="on"),h="onwheel"in a.createElement("div")?"wheel":void 0!==a.onmousewheel?"mousewheel":"DOMMouseScroll",e.addWheelListener=function(a,e,k){d(a,h,e,k),"DOMMouseScroll"===h&&d(a,"MozMousePixelScroll",e,k)}}(window,document),function(e){function a(a){if(a=new Uint8Array(a),F)return String.fromCharCode.apply(null,a);for(var d="",e=0;e<a.length;e++)d+=String.fromCharCode(a[e]);return d}function d(d){if(this.file_name=this.file=null,this.offset=0,this.buf=d,null!=this.buf){d=new DataView(this.buf),this.version=a(this.buf.slice(0,4)),this.headrep=a(this.buf.slice(4,8)),this.datarep=a(this.buf.slice(8,12));var e="EEEI"===this.headrep,h="EEEI"===this.datarep;this.type=d.getUint32(48,e),this["class"]=this.type/1e3,this.format=a(this.buf.slice(52,54)),this.timecode=d.getFloat64(56,e),1===this["class"]?(this.xstart=d.getFloat64(256,e),this.xdelta=d.getFloat64(264,e),this.xunits=d.getInt32(272,e),this.yunits=d.getInt32(296,e),this.subsize=1):2===this["class"]&&(this.xstart=d.getFloat64(256,e),this.xdelta=d.getFloat64(264,e),this.xunits=d.getInt32(272,e),this.subsize=d.getInt32(276,e),this.ystart=d.getFloat64(280,e),this.ydelta=d.getFloat64(288,e),this.yunits=d.getInt32(296,e)),this.data_start=d.getFloat64(32,e),this.data_size=d.getFloat64(40,e),this.setData(this.buf,this.data_start,this.data_start+this.data_size,h)}}function x(a){var d=document.createElement("a");d.href=a;for(var c,e=d.protocol.replace(":",""),h=d.hostname,g=d.port,f=d.search,k={},p=d.search.replace(/^\?/,"").split("&"),G=p.length,s=0;G>s;s++)p[s]&&(c=p[s].split("="),k[c[0]]=c[1]);return{source:a,protocol:e,host:h,port:g,query:f,params:k,file:(d.pathname.match(/\/([^\/?#]+)$/i)||[null,""])[1],hash:d.hash.replace("#",""),path:d.pathname.replace(/^([^\/])/,"/$1"),relative:(d.href.match(/tps?:\/\/[^\/]+(.+)/)||[null,""])[1],segments:d.pathname.replace(/^\//,"").split("/")}}function s(a,d,e){e=e||1024;var h=0,g=new ArrayBuffer(a.length),f=new Uint8Array(g),k=function(){for(var p=h+e;p>h;h++)f[h]=255&a.charCodeAt(h);h>=a.length?d(g):setTimeout(k,0)};setTimeout(k,0)}function h(a){this.options=a}navigator.userAgent.match(/(iPad|iPhone|iPod)/i);var g=function(){var a=new ArrayBuffer(4),d=new Uint32Array(a),a=new Uint8Array(a);if(d[0]=3735928559,239===a[0])return"LE";if(222===a[0])return"BE";throw Error("unknown endianness")}(),f={S:1,C:2,V:3,Q:4,M:9,X:10,T:16,U:1,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},k={P:.125,A:1,O:1,B:1,I:2,L:4,X:8,F:4,D:8},p={P:null,A:null,O:Uint8Array,B:Int8Array,I:Int16Array,L:Int32Array,X:null,F:Float32Array,D:Float64Array},F=!0;try{var u=new UInt8Array(new ArrayBuffer(4));u[0]=66,u[1]=76,u[2]=85,u[3]=69,"BLUE"!==String.fromCharCode.apply(null,u)&&(F=!1)}catch(C){F=!1}d.prototype={setData:function(a,d,e,h){if(1===this["class"]?(this.spa=f[this.format[0]],this.bps=k[this.format[1]],this.bpa=this.spa*this.bps,this.ape=1,this.bpe=this.ape*this.bpa):2===this["class"]&&(this.spa=f[this.format[0]],this.bps=k[this.format[1]],this.bpa=this.spa*this.bps,this.ape=this.subsize,this.bpe=this.ape*this.bpa),void 0===h&&(h="LE"===g),"LE"===g&&!h)throw"Not supported "+g+" "+h;if("BE"===g&&this.littleEndianData)throw"Not supported "+g+" "+h;a?(this.dview=d&&e?this.createArray(a,d,(e-d)/this.bps):this.createArray(a),this.size=this.dview.length/(this.spa*this.ape)):this.dview=this.createArray(null,null,this.size)},createArray:function(a,d,e){var h=p[this.format[1]];if(void 0===h)throw"unknown format "+this.format[1];return void 0===d&&(d=0),void 0===e&&(e=a.length||a.byteLength/k[this.format[1]]),a?new h(a,d,e):new h(e)}},h.prototype={readheader:function(a,e){var h=new FileReader,g=a.webkitSlice(0,512);h.onloadend=function(a){return function(g){g.target.error?e(null):(g=new d(h.result),g.file=a,e(g))}}(a),h.readAsArrayBuffer(g)},read:function(a,e){var h=new FileReader;h.onloadend=function(a){return function(g){g.target.error?e(null):(g=new d(h.result),g.file=a,g.file_name=a.name,e(g))}}(a),h.readAsArrayBuffer(a)},read_http:function(a,e){var h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.overrideMimeType("text/plain; charset=x-user-defined"),h.onload=function(g){if(4!==h.readyState||200!==h.status&&0!==h.status)e(null);else if(g=null,h.response){g=h.response,g=new d(g),x(a);var f=x(a);g.file_name=f.file,e(g)}else h.responseText&&s(h.responseText,function(h){h=new d(h),x(a);var g=x(a);h.file_name=g.file,e(h)})},h.onerror=function(){e(null)},h.send(null)}},e.BlueHeader=e.BlueHeader||d,e.BlueFileReader=e.BlueFileReader||h}(this),function(e){function a(e,p){if(e=e?e:"",p=p||{},"object"==typeof e&&e.hasOwnProperty("_tc_id"))return e;var c=d(e),w=c.r,D=c.g,y=c.b,t=c.a,l=z(100*t)/100,X=p.format||c.format;return 1>w&&(w=z(w)),1>D&&(D=z(D)),1>y&&(y=z(y)),{ok:c.ok,format:X,_tc_id:C++,alpha:t,toHsv:function(){var c=h(w,D,y);return{h:360*c.h,s:c.s,v:c.v,a:t}},toHsvString:function(){var c=h(w,D,y),a=z(360*c.h),q=z(100*c.s),c=z(100*c.v);return 1==t?"hsv("+a+", "+q+"%, "+c+"%)":"hsva("+a+", "+q+"%, "+c+"%, "+l+")"},toHsl:function(){var c=x(w,D,y);return{h:360*c.h,s:c.s,l:c.l,a:t}},toHslString:function(){var c=x(w,D,y),a=z(360*c.h),q=z(100*c.s),c=z(100*c.l);return 1==t?"hsl("+a+", "+q+"%, "+c+"%)":"hsla("+a+", "+q+"%, "+c+"%, "+l+")"},toHex:function(c){return g(w,D,y,c)},toHexString:function(c){return"#"+g(w,D,y,c)},toRgb:function(){return{r:z(w),g:z(D),b:z(y),a:t}},toRgbString:function(){return 1==t?"rgb("+z(w)+", "+z(D)+", "+z(y)+")":"rgba("+z(w)+", "+z(D)+", "+z(y)+", "+l+")"},toPercentageRgb:function(){return{r:z(100*f(w,255))+"%",g:z(100*f(D,255))+"%",b:z(100*f(y,255))+"%",a:t}},toPercentageRgbString:function(){return 1==t?"rgb("+z(100*f(w,255))+"%, "+z(100*f(D,255))+"%, "+z(100*f(y,255))+"%)":"rgba("+z(100*f(w,255))+"%, "+z(100*f(D,255))+"%, "+z(100*f(y,255))+"%, "+l+")"},toName:function(){return 0===t?"transparent":O[g(w,D,y,!0)]||!1},toFilter:function(c){var d=g(w,D,y),q=d,r=Math.round(255*parseFloat(t)).toString(16),v=r,n=p&&p.gradientType?"GradientType = 1, ":"";return c&&(c=a(c),q=c.toHex(),v=Math.round(255*parseFloat(c.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr=#"+k(r)+d+",endColorstr=#"+k(v)+q+")"},toString:function(c){var w=!!c;c=c||this.format;var q=!1,w=!w&&1>t&&t>0&&("hex"===c||"hex6"===c||"hex3"===c||"name"===c);return"rgb"===c&&(q=this.toRgbString()),"prgb"===c&&(q=this.toPercentageRgbString()),("hex"===c||"hex6"===c)&&(q=this.toHexString()),"hex3"===c&&(q=this.toHexString(!0)),"name"===c&&(q=this.toName()),"hsl"===c&&(q=this.toHslString()),"hsv"===c&&(q=this.toHsvString()),w?this.toRgbString():q||this.toHexString()}}}function d(a){var d={r:0,g:0,b:0},c=1,w=!1,D=!1;if("string"==typeof a)a:{a=a.replace(F,"").replace(u,"").toLowerCase();var e=!1;if(U[a])a=U[a],e=!0;else if("transparent"==a){a={r:0,g:0,b:0,a:0,format:"name"};break a}var t;a=(t=P.rgb.exec(a))?{r:t[1],g:t[2],b:t[3]}:(t=P.rgba.exec(a))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=P.hsl.exec(a))?{h:t[1],s:t[2],l:t[3]}:(t=P.hsla.exec(a))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=P.hsv.exec(a))?{h:t[1],s:t[2],v:t[3]}:(t=P.hex6.exec(a))?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),format:e?"name":"hex"}:(t=P.hex3.exec(a))?{r:parseInt(t[1]+""+t[1],16),g:parseInt(t[2]+""+t[2],16),b:parseInt(t[3]+""+t[3],16),format:e?"name":"hex"}:!1}if("object"==typeof a){if(a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b"))d=a.g,w=a.b,d={r:255*f(a.r,255),g:255*f(d,255),b:255*f(w,255)},w=!0,D="%"===String(a.r).substr(-1)?"prgb":"rgb";else if(a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("v")){a.s=p(a.s),a.v=p(a.v);var D=a.h,e=a.s,d=a.v,D=6*f(D,360),e=f(e,100),d=f(d,100),w=A.floor(D),l=D-w,D=d*(1-e);t=d*(1-l*e),e=d*(1-(1-l)*e),w%=6,d={r:255*[d,t,D,D,e,d][w],g:255*[e,d,d,t,D,D][w],b:255*[D,D,e,d,d,t][w]},w=!0,D="hsv"}else a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("l")&&(a.s=p(a.s),a.l=p(a.l),d=s(a.h,a.s,a.l),w=!0,D="hsl");a.hasOwnProperty("a")&&(c=a.a)}return c=parseFloat(c),(isNaN(c)||0>c||c>1)&&(c=1),{ok:w,format:a.format||D,r:E(255,K(d.r,0)),g:E(255,K(d.g,0)),b:E(255,K(d.b,0)),a:c}}function x(a,d,c){a=f(a,255),d=f(d,255),c=f(c,255);var e,w=K(a,d,c),D=E(a,d,c),t=(w+D)/2;if(w==D)e=D=0;else{var l=w-D,D=t>.5?l/(2-w-D):l/(w+D);switch(w){case a:e=(d-c)/l+(c>d?6:0);break;case d:e=(c-a)/l+2;break;case c:e=(a-d)/l+4}e/=6}return{h:e,s:D,l:t}}function s(a,d,c){function w(c,w,a){return 0>a&&(a+=1),a>1&&(a-=1),1/6>a?c+6*(w-c)*a:.5>a?w:2/3>a?c+(w-c)*(2/3-a)*6:c}if(a=f(a,360),d=f(d,100),c=f(c,100),0===d)c=d=a=c;else{var D=.5>c?c*(1+d):c+d-c*d,e=2*c-D;c=w(e,D,a+1/3),d=w(e,D,a),a=w(e,D,a-1/3)}return{r:255*c,g:255*d,b:255*a}}function h(a,d,c){a=f(a,255),d=f(d,255),c=f(c,255);var e,w=K(a,d,c),D=E(a,d,c),t=w-D;if(w==D)e=0;else{switch(w){case a:e=(d-c)/t+(c>d?6:0);break;case d:e=(c-a)/t+2;break;case c:e=(a-d)/t+4}e/=6}return{h:e,s:0===w?0:t/w,v:w}}function g(a,d,c,w){return a=[k(z(a).toString(16)),k(z(d).toString(16)),k(z(c).toString(16))],w&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function f(a,d){var c=a;return"string"==typeof c&&-1!=c.indexOf(".")&&1===parseFloat(c)&&(a="100%"),c="string"==typeof a&&-1!=a.indexOf("%"),a=E(d,K(0,parseFloat(a))),c&&(a=parseInt(a*d,10)/100),1e-6>A.abs(a-d)?1:a%d/parseFloat(d)}function k(a){return 1==a.length?"0"+a:""+a}function p(a){return 1>=a&&(a=100*a+"%"),a}var F=/^[\s,#]+/,u=/\s+$/,C=0,A=Math,z=A.round,E=A.min,K=A.max,Q=A.random;a.fromRatio=function(d,e){if("object"==typeof d){var w,c={};for(w in d)d.hasOwnProperty(w)&&(c[w]="a"===w?d[w]:p(d[w]));d=c}return a(d,e)},a.equals=function(d,e){return d&&e?a(d).toRgbString()==a(e).toRgbString():!1},a.random=function(){return a.fromRatio({r:Q(),g:Q(),b:Q()})},a.desaturate=function(d,e){e=0===e?0:e||10;var c=a(d).toHsl();return c.s-=e/100,c.s=E(1,K(0,c.s)),a(c)},a.saturate=function(d,e){e=0===e?0:e||10;var c=a(d).toHsl();return c.s+=e/100,c.s=E(1,K(0,c.s)),a(c)},a.greyscale=function(d){return a.desaturate(d,100)},a.lighten=function(d,e){e=0===e?0:e||10;var c=a(d).toHsl();return c.l+=e/100,c.l=E(1,K(0,c.l)),a(c)},a.darken=function(d,e){e=0===e?0:e||10;var c=a(d).toHsl();return c.l-=e/100,c.l=E(1,K(0,c.l)),a(c)},a.complement=function(d){return d=a(d).toHsl(),d.h=(d.h+180)%360,a(d)},a.triad=function(d){var e=a(d).toHsl(),c=e.h;return[a(d),a({h:(c+120)%360,s:e.s,l:e.l}),a({h:(c+240)%360,s:e.s,l:e.l})]},a.tetrad=function(d){var e=a(d).toHsl(),c=e.h;return[a(d),a({h:(c+90)%360,s:e.s,l:e.l}),a({h:(c+180)%360,s:e.s,l:e.l}),a({h:(c+270)%360,s:e.s,l:e.l})]},a.splitcomplement=function(d){var e=a(d).toHsl(),c=e.h;return[a(d),a({h:(c+72)%360,s:e.s,l:e.l}),a({h:(c+216)%360,s:e.s,l:e.l})]},a.analogous=function(d,e,c){e=e||6,c=c||30;var w=a(d).toHsl();for(c=360/c,d=[a(d)],w.h=(w.h-(c*e>>1)+720)%360;--e;)w.h=(w.h+c)%360,d.push(a(w));return d},a.monochromatic=function(d,e){e=e||6;for(var c=a(d).toHsv(),w=c.h,D=c.s,c=c.v,y=[],t=1/e;e--;)y.push(a({h:w,s:D,v:c})),c=(c+t)%1;return y},a.readability=function(d,e){var c=a(d).toRgb(),w=a(e).toRgb(),D=(299*c.r+587*c.g+114*c.b)/1e3,y=(299*w.r+587*w.g+114*w.b)/1e3,c=Math.max(c.r,w.r)-Math.min(c.r,w.r)+Math.max(c.g,w.g)-Math.min(c.g,w.g)+Math.max(c.b,w.b)-Math.min(c.b,w.b);return{brightness:Math.abs(D-y),color:c}},a.readable=function(d,e){var c=a.readability(d,e);return 125<c.brightness&&500<c.color},a.mostReadable=function(d,e){for(var c=null,w=0,D=!1,y=0;y<e.length;y++){var t=a.readability(d,e[y]),l=125<t.brightness&&500<t.color,t=t.brightness/125*3+t.color/500;(l&&!D||l&&D&&t>w||!l&&!D&&t>w)&&(D=l,w=t,c=a(e[y]))}return c};var U=a.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},O=a.hexNames=function(a){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[a[c]]=c);return d}(U),P={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};"undefined"!=typeof module&&module.exports?module.exports=a:"undefined"!=typeof define?define(function(){return a}):e.tinycolor=a}(this),function(){var e=[];(window.CanvasInput=function(a){var d=this;a=a?a:{},d._canvas=a.canvas||null,d._ctx=d._canvas?d._canvas.getContext("2d"):null,d._x=a.x||0,d._y=a.y||0,d._extraX=a.extraX||0,d._extraY=a.extraY||0,d._fontSize=a.fontSize||14,d._fontFamily=a.fontFamily||"Arial",d._fontColor=a.fontColor||"#000",d._placeHolderColor=a.placeHolderColor||"#bfbebd",d._fontWeight=a.fontWeight||"normal",d._fontStyle=a.fontStyle||"normal",d._readonly=a.readonly||!1,d._maxlength=a.maxlength||null,d._width=a.width||150,d._height=a.height||d._fontSize,d._padding=0<=a.padding?a.padding:5,d._borderWidth=0<=a.borderWidth?a.borderWidth:1,d._borderColor=a.borderColor||"#959595",d._borderRadius=0<=a.borderRadius?a.borderRadius:3,d._backgroundImage=a.backgroundImage||"",d._boxShadow=a.boxShadow||"1px 1px 0px rgba(255, 255, 255, 1)",d._innerShadow=a.innerShadow||"0px 0px 4px rgba(0, 0, 0, 0.4)",d._selectionColor=a.selectionColor||"rgba(179, 212, 253, 0.8)",d._placeHolder=a.placeHolder||"",d._value=a.value||d._placeHolder,d._onsubmit=a.onsubmit||function(){},d._onkeydown=a.onkeydown||function(){},d._onkeyup=a.onkeyup||function(){},d._onfocus=a.onfocus||function(){},d._onblur=a.onblur||function(){},d._cursor=!1,d._cursorPos=0,d._hasFocus=!1,d._selection=[0,0],d._wasOver=!1,d._renderOnReturn=void 0!==a.renderOnReturn?a.renderOnReturn:!0,d._disableBlur=a.disableBlur||!1,d._tabToClear=a.tabToClear||!1,d.boxShadow(d._boxShadow,!0),d._calcWH(),d._renderCanvas=document.createElement("canvas"),d._renderCanvas.setAttribute("width",d.outerW),d._renderCanvas.setAttribute("height",d.outerH),d._renderCtx=d._renderCanvas.getContext("2d"),d._shadowCanvas=document.createElement("canvas"),d._shadowCanvas.setAttribute("width",d._width+2*d._padding),d._shadowCanvas.setAttribute("height",d._height+2*d._padding),d._shadowCtx=d._shadowCanvas.getContext("2d"),"undefined"!=typeof a.backgroundGradient?(d._backgroundColor=d._renderCtx.createLinearGradient(0,0,0,d.outerH),d._backgroundColor.addColorStop(0,a.backgroundGradient[0]),d._backgroundColor.addColorStop(1,a.backgroundGradient[1])):d._backgroundColor=a.backgroundColor||"#fff",d._canvas&&(d.mousemoveCanvasListener=function(a){a=a||window.event,d.mousemove(a,d)
},d._canvas.addEventListener("mousemove",d.mousemoveCanvasListener,!1),d.mousedownCanvasListener=function(a){a=a||window.event,d.mousedown(a,d)},d._canvas.addEventListener("mousedown",d.mousedownCanvasListener,!1),d.mouseupCanvasListener=function(a){a=a||window.event,d.mouseup(a,d)},d._canvas.addEventListener("mouseup",d.mouseupCanvasListener,!1)),d.mouseupWindowListener=function(){d._hasFocus&&!d._mouseDown&&d.blur()},window.addEventListener("mouseup",d.mouseupWindowListener,!0),d.keydownWindowListener=function(a){a=a||window.event,d._hasFocus&&d.keydown(a,d)},window.addEventListener("keydown",d.keydownWindowListener,!1),d.keyupWindowListener=function(a){a=a||window.event,d._hasFocus&&d._onkeyup(a,d)},window.addEventListener("keyup",d.keyupWindowListener,!1),d.pasteWindowListener=function(a){if(a=a||window.event,d._hasFocus){a=a.clipboardData.getData("text/plain");var e=d._value.substr(0,d._cursorPos),h=d._value.substr(d._cursorPos);d._value=e+a+h,d._cursorPos+=a.length,d.render()}},window.addEventListener("paste",d.pasteWindowListener,!1),e.push(d),d._inputsIndex=e.length-1,d.render()}).prototype={canvas:function(a){return"undefined"!=typeof a?(this._canvas=a,this._ctx=this._canvas.getContext("2d"),this.render()):this._canvas},x:function(a){return"undefined"!=typeof a?(this._x=a,this.render()):this._x},y:function(a){return"undefined"!=typeof a?(this._y=a,this.render()):this._y},extraX:function(a){return"undefined"!=typeof a?(this._extraX=a,this.render()):this._extraX},extraY:function(a){return"undefined"!=typeof a?(this._extraY=a,this.render()):this._extraY},fontSize:function(a){return"undefined"!=typeof a?(this._fontSize=a,this.render()):this._fontSize},fontFamily:function(a){return"undefined"!=typeof a?(this._fontFamily=a,this.render()):this._fontFamily},fontColor:function(a){return"undefined"!=typeof a?(this._fontColor=a,this.render()):this._fontColor},placeHolderColor:function(a){return"undefined"!=typeof a?(this._placeHolderColor=a,this.render()):this._placeHolderColor},fontWeight:function(a){return"undefined"!=typeof a?(this._fontWeight=a,this.render()):this._fontWeight},fontStyle:function(a){return"undefined"!=typeof a?(this._fontStyle=a,this.render()):this._fontStyle},width:function(a){return"undefined"!=typeof a?(this._width=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._width},height:function(a){return"undefined"!=typeof a?(this._height=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._height},padding:function(a){return"undefined"!=typeof a?(this._padding=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._padding},borderWidth:function(a){return"undefined"!=typeof a?(this._borderWidth=a,this._calcWH(),this._updateCanvasWH(),this.render()):this._borderWidth},borderColor:function(a){return"undefined"!=typeof a?(this._borderColor=a,this.render()):this._borderColor},borderRadius:function(a){return"undefined"!=typeof a?(this._borderRadius=a,this.render()):this._borderRadius},backgroundColor:function(a){return"undefined"!=typeof a?(this._backgroundColor=a,this.render()):this._backgroundColor},backgroundGradient:function(a){return"undefined"!=typeof a?(this._backgroundColor=this._renderCtx.createLinearGradient(0,0,0,this.outerH),this._backgroundColor.addColorStop(0,a[0]),this._backgroundColor.addColorStop(1,a[1]),this.render()):this._backgroundColor},boxShadow:function(a,d){if("undefined"==typeof a)return this._boxShadow;var e=a.split("px ");return this._boxShadow={x:"none"===this._boxShadow?0:parseInt(e[0],10),y:"none"===this._boxShadow?0:parseInt(e[1],10),blur:"none"===this._boxShadow?0:parseInt(e[2],10),color:"none"===this._boxShadow?"":e[3]},this.shadowL=0>this._boxShadow.x?Math.abs(this._boxShadow.x)+this._boxShadow.blur:Math.abs(this._boxShadow.blur-this._boxShadow.x),this.shadowR=this._boxShadow.blur+this._boxShadow.x,this.shadowT=0>this._boxShadow.y?Math.abs(this._boxShadow.y)+this._boxShadow.blur:Math.abs(this._boxShadow.blur-this._boxShadow.y),this.shadowB=this._boxShadow.blur+this._boxShadow.y,this.shadowW=this.shadowL+this.shadowR,this.shadowH=this.shadowT+this.shadowB,this._calcWH(),d?void 0:(this._updateCanvasWH(),this.render())},innerShadow:function(a){return"undefined"!=typeof a?(this._innerShadow=a,this.render()):this._innerShadow},selectionColor:function(a){return"undefined"!=typeof a?(this._selectionColor=a,this.render()):this._selectionColor},placeHolder:function(a){return"undefined"!=typeof a?(this._placeHolder=a,this.render()):this._placeHolder},value:function(a){return"undefined"!=typeof a?(this._value=a,this.focus()):this._value},onsubmit:function(a){return"undefined"!=typeof a?(this._onsubmit=a,this):void this._onsubmit()},onkeydown:function(a){return"undefined"!=typeof a?(this._onkeydown=a,this):void this._onkeydown()},onkeyup:function(a){return"undefined"!=typeof a?(this._onkeyup=a,this):void this._onkeyup()},focus:function(a){var e,d=this;if(!d._readonly){d._hasFocus||d._onfocus(d),d._selectionUpdated?delete d._selectionUpdated:d._selection=[0,0],d._cursorPos="number"==typeof a?a:d._clipText().length,d._placeHolder===d._value&&(d._value=""),d._hasFocus=!0,d._cursor=!0,d._cursorInterval&&clearInterval(d._cursorInterval),d._cursorInterval=setInterval(function(){d._cursor=!d._cursor,d.render()},500),a=navigator.userAgent.toLowerCase(),a=0<=a.indexOf("chrome")&&0<=a.indexOf("mobile")&&0<=a.indexOf("android");var s="undefined"!=typeof window.orientation;return s&&!a&&document&&document.createElement&&(e=document.createElement("input"))?(e.type="text",e.style.opacity=0,e.style.position="absolute",e.style.left=d._x+d._extraX+(d._canvas?d._canvas.offsetLeft:0)+"px",e.style.top=d._y+d._extraY+(d._canvas?d._canvas.offsetTop:0)+"px",e.style.width=d._width,e.style.height=0,document.body.appendChild(e),e.focus(),e.addEventListener("blur",function(){d.blur(d)},!1)):s&&d.value(prompt(d._placeHolder)||""),d.render()}},blur:function(a){return a=a||this,a._disableBlur||(a._onblur(a),a._cursorInterval&&clearInterval(a._cursorInterval),a._hasFocus=!1,a._cursor=!1,a._selection=[0,0],""===a._value&&(a._value=a._placeHolder)),a.render()},disableBlur:function(a){(a||this)._disableBlur=!0},enableBlur:function(a){(a||this)._disableBlur=!1},keydown:function(a,d){var g,x=a.which,s=a.shiftKey,h=null;if(d._hasFocus){if(d._onkeydown(a,d),65===x&&(a.ctrlKey||a.metaKey))return d._selection=[0,d._value.length],a.preventDefault(),d.render();if(17===x||a.metaKey||a.ctrlKey)return d;if(a.preventDefault(),8===x)!d._clearSelection()&&0<d._cursorPos&&(s=d._value.substr(0,d._cursorPos-1),g=d._value.substr(d._cursorPos,d._value.length),d._value=s+g,d._cursorPos--);else if(37===x)0<d._cursorPos&&(d._cursorPos--,d._cursor=!0,d._selection=[0,0]);else if(39===x)d._cursorPos<d._value.length&&(d._cursorPos++,d._cursor=!0,d._selection=[0,0]);else if(13===x)d._onsubmit(a,d);else if(9===x)if(d._tabToClear)d._value="",d._cursorPos=0;else{var f=e[d._inputsIndex+1]?d._inputsIndex+1:0;f!==d._inputsIndex&&(d.blur(),setTimeout(function(){e[f].focus()},10))}else if(h=d._mapCodeToKey(s,x)){if(d._clearSelection(),d._maxlength&&d._maxlength<=d._value.length)return;s=d._value?d._value.substr(0,d._cursorPos):"",g=d._value?d._value.substr(d._cursorPos):"",d._value=s+h+g,d._cursorPos++}return 13==x&&d._renderOnReturn||13!==x?d.render():function(){}}},click:function(a,d){var e=d._mousePos(a),s=e.x,e=e.y;if(d._endSelection)delete d._endSelection,delete d._selectionUpdated;else{if(!(d._canvas&&d._overInput(s,e)||!d._canvas))return d.blur();if(d._mouseDown)return d._mouseDown=!1,d.click(a,d),d.focus(d._clickPos(s,e))}},mousemove:function(a,d){var e=d._mousePos(a),s=e.x,h=e.y;(e=d._overInput(s,h))&&d._canvas?(d._canvas.style.cursor="text",d._wasOver=!0):d._wasOver&&d._canvas&&(d._canvas.style.cursor="default",d._wasOver=!1),d._hasFocus&&0<=d._selectionStart&&(h=d._clickPos(s,h),s=Math.min(d._selectionStart,h),h=Math.max(d._selectionStart,h),e?(d._selection[0]!==s||d._selection[1]!==h)&&(d._selection=[s,h],d.render()):(d._selectionUpdated=!0,d._endSelection=!0,delete d._selectionStart,d.render()))},mousedown:function(a,d){var e=d._mousePos(a),s=e.x,e=e.y,h=d._overInput(s,e);d._mouseDown=h,d._hasFocus&&h&&(d._selectionStart=d._clickPos(s,e))},mouseup:function(a,d){var e=d._mousePos(a),s=e.x,e=e.y,h=d._clickPos(s,e)!==d._selectionStart;d._hasFocus&&0<=d._selectionStart&&d._overInput(s,e)&&h?(d._selectionUpdated=!0,delete d._selectionStart,d.render()):delete d._selectionStart,d.click(a,d)},renderCanvas:function(){return this._renderCanvas},cleanup:function(){this._canvas.removeEventListener("mouseup",this.mouseupCanvasListener,!1),this._canvas.removeEventListener("mousedown",this.mousedownCanvasListener,!1),this._canvas.removeEventListener("mousemove",this.mousemoveCanvasListener,!1),window.removeEventListener("keydown",this.keydownWindowListener,!1),window.removeEventListener("keyup",this.keyupWindowListener,!1),window.removeEventListener("mouseup",this.mouseupWindowListener,!0),window.removeEventListener("paste",this.pasteWindowListener,!1),clearInterval(this._cursorInterval),this._canvas.style.cursor="default";for(var a=0;a<e.length;a++)e[a]===this&&e.remove(a)},render:function(){var a=this,d=a._renderCtx,e=a.outerW,s=a.outerH,h=a._borderRadius,g=a._borderWidth,f=a.shadowW,k=a.shadowH;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.shadowOffsetX=a._boxShadow.x,d.shadowOffsetY=a._boxShadow.y,d.shadowBlur=a._boxShadow.blur,d.shadowColor=a._boxShadow.color,0<a._borderWidth&&(d.fillStyle=a._borderColor,a._roundedRect(d,a.shadowL,a.shadowT,e-f,s-k,h),d.fill(),d.shadowOffsetX=0,d.shadowOffsetY=0,d.shadowBlur=0),a._drawTextBox(function(){d.shadowOffsetX=0,d.shadowOffsetY=0,d.shadowBlur=0;var p=a._clipText(),F=a._padding+a._borderWidth+a.shadowT;if(0<a._selection[1]){var u=a._textWidth(p.substring(0,a._selection[0])),C=a._textWidth(p.substring(a._selection[0],a._selection[1]));d.fillStyle=a._selectionColor,d.fillRect(F+u,F,C,a._height)}if(d.fillStyle=a._placeHolder===a._value&&""!==a._value?a._placeHolderColor:a._fontColor,a._cursor&&(u=a._textWidth(p.substring(0,a._cursorPos)),d.fillRect(F+u,F,1,a._height)),u=a._padding+a._borderWidth+a.shadowL,F=Math.round(F+a._height/2),d.font=a._fontStyle+" "+a._fontWeight+" "+a._fontSize+"px "+a._fontFamily,d.textAlign="left",d.textBaseline="middle",d.fillText(p,u,F),C=a._innerShadow.split("px "),p="none"===a._innerShadow?0:parseInt(C[0],10),F="none"===a._innerShadow?0:parseInt(C[1],10),u="none"===a._innerShadow?0:parseInt(C[2],10),C="none"===a._innerShadow?"":C[3],u>0){var A=a._shadowCtx,z=A.canvas.width,E=A.canvas.height;A.clearRect(0,0,z,E),A.shadowBlur=u,A.shadowColor=C,A.shadowOffsetX=0,A.shadowOffsetY=F,A.fillRect(-1*e,-100,3*e,100),A.shadowOffsetX=p,A.shadowOffsetY=0,A.fillRect(z,-1*s,100,3*s),A.shadowOffsetX=0,A.shadowOffsetY=F,A.fillRect(-1*e,E,3*e,100),A.shadowOffsetX=p,A.shadowOffsetY=0,A.fillRect(-100,-1*s,100,3*s),a._roundedRect(d,g+a.shadowL,g+a.shadowT,e-2*g-f,s-2*g-k,h),d.clip(),d.drawImage(a._shadowCanvas,0,0,z,E,g+a.shadowL,g+a.shadowT,z,E)}return a._ctx&&(a._ctx.clearRect(a._x,a._y,d.canvas.width,d.canvas.height),a._ctx.drawImage(a._renderCanvas,a._x,a._y)),a})},_drawTextBox:function(a){var d=this,e=d._renderCtx,s=d.outerW,h=d.outerH,g=d._borderRadius,f=d._borderWidth,k=d.shadowW,p=d.shadowH;if(""===d._backgroundImage)e.fillStyle=d._backgroundColor,d._roundedRect(e,f+d.shadowL,f+d.shadowT,s-2*f-k,h-2*f-p,g),e.fill(),a();else{var F=new Image;F.src=d._backgroundImage,F.onload=function(){e.drawImage(F,0,0,F.width,F.height,f+d.shadowL,f+d.shadowT,s,h),a()}}},_clearSelection:function(){if(0<this._selection[1]){var a=this._selection[0],d=this._selection[1];return this._value=this._value.substr(0,a)+this._value.substr(d),this._cursorPos=a,this._cursorPos=0>this._cursorPos?0:this._cursorPos,this._selection=[0,0],!0}return!1},_clipText:function(a){a="undefined"==typeof a?this._value:a;var d=this._textWidth(a)/(this._width-this._padding);return(d>1?a.substr(-1*Math.floor(a.length/d)):a)+""},_textWidth:function(a){var d=this._renderCtx;return d.font=this._fontStyle+" "+this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,d.textAlign="left",d.measureText(a).width},_calcWH:function(){this.outerW=this._width+2*this._padding+2*this._borderWidth+this.shadowW,this.outerH=this._height+2*this._padding+2*this._borderWidth+this.shadowH},_updateCanvasWH:function(){var a=this._renderCanvas.width,d=this._renderCanvas.height;this._renderCanvas.setAttribute("width",this.outerW),this._renderCanvas.setAttribute("height",this.outerH),this._shadowCanvas.setAttribute("width",this._width+2*this._padding),this._shadowCanvas.setAttribute("height",this._height+2*this._padding),this._ctx&&this._ctx.clearRect(this._x,this._y,a,d)},_roundedRect:function(a,d,e,s,h,g){2*g>s&&(g=s/2),2*g>h&&(g=h/2),a.beginPath(),a.moveTo(d+g,e),a.lineTo(d+s-g,e),a.quadraticCurveTo(d+s,e,d+s,e+g),a.lineTo(d+s,e+h-g),a.quadraticCurveTo(d+s,e+h,d+s-g,e+h),a.lineTo(d+g,e+h),a.quadraticCurveTo(d,e+h,d,e+h-g),a.lineTo(d,e+g),a.quadraticCurveTo(d,e,d+g,e),a.closePath()},_overInput:function(a,d){var e=a<=this._x+this._extraX+this._width+2*this._padding,s=d>=this._y+this._extraY,h=d<=this._y+this._extraY+this._height+2*this._padding;return a>=this._x+this._extraX&&e&&s&&h},_clickPos:function(a){var e=this._value;this._value===this._placeHolder&&(e="");var e=this._clipText(e),s=0,h=e.length;if(a-(this._x+this._extraX)<this._textWidth(e))for(var g=0;g<e.length;g++)if(s+=this._textWidth(e[g]),s>=a-(this._x+this._extraX)){h=g;break}return h},_mousePos:function(a){var d=a.target,e=document.defaultView.getComputedStyle(d,void 0),s=parseInt(e.paddingLeft,10)||0,h=parseInt(e.paddingLeft,10)||0,g=parseInt(e.borderLeftWidth,10)||0,e=parseInt(e.borderLeftWidth,10)||0,f=document.body.parentNode.offsetTop||0,k=document.body.parentNode.offsetLeft||0,p=0,F=0;if("unefined"!=typeof d.offsetParent)do p+=d.offsetLeft,F+=d.offsetTop;while(d=d.offsetParent);return{x:a.pageX-(p+(s+g+k)),y:a.pageY-(F+(h+e+f))}},_mapCodeToKey:function(a,d){for(var e=[8,9,13,16,17,18,20,27,91,92],s="",s=0;s<e.length;s++)if(d===e[s])return;return"boolean"==typeof a&&"number"==typeof d?(e={32:" ",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",107:"+",189:"_",186:":",187:"+",188:"<",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},s=a?d>=65&&90>=d?String.fromCharCode(d):e[d]:d>=65&&90>=d?String.fromCharCode(d).toLowerCase():96===d?"0":97===d?"1":98===d?"2":99===d?"3":100===d?"4":101===d?"5":102===d?"6":103===d?"7":104===d?"8":105===d?"9":188===d?",":190===d?".":191===d?"/":192===d?"`":220===d?"\\":187===d?"=":189===d?"-":222===d?"'":186===d?";":219===d?"[":221===d?"]":String.fromCharCode(d)):void 0}}}(),function(e,a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):e.Spinner=a()}(this,function(){function e(a,d){var h,e=document.createElement(a||"div");for(h in d)e[h]=d[h];return e}function a(a){for(var d=1,e=arguments.length;e>d;d++)a.appendChild(arguments[d]);return a}function d(a,d,e,h){var g=["opacity",d,~~(100*a),e,h].join("-");e=.01+e/h*100,h=Math.max(1-(1-a)/d*(100-e),a);var f=C.substring(0,C.indexOf("Animation")).toLowerCase();return u[g]||(A.insertRule("@"+(f&&"-"+f+"-"||"")+"keyframes "+g+"{0%{opacity:"+h+"}"+e+"%{opacity:"+a+"}"+(e+.01)+"%{opacity:1}"+(e+d)%100+"%{opacity:"+a+"}100%{opacity:"+h+"}}",A.cssRules.length),u[g]=1),g}function x(a,d){var h,g,e=a.style;for(d=d.charAt(0).toUpperCase()+d.slice(1),g=0;g<F.length;g++)if(h=F[g]+d,void 0!==e[h])return h;return void 0!==e[d]?d:void 0}function s(a,d){for(var e in d)a.style[x(a,e)||e]=d[e];return a}function h(a){for(var d=1;d<arguments.length;d++){var h,e=arguments[d];for(h in e)void 0===a[h]&&(a[h]=e[h])}return a}function g(a){for(var d={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)d.x+=a.offsetLeft,d.y+=a.offsetTop;return d}function f(a,d){return"string"==typeof a?a:a[d%a.length]}function k(a){return"undefined"==typeof this?new k(a):void(this.opts=h(a||{},k.defaults,z))}function p(){function d(a,h){return e("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',h)}A.addRule(".spin-vml","behavior:url(#default#VML)"),k.prototype.lines=function(e,h){function g(){return s(d("group",{coordsize:u+" "+u,coordorigin:-k+" "+-k}),{width:u,height:u})}function p(c,e,t){a(w,a(s(g(),{rotation:360/h.lines*c+"deg",left:~~e}),a(s(d("roundrect",{arcsize:h.corners}),{width:k,height:h.width,left:h.radius,top:-h.width>>1,filter:t}),d("fill",{color:f(h.color,c),opacity:h.opacity}),d("stroke",{opacity:0}))))}var k=h.length+h.width,u=2*k,c=2*-(h.width+h.length)+"px",w=s(g(),{position:"absolute",top:c,left:c});if(h.shadow)for(c=1;c<=h.lines;c++)p(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=h.lines;c++)p(c);return a(e,w)},k.prototype.opacity=function(a,d,e,h){a=a.firstChild,h=h.shadow&&h.lines||0,a&&d+h<a.childNodes.length&&(a=(a=(a=a.childNodes[d+h])&&a.firstChild)&&a.firstChild)&&(a.opacity=e)}}var C,F=["webkit","Moz","ms","O"],u={},A=function(){var d=e("style",{type:"text/css"});return a(document.getElementsByTagName("head")[0],d),d.sheet||d.styleSheet}(),z={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};k.defaults={},h(k.prototype,{spin:function(a){this.stop();var p,u,d=this,h=d.opts,f=d.el=s(e(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),k=h.radius+h.length+h.width;if(a&&(a.insertBefore(f,a.firstChild||null),u=g(a),p=g(f),s(f,{left:("auto"==h.left?u.x-p.x+(a.offsetWidth>>1):parseInt(h.left,10)+k)+"px",top:("auto"==h.top?u.y-p.y+(a.offsetHeight>>1):parseInt(h.top,10)+k)+"px"})),f.setAttribute("role","progressbar"),d.lines(f,d.opts),!C){var D,c=0,w=(h.lines-1)*(1-h.direction)/2,y=h.fps,t=y/h.speed,l=(1-h.opacity)/(t*h.trail/100),X=t/h.lines;!function B(){c++;for(var q=0;q<h.lines;q++)D=Math.max(1-(c+(h.lines-q)*X)%t*l,h.opacity),d.opacity(f,q*h.direction+w,D,h);d.timeout=d.el&&setTimeout(B,~~(1e3/y))}()}return d},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(h,g){function p(a,c){return s(e(),{position:"absolute",width:g.length+g.width+"px",height:g.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/g.lines*k+g.rotate)+"deg) translate("+g.radius+"px,0)",borderRadius:(g.corners*g.width>>1)+"px"})}for(var F,k=0,u=(g.lines-1)*(1-g.direction)/2;k<g.lines;k++)F=s(e(),{position:"absolute",top:1+~(g.width/2)+"px",transform:g.hwaccel?"translate3d(0,0,0)":"",opacity:g.opacity,animation:C&&d(g.opacity,g.trail,u+k*g.direction,g.lines)+" "+1/g.speed+"s linear infinite"}),g.shadow&&a(F,s(p("#000","0 0 4px #000"),{top:"2px"})),a(h,a(F,p(f(g.color,k),"0 0 1px rgba(0,0,0,.1)")));return h},opacity:function(a,d,e){d<a.childNodes.length&&(a.childNodes[d].style.opacity=e)}});var E=s(e("group"),{behavior:"url(#default#VML)"});return!x(E,"transform")&&E.adj?p():C=x(E,"animation"),k}),window.m=window.m||{},function(e,a){var d="undefined";!function(a){e.log=a()}(function(){function e(d,h){var g=d[h];if(g.bind!==a)return d[h].bind(d);if(Function.prototype.bind===a)return s(g,d);try{return Function.prototype.bind.call(d[h],d)}catch(f){return s(g,d)}}function s(a,d){return function(){Function.prototype.apply.apply(a,[d,arguments])}}function h(a){for(var d=0;d<u.length;d++)p[u[d]]=a(u[d])}function g(){return typeof window!==d&&window.document!==a&&window.document.cookie!==a}function f(){try{return typeof window!==d&&window.localStorage!==a}catch(e){return!1}}function k(a){var e,h,d=!1;for(h in p.levels)if(p.levels.hasOwnProperty(h)&&p.levels[h]===a){e=h;break}if(f())try{window.localStorage.mloglevel=e}catch(k){d=!0}else d=!0;d&&g()&&(window.document.cookie="mloglevel="+e+";")}var p={},F=function(){},u=["trace","debug","info","warn","error"],C=/mloglevel=([^;]+)/;return p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.setLevel=function(g){if("number"==typeof g&&g>=0&&g<=p.levels.SILENT)if(k(g),g===p.levels.SILENT)h(function(){return F});else{if(typeof console===d)return h(function(a){return function(){typeof console!==d&&(p.setLevel(g),p[a].apply(p,arguments))}}),"No console available for logging";h(function(h){return g<=p.levels[h.toUpperCase()]?typeof console===d?F:console[h]===a?console.log!==a?e(console,"log"):F:e(console,h):F})}else{if("string"!=typeof g||p.levels[g.toUpperCase()]===a)throw"log.setLevel() called with invalid level: "+g;p.setLevel(p.levels[g.toUpperCase()])}},p.enableAll=function(){p.setLevel(p.levels.TRACE)},p.disableAll=function(){p.setLevel(p.levels.SILENT)},function(){var d;f()&&(d=window.localStorage.mloglevel),d===a&&g()&&(d=(C.exec(window.document.cookie)||[])[1]),p.levels[d]===a&&(d="WARN"),p.setLevel(p.levels[d])}(),p})}(window.m),window.m=window.m||{},function(e,a){function d(a){return(10>a?"0":"")+a}var x={0:["None","U"],1:["Time","sec"],2:["Delay","sec"],3:["Frequency","Hz"],4:["Time code format",""],5:["Distance","m"],6:["Speed","m/s"],7:["Acceleration","m/sec^2"],8:["Jerk","m/sec^3"],9:["Doppler","Hz"],10:["Doppler rate","Hz/sec"],11:["Energy","J"],12:["Power","W"],13:["Mass","g"],14:["Volume","l"],15:["Angular power density","W/ster"],16:["Integrated power density","W/rad"],17:["Spatial power density","W/m^2"],18:["Integrated power density","W/m"],19:["Spectral power density","W/MHz"],20:["Amplitude","U"],21:["Real","U"],22:["Imaginary","U"],23:["Phase","rad"],24:["Phase","deg"],25:["Phase","cycles"],26:["10*Log","U"],27:["20*Log","U"],28:["Magnitude","U"],29:["Unknown","U"],30:["Unknown","U"],31:["General dimensionless",""],32:["Counts",""],33:["Angle","rad"],34:["Angle","deg"],35:["Relative power","dB"],36:["Relative power","dBm"],37:["Relative power","dBW"],38:["Solid angle","ster"],40:["Distance","ft"],41:["Distance","nmi"],42:["Speed","ft/sec"],43:["Speed","nmi/sec"],44:["Speed","knots=nmi/hr"],45:["Acceleration","ft/sec^2"],46:["Acceleration","nmi/sec^2"],47:["Acceleration","knots/sec"],48:["Acceleration","G"],49:["Jerk","G/sec"],50:["Rotation","rps"],51:["Rotation","rpm"],52:["Angular velocity","rad/sec"],53:["Angular velocity","deg/sec"],54:["Angular acceleration","rad/sec^2"],55:["Angular acceleration","deg/sec^2"],60:["Latitude","deg"],61:["Longitude","deg"],62:["Altitude","ft"],63:["Altitude","m"]};e.Mc={colormap:[[{pos:0,red:0,green:0,blue:0},{pos:60,red:50,green:50,blue:50},{pos:100,red:100,green:100,blue:100},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0},{pos:100,red:0,green:0,blue:0}],[{pos:0,red:0,green:0,blue:15},{pos:10,red:0,green:0,blue:50},{pos:31,red:0,green:65,blue:75},{pos:50,red:0,green:85,blue:0},{pos:70,red:75,green:80,blue:0},{pos:83,red:100,green:60,blue:0},{pos:100,red:100,green:0,blue:0}],[{pos:0,red:100,green:100,blue:0},{pos:20,red:0,green:80,blue:40},{pos:30,red:0,green:100,blue:100},{pos:50,red:10,green:10,blue:0},{pos:65,red:100,green:0,blue:0},{pos:88,red:100,green:40,blue:0},{pos:100,red:100,green:100,blue:0}],[{pos:0,red:0,green:75,blue:0},{pos:22,red:0,green:90,blue:90},{pos:37,red:0,green:0,blue:85},{pos:49,red:90,green:0,blue:85},{pos:68,red:90,green:0,blue:0},{pos:80,red:90,green:90,blue:0},{pos:100,red:95,green:95,blue:95}],[{pos:0,red:10,green:0,blue:23},{pos:18,red:34,green:0,blue:60},{pos:36,red:58,green:20,blue:47},{pos:55,red:74,green:20,blue:28},{pos:72,red:90,green:43,blue:0},{pos:87,red:100,green:72,blue:0},{pos:100,red:100,green:100,blue:76}]]},e.PIPESIZE=1048576,e.initialize=function(d,g){var f=new BlueHeader(null);f.version="BLUE",f.size=0,f.type=1e3,f.format="SF",f.timecode=0,f.xstart=0,f.xdelta=1,f.xunits=0,f.subsize=1,f.ystart=0,f.ydelta=1,f.yunits=0,g||(g={});for(var k in g)f[k]=g[k];if(1<f.subsize&&(f.type=2e3),f["class"]=f.type/1e3,2===f["class"]&&g.subsize===a)throw"subsize must be provided with type 2000 files";return g.pipe?(f.pipe=!0,f.in_byte=0,f.out_byte=0,f.buf=new ArrayBuffer(g.pipesize||e.PIPESIZE),f.setData(f.buf),f.data_free=f.dview.length):f.setData(d),f},e.force1000=function(a){2===a["class"]&&(a.size=a.size&&!a.pipe?a.subsize*a.size:0,a.bpe/=a.subsize,a.ape=1)},e.grab=function(d,e,f,k){if(!d.dview)return 0;if("C"===d.format[0]&&(f*=2),k=Math.min(e.length,d.dview.length-f),e.set===a)for(var p=0;k>p;p++)e[p]=d.dview[f+p];else e.set(d.dview.subarray(f,f+k));return"C"===d.format[0]&&(k/=2),k},e.filad=function(a,d,e){if(a.data_free<d.length)throw"Pipe full";var k=a.in_byte/a.dview.BYTES_PER_ELEMENT,p=k+d.length;if(p>a.dview.length){var p=a.dview.length-k,s=d.length-p;d.subarray?(a.dview.set(d.subarray(0,p),k),a.dview.set(d.subarray(p,d.length),0)):(a.dview.set(d.slice(0,p),k),a.dview.set(d.slice(p,d.length),0)),a.in_byte=s*a.dview.BYTES_PER_ELEMENT}else a.dview.set(d,k),a.in_byte=p*a.dview.BYTES_PER_ELEMENT%a.buf.byteLength;if(a.data_free-=d.length,a.onwritelisteners)for(d=0;d<a.onwritelisteners.length;d++)e?a.onwritelisteners[d]():window.setTimeout(a.onwritelisteners[d],0)},e.pavail=function(a){return a.dview.length-a.data_free},e.grabx=function(d,e,f,k){var p=d.dview.length-d.data_free;if(k===a&&(k=0),f){if(f>e.length-k)throw"m.grabx : nget larger then available buffer space"}else f=Math.min(e.length-k,p);if(0>f)throw"m.grabx : nget cannot be negative";if(f>p)return 0;var p=d.out_byte/d.dview.BYTES_PER_ELEMENT,s=p+f;if(s>=d.dview.length){var u=d.dview.length-p,s=s-d.dview.length;e.set(d.dview.subarray(p,d.dview.length),k),e.set(d.dview.subarray(0,s),k+u)}else e.set(d.dview.subarray(p,s),k);return d.out_byte=s*d.dview.BYTES_PER_ELEMENT%d.buf.byteLength,d.data_free+=f,f},e.addPipeWriteListener=function(a,d){a.onwritelisteners||(a.onwritelisteners=[]),-1===a.onwritelisteners.indexOf(d)&&a.onwritelisteners.push(d)},e.units_name=function(a){return a=x[a],a[0]+" ("+a[1]+")"},e.trim_name=function(a){var d=a.indexOf("]");-1===d&&(d=a.indexOf("/")),-1===d&&(d=a.indexOf(":"));var e=a.substr(d+1,a.length).indexOf(".");return 0>e&&(e=a.length-d),a.substr(d+1,d+e+1)},e.label=function(d,e){var f=["Unknown","U"];"string"==typeof d?f=[d,null]:Array.isArray(d)?f=d:(f=x[d],f===a&&(f=["Unknown","U"]));var k="?";return 1e3===e?k="K":.001===e?k="m":1e6===e?k="M":1e-6===e?k="u":1e9===e?k="G":1e-9===e?k="n":1e12===e?k="T":1e-12===e?k="p":1===e&&(k=""),f[1]?f[0]+" ("+k+f[1]+")":f[0]};var s="F";e.vstype=function(a){s=a,"D"===s||"L"===s||"F"===s||"I"===s||"B"===s||alert("Unsupported vector type")},e.vlog10=function(d,e,f){e===a&&(e=1e-20),f===a&&(f=d);for(var k=0;k<d.length&&!(f.length<=k);k++)f[k]=Math.log(Math.max(d[k],e))/Math.log(10)},e.vlogscale=function(d,e,f,k){e===a&&(e=1e-20),f===a&&(f=1),k===a&&(k=d);for(var p=0;p<d.length&&!(k.length<=p);p++)k[p]=Math.log(Math.abs(Math.max(d[p],e)))/Math.log(10),k[p]*=f},e.cvmag2logscale=function(d,e,f,k){e===a&&(e=1e-20),f===a&&(f=1),k===a&&(k=d);for(var p=0,s=0;s<k.length&&(p=2*s+1,!(p>=d.length));s++)k[s]=d[p-1]*d[p-1]+d[p]*d[p],k[s]=Math.log(Math.abs(Math.max(k[s],e)))/Math.log(10),k[s]*=f},e.vsmul=function(d,e,f,k){f===a&&(f=d),k===a&&(k=f.length),k=Math.min(f.length,k),k=Math.min(d.length,k);for(var p=0;k>p&&!(f.length<=p);p++)f[p]=d[p]*e},e.vmxmn=function(a,d){var e=a[0],k=a[0],p=0,s=0;d=Math.min(d,a.length);for(var u=0;d>u;u++)a[u]>e&&(e=a[u],p=u),a[u]<k&&(k=a[u],s=u);return{smax:e,smin:k,imax:p,imin:s}},e.vmov=function(d,e,f,k,p){p===a&&(p=d.length),p=Math.min(d.length,p);for(var s=0;p>s;s++){var u=s*e,C=s*k;if(u>=d.length)break;if(C>=f.length)break;f[C]=d[u]}},e.vfill=function(d,e,f){f===a&&(f=d.length),f=Math.min(d.length,f);for(var k=0;f>k;k++)d[k]=e},e.vabs=function(d,e,f){f===a&&(f=d.length),e===a&&(e=d);for(var k=0;f>k;k++)e[k]=Math.abs(d[k])},e.cvmag=function(d,e,f){f===a&&(f=e.length),f=Math.min(e.length,f);for(var k=0;f>k;k++){var p=2*k+1;if(p>=d.length)break;e[k]=Math.sqrt(d[p-1]*d[p-1]+d[p]*d[p])}},e.cvmag2=function(d,e,f){f===a&&(f=e.length),f=Math.min(e.length,f);for(var k=0,p=0;f>p&&(k=2*p+1,!(k>=d.length));p++)e[p]=d[k-1]*d[k-1]+d[k]*d[k]},e.cvpha=function(d,e,f){f===a&&(f=e.length),f=Math.min(e.length,f);for(var k=0,p=0,s=k=0;f>s&&(k=2*s+1,!(k>=d.length));s++)p=d[k-1],k=d[k],0===p&&0===k&&(p=1),e[s]=Math.atan2(k,p)},e.cvphad=function(d,e,f){f===a&&(f=e.length),f=Math.min(e.length,f);for(var k=0,p=0,s=k=0;f>s&&(k=2*s+1,!(k>=d.length));s++)p=d[k-1],k=d[k],0===p&&0===k&&(p=1),e[s]=Math.atan2(k,p)*(180/Math.PI)},e.trunc=function(a){return a-a%1},e.sign=function(a,d){return d>=0?Math.abs(a):-Math.abs(a)},e.sec2tod=function(a,e){var f="",k=Date.UTC(1950,0,1);Date.UTC(1949,11,31);var p=new Date,f=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),s=new Date(p.getFullYear(),p.getMonth(),p.getDate()+1,0,0,0,0),u=new Date(p.getFullYear(),0,1,0,0,0,0),C=new Date(p.getFullYear()+1,0,1,0,0,0),p=(s-f)/1e3,u=(C-u)/1e3,s=-1*u;return a>=0?p>a?(f=f.getTime()+1e3*a,p=new Date(f),f=d(p.getHours())+":"+d(p.getMinutes())+":"+d(p.getSeconds())):86400===a?f="24:00:00":u>a?(k=a/p,k=[k>0?Math.floor(k):Math.ceil(k)],p=new Date(1e3*a+f.getTime()),f=k.toString()+"::"+d(p.getHours())+":"+d(p.getMinutes())+":"+d(p.getSeconds())):(f=Math.floor(1e3*a)+k,p=new Date(f),f=p.getUTCFullYear()+":"+d(p.getUTCMonth()+1)+":"+d(p.getUTCDate())+"::"+d(p.getUTCHours())+":"+d(p.getUTCMinutes())+":"+d(p.getUTCSeconds())):a>s?(k=a/p,k=0>=k?Math.ceil(k):Math.floor(k),p=new Date(Math.abs(1e3*a)+f.getTime()),k=0===k?"-0":k.toString(),f=k+"::"+d(p.getHours())+":"+d(p.getMinutes())+":"+d(p.getSeconds())):(f=Math.floor(1e3*a)+k,p=new Date(f),f=p.getUTCFullYear()+":"+d(p.getUTCMonth()+1)+":"+d(p.getUTCDate())+"::"+d(p.getUTCHours())+":"+d(p.getUTCMinutes())+":"+d(p.getUTCSeconds())),0!==a%1&&(f+="."+Math.abs(a%1).toPrecision(6).slice(2,8)),e&&(k=f.indexOf("."),u=-1,-1!==k&&(u=f.substr(k,f.length).indexOf("0")),-1!==u&&(f=f.substr(0,k+u))),f},e.sec2tspec=function(a,d,f){return d=d||"",a>=0&&86400>=a?e.sec2tod(a,f):(a%=86400,"delta"!==d&&0>=a?e.sec2tod(a+86400,f):"delta"===d&&0>=a?"-"+e.sec2tod(-1*a,f):e.sec2tod(a,f))},e.sec2tod_j1970=function(a){var e="";return a>=0&&86400>a?(e=new Date(1e3*a),e=d(e.getHours())+":"+d(e.getMinutes())+":"+d(e.getSeconds())):0>a&&a>-31536e3?(e=new Date(1e3*a),e=(a/86400*-1).toString()+"::"+d(e.getHours())+":"+d(e.getMinutes())+":"+d(e.getSeconds())):(e=new Date(1e3*(a-631152e3)),e=e.getFullYear()+":"+d(e.getMonth())+":"+d(e.getDate())+"::"+d(e.getHours())+":"+d(e.getMinutes())+":"+d(e.getSeconds())),0!==a%1&&(e+="."+(a%1).toPrecision(6).slice(2,8)),e},e.throttle=function(a,d){var e=(new Date).getTime();return function(){var k=(new Date).getTime();k-e>=a&&(e=k,d.apply(null,arguments))}}}(window.m),window.mx=window.mx||{},function(e,a,d){function x(){this.ymax=this.ymin=this.xmax=this.xmin=this.yl=this.xl=this.yo=this.xo=0,this.mode=this.func=d}function s(c){this.root=c,this.parent=document.createElement("div"),this.parent.style.position="relative",this.parent.width=c.clientWidth,this.parent.height=c.clientHeight,c.appendChild(this.parent),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.width=c.clientWidth,this.canvas.height=c.clientHeight,this.parent.appendChild(this.canvas),this.active_canvas=this.canvas,this.wid_canvas=document.createElement("canvas"),this.wid_canvas.style.position="absolute",this.wid_canvas.style.top="0px",this.wid_canvas.style.left="0px",this.wid_canvas.style.zIndex=1,this.wid_canvas.width=c.clientWidth,this.wid_canvas.height=c.clientHeight,this.parent.appendChild(this.wid_canvas),this.level=this.text_h=this.text_w=0,this.width=this.parent.width,this.height=this.parent.height,this.ymrk=this.xmrk=this.ypos=this.xpos=0,this.origin=1,this.stk=[new e.STKSTRUCT],e.setbgfg(this,"black","white"),this.warpbox=this.event_cb=d,this.rmode=!1,this.linewidth=1,this.style=d,this.xi=!1,this.l=this.state_mask=this.button_press=this.button_release=0,this.r=this.width,this.t=0,this.b=this.height,this.scrollbar_x=new e.SCROLLBAR,this.scrollbar_y=new e.SCROLLBAR,this.prompt=d,this.pixel=[],this._renderCanvas=document.createElement("canvas")
}function h(c,a,d,e,t,l,f){return d>=t?f>d&&(e-a)*(f-d)-(l-a)*(t-d)>0&&(c+=1):d>=f&&0>(e-a)*(f-d)-(l-a)*(t-d)&&(c-=1),c}function g(c,a){a.animationFrameHandle||(a.animationFrameHandle=requestAnimFrame(e.withWidgetLayer(c,function(){e.erase_window(c),a.animationFrameHandle=d;var D=1.5*c.text_h;a.x=Math.max(a.x,0),a.y=Math.max(a.y,0),a.x=Math.min(a.x,c.width-a.w),a.y=Math.min(a.y,c.height-a.h);var y=a.x+G.GBorder+Math.max(0,G.sidelab),t=a.y+G.GBorder+G.toplab*(D+G.GBorder),l=a.w-2*G.GBorder-Math.abs(G.sidelab);e.widgetbox(c,a.x,a.y,a.w,a.h,y,t,l,a.h-2*G.GBorder-G.toplab*(D+G.GBorder),a.title);var f=c.wid_canvas.getContext("2d");f.lineWidth=1,f.strokeStyle=c.xwbs,f.beginPath(),f.moveTo(y,t-4+.5),f.lineTo(y+l-1,t-4+.5),f.stroke(),f.strokeStyle=c.xwts,f.beginPath(),f.moveTo(y,t-3+.5),f.lineTo(y+l-1,t-3+.5),f.stroke();for(var h=0;h<a.items.length;h++){var B=a.items[h],q=t+D*h;"separator"===B.style?(f.fillStyle=c.xwbs,f.fillRect(y,q,l,D),f.beginPath(),f.moveTo(y,q+.5),f.lineTo(y+l,q+.5),f.stroke(),f.textBaseline="middle",f.textAlign="left",f.fillStyle=c.xwfg,f.fillText(" "+B.text+" ",y+2*c.text_w,q+D/2)):(e.LEGACY_RENDER?(f.fillStyle=c.xwlo,f.fillRect(y,q,l,D),f.beginPath(),f.moveTo(y,q+.5),f.lineTo(y+l,q+.5),f.stroke(),B.selected&&e.shadowbox(c,y-1,q,l+2,D,1,2,"",.75)):(f.save(),f.globalAlpha=.75,f.fillStyle=B.selected?c.xwts:c.xwlo,f.fillRect(y,q,l,D),f.restore(),f.strokeStyle=c.bg,f.beginPath(),f.moveTo(y,q+.5),f.lineTo(y+l,q+.5),f.stroke()),f.textBaseline="middle",f.textAlign="left",f.fillStyle=c.xwfg,"checkbox"===B.style?(f.fillText(" "+B.text+" ",y+2*c.text_w,q+D/2),f.strokeStyle=c.xwfg,f.strokeRect(y+1+c.text_w,q+(D-c.text_w)/2,c.text_w,c.text_w),B.checked&&(f.beginPath(),f.moveTo(y+1+c.text_w,q+(D-c.text_w)/2),f.lineTo(y+1+c.text_w+c.text_w,q+(D-c.text_w)/2+c.text_w),f.stroke(),f.beginPath(),f.moveTo(y+1+c.text_w+c.text_w,q+(D-c.text_w)/2),f.lineTo(y+1+c.text_w,q+(D-c.text_w)/2+c.text_w),f.stroke())):(f.fillText(" "+B.text+" ",y,q+D/2),B.checked&&(f.beginPath(),f.moveTo(y+1,q+c.text_h/4),f.lineTo(y+1+c.text_w-2,q+c.text_h/4+c.text_h/2),f.lineTo(y+1,q+c.text_h/4+c.text_h),f.lineTo(y+1,q+c.text_h/4),f.fill())))}})))}function f(c,a){e.onWidgetLayer(c,function(){e.erase_window(c)}),c.menu=d,c.widget=null;for(var D=0;D<a.items.length;D++){var y=a.items[D];if(y.selected){y.handler?y.handler():y.menu&&(D=y.menu,"function"==typeof y.menu&&(D=y.menu()),D.finalize=a.finalize,e.menu(c,D));break}}!c.menu&&a.finalize&&a.finalize()}function k(c,a){e.onWidgetLayer(c,function(){e.erase_window(c)}),c.menu=d,c.widget=null,!c.menu&&a.finalize&&a.finalize()}function p(c,a,d){var t,e=!0;return t=a/c,c>0?t>d.tL?e=!1:t>d.tE&&(d.tE=t):0>c?t<d.tE?e=!1:t<d.tL&&(d.tL=t):a>0&&(e=!1),e}function F(c,a,d,e,t,l,f,h){if(0>a&&(a=0),0>d&&(d=0),0>e&&(e=0),0>t&&(t=0),h&&(c.lineWidth=h),f&&(c.strokeStyle=f),1===c.lineWidth%2&&(a===e&&(e=a=Math.floor(a)+.5),d===t&&(t=d=Math.floor(d)+.5)),l&&l.mode){if("dashed"===l.mode){if(dashOn(c,l.on,l.off))c.beginPath(),c.moveTo(a,d),c.lineTo(e,t),c.stroke(),dashOff(c);else if(c.beginPath(),d===t)for(t=Math.min(a,e),e=Math.max(a,e);e>t;)c.moveTo(t,d),c.lineTo(t+l.on,d),c.stroke(),t+=l.on+l.off;else{if(a!==e)throw"Only horizontal or vertical dashed lines are supported";for(e=Math.min(d,t),t=Math.max(d,t);t>e;)c.moveTo(a,e),c.lineTo(a,e+l.on),c.stroke(),e+=l.on+l.off}c.beginPath()}else if("xor"===l.mode)if("undefined"==typeof Uint8ClampedArray)c.beginPath(),c.moveTo(a,d),c.lineTo(e,t),c.stroke(),c.beginPath();else{if(f=l=0,d===t)l=Math.abs(e-a),f=h,a=Math.min(a,e);else{if(a!==e)throw"Only horizontal and vertical lines can be drawn with XOR";l=h,f=Math.abs(t-d),d=Math.min(d,t)}if(0!==l&&0!==f){for(a=Math.floor(a),d=Math.floor(d),e=c.getImageData(a,d,l,f),t=e.data,l=0,h=t.length;h>l;l+=4)t[l]=255-t[l],t[l+1]=255-t[l+1],t[l+2]=255-t[l+2],t[l+3]=255;c.putImageData(e,a,d),c.clearRect(0,0,1,1)}}}else c.beginPath(),c.moveTo(a,d),c.lineTo(e,t),c.stroke(),c.beginPath()}function u(c,a,d,e,t){C(c,a,t),d&&(c.strokeStyle=d),e&&(c.fillStyle=e),c.fill(),c.closePath()}function C(c,a,d){if(!(1>a.length)){var e=a[0].x,t=a[0].y;for(c.lineWidth=d?d:1,c.beginPath(),c.moveTo(e,t),d=0;d<a.length;d++)e=a[d].x,t=a[d].y,c.lineTo(e,t)}}function A(c){return Math.floor(Math.round(c/100*255))}function z(c,a,d){return"rgb("+Math.round(c)+", "+Math.round(a)+", "+Math.round(d)+")"}function E(c,a){var d,e;if(".000000"===c.substring(5,8))d=4;else for(d=c.length-1;"0"===c[d];)d-=1;for(e=0;" "===c[e]&&(d-e+1>5||a);)e+=1;return d=c.substring(e,d+1),-1===d.indexOf(".")&&(d+="."),d}function K(c){c._animationFrameHandle=d;var a=c.warpbox;if(c.active_canvas.getContext("2d"),a&&c.xpos>=a.xmin&&c.xpos<=a.xmax&&c.ypos>=a.ymin&&c.ypos<=a.ymax){a.xl=c.xpos,a.yl=c.ypos;var D=Math.min(a.xo,a.xl),y=Math.min(a.yo,a.yl),t=Math.abs(a.xl-a.xo),l=Math.abs(a.yl-a.yo);0!==t&&0!==l&&("vertical"===a.mode?(D=c.l,t=c.r-c.l):"horizontal"===a.mode&&(y=c.t,l=c.b-c.t),e.onWidgetLayer(c,function(){e.erase_window(c),e.draw_box(c,"xor",D,y,t,l,a.style.opacity,a.style.fill_color)}))}}function Q(c,a,d){return a>c?a:c>d?d:c}function U(c,a,e,y,t,l,f,h,B,q,r,v,n){q===d&&(q=0),r===d&&(r=0),v===d&&(v=e.width-q),n===d&&(n=e.height-r),c._renderCanvas.width=e.width,c._renderCanvas.height=e.height;for(var H=c._renderCanvas.getContext("2d"),I=H.createImageData(c._renderCanvas.width,c._renderCanvas.height),g=new Uint8Array(e),k=0;k<e.height;++k)for(var p=0;p<e.width;++p){var s=4*(k*e.width+p);I.data[s]=g[s],I.data[s+1]=g[s+1],I.data[s+2]=g[s+2],I.data[s+3]=255}H.putImageData(I,0,0),a.save(),a.globalAlpha=y,t||(a.imageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1),a.drawImage(c._renderCanvas,q,r,v,n,l,f,h,B),a.restore()}function O(c,a,e,y,t,l,f,h,g,q,r,v,n){if(q===d&&(q=0),r===d&&(r=0),v===d&&(v=e.width-q),n===d&&(n=e.height-r),32768>e.width&&32768>e.height){c._renderCanvas.width=e.width,c._renderCanvas.height=e.height;var H=c._renderCanvas.getContext("2d"),I=H.createImageData(c._renderCanvas.width,c._renderCanvas.height);e=new Uint8ClampedArray(e),I.data.set(e),H.putImageData(I,0,0)}else 32768>v&&32768>n?(c._renderCanvas.width=v,c._renderCanvas.height=n,P(c._renderCanvas,e,q,r,v,n)):(c._renderCanvas.width=Math.min(2*h,e.width),c._renderCanvas.height=Math.min(2*g,e.height),P(c._renderCanvas,e,q,r,v,n),v=c._renderCanvas.width,n=c._renderCanvas.height),r=q=0;a.save(),a.globalAlpha=y,t||(a.imageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1),a.drawImage(c._renderCanvas,q,r,v,n,l,f,h,g),a.restore()}function P(c,a,d,e,t,l){var f=new Uint32Array(a);t||(t=a.width),l||(l=a.height),d||(d=0),e||(e=0);var h=c.width,g=c.height;c=c.getContext("2d");var q=c.createImageData(h,g),r=new ArrayBuffer(q.data.length),v=new Uint8ClampedArray(r),r=new Uint32Array(r);t/=h,l/=g;for(var n=0,H=0,g=n=0;g<r.length;g++)n=Math.round(Math.floor(g%h)*t)+d,H=Math.round(Math.floor(g/h)*l)+e,n=Math.floor(H*a.width+n),r[g]=f[n];q.data.set(v),c.putImageData(q,0,0)}e.XW_INIT=-3,e.XW_DRAW=1,e.XW_EVENT=2,e.XW_UPDATE=3,e.XW_COMMAND=5,e.SB_EXPAND=1,e.SB_SHRINK=2,e.SB_FULL=3,e.SB_STEPINC=4,e.SB_STEPDEC=5,e.SB_PAGEINC=6,e.SB_PAGEDEC=7,e.SB_DRAG=8,e.SB_WHEELUP=9,e.SB_WHEELDOWN=10,e.L_ArrowLeft=1001,e.L_ArrowRight=1002,e.L_ArrowUp=1003,e.L_ArrowDown=1004,e.L_dashed=801,e.GBorder=3,e.L_RModeOff=900,e.L_RModeOn=901,e.L_PixelSymbol=1,e.L_CircleSymbol=2,e.L_SquareSymbol=3,e.L_PlusSymbol=4,e.L_XSymbol=5,e.L_TriangleSymbol=6,e.L_ITriangleSymbol=7,e.L_HLineSymbol=8,e.L_VLineSymbol=9,e.LEGACY_RENDER=!1,e.STKSTRUCT=function(){this.y2=this.x2=this.y1=this.x1=this.yscl=this.xscl=this.ymax=this.ymin=this.xmax=this.xmin=0},e.SCROLLBAR=function(){this.repeat_count=this.origin=this.mxevent=this.arrow=this.a2=this.a1=this.soff=this.swmin=this.sw=this.s1=this.h=this.w=this.y=this.x=this.repeat_pause=this.initial_pause=this.dragoutline=this.scale=this.page=this.step=this.trange=this.tmin=this.srange=this.smin=this.action=this.flag=null},e.open=function(c){return c=new s(c),c.wid_canvas.oncontextmenu=function(c){return c.preventDefault(),!1},this._ctx=c.active_canvas.getContext("2d"),c.onmousemove=function(c){return function(a){var f=a.target.getBoundingClientRect();c.x=a.x||a.clientX,c.y=a.y||a.clientY,c.xpos=a.offsetX===d?a.pageX-f.left-window.scrollX:a.offsetX,c.ypos=a.offsetX===d?a.pageY-f.top-window.scrollY:a.offsetY,c.warpbox&&(c.warpbox.style=(a.ctrlKey||a.metaKey)&&c.warpbox.alt_style!==d?c.warpbox.alt_style:c.warpbox.def_style,e.redraw_warpbox(c)),e.widget_callback(c,a)}}(c),c.onmouseup=function(c){return function(a){if(c.warpbox){e.onWidgetLayer(c,function(){e.erase_window(c)});var f=c.warpbox;if(c.warpbox=d,1===a.which&&f.func){var t=f.xo,l=f.yo,h=f.xl,g=f.yl;"vertical"===f.mode?(t=c.l,h=c.r):"horizontal"===f.mode&&(l=c.t,g=c.b),f.func(a,t,l,h,g,f.style.return_value)}}e.widget_callback(c,a)}}(c),c.onmousedown=function(c){return function(a){return a.preventDefault(),e.widget_callback(c,a),!1}}(c),c.onkeydown=function(c){return function(a){if(c.warpbox){var d=getKeyCode(a);17!==d&&224!==d&&91!==d&&93!==d||c.warpbox.style===c.warpbox.alt_style||(c.warpbox.style=c.warpbox.alt_style,e.redraw_warpbox(c))}e.widget_callback(c,a)}}(c),c.onkeyup=function(c){return function(a){c.warpbox&&(a=getKeyCode(a),17!==a&&224!==a&&91!==a&&93!==a||c.warpbox.style===c.warpbox.def_style||(c.warpbox.style=c.warpbox.def_style,e.redraw_warpbox(c)))}}(c),c.ontouchend=function(c){return function(){c.onmouseup({which:1})}}(c),c.ontouchmove=function(c){return function(a){var f=c.canvas,t=0,l=0;if(f.offsetParent!==d)do t+=f.offsetLeft,l+=f.offsetTop;while(f=f.offsetParent);c.xpos=a.targetTouches[0].pageX-t,c.ypos=a.targetTouches[0].pageY-l,e.redraw_warpbox(c)}}(c),e.enableListeners(c),c},e.enableListeners=function(c){e.addEventListener(c,"mousemove",c.onmousemove,!1),window.addEventListener("mouseup",c.onmouseup,!1),e.addEventListener(c,"mousedown",c.onmousedown,!1),window.addEventListener("keydown",c.onkeydown,!1),window.addEventListener("keyup",c.onkeyup,!1)},e.disableListeners=function(c){e.removeEventListener(c,"mousemove",c.onmousemove,!1),window.removeEventListener("mouseup",c.onmouseup,!1),e.removeEventListener(c,"mousedown",c.onmousedown,!1),window.removeEventListener("keydown",c.onkeydown,!1),window.removeEventListener("keyup",c.onkeyup,!1)},e.addEventListener=function(c,a,d,e){return c.wid_canvas.addEventListener(a,d,e)},e.removeEventListener=function(c,a,d,e){return c.wid_canvas.removeEventListener(a,d,e)},e.dispatchEvent=function(c,a){return c.wid_canvas.dispatchEvent(a)},e.onWidgetLayer=function(c,a){e.onCanvas(c,c.wid_canvas,a)},e.onCanvas=function(c,a,d){var e=c.active_canvas;c.active_canvas=a;try{if(d)return d()}finally{c.active_canvas=e}},e.withWidgetLayer=function(c,a){return function(){e.onWidgetLayer(c,a)}},e.render=function(c,a){if(a){var e=c.active_canvas;e._animationFrameHandle||(e._animationFrameHandle=requestAnimFrame(function(){e._animationFrameHandle=d,a()}))}},e.fullscreen=function(c,a){a===d&&(a=!c.fullscreen),a?(c.fullscreen={position:c.root.style.position,height:c.root.style.height,width:c.root.style.width,left:c.root.style.left,top:c.root.style.top,zIndex:c.root.style.zIndex},c.root.style.position="fixed",c.root.style.height="100%",c.root.style.width="100%",c.root.style.left="0px",c.root.style.top="0px",c.root.style.zIndex=16777271):(c.root.style.position=c.fullscreen.position,c.root.style.height=c.fullscreen.height,c.root.style.width=c.fullscreen.width,c.root.style.left=c.fullscreen.left,c.root.style.top=c.fullscreen.top,c.root.style.zIndex=c.fullscreen.zIndex,c.fullscreen=d),e.checkresize(c)},e.checkresize=function(c){var a=c.canvas;return a.height!==c.root.clientHeight||a.width!==c.root.clientWidth?(c.height=c.root.clientHeight,c.width=c.root.clientWidth,c.canvas.height=c.height,c.canvas.width=c.width,c.wid_canvas.height=c.height,c.wid_canvas.width=c.width,!0):!1},e.invertbgfg=function(c){e.setbgfg(c,c.fg,c.bg,!c.xi)},e.mixcolor=function(c,a,d){c=tinycolor(c).toRgb(),a=tinycolor(a).toRgb();var e=1-d;return a.r=c.r*e+a.r*d,a.g=c.g*e+a.g*d,a.b=c.b*e+a.b*d,tinycolor(a).toHexString(!0)},e.linear_gradient=function(c,a,d,e,f,l){var h=c.active_canvas.getContext("2d");for(c=1/l.length,a=h.createLinearGradient(a,d,e,f),d=0;d<l.length-1;d++)a.addColorStop(c*d,l[d]);return a.addColorStop(1,l[l.length-1]),a},e.setbgfg=function(c,a,d,f){c.bg=tinycolor(a).toHexString(),c.fg=tinycolor(d).toHexString(),c.xi=tinycolor(f).toHexString(),tinycolor.equals(c.bg,"black")&&tinycolor.equals(c.fg,"white")?(c.xwfg=c.fg,c.xwbg="rgb(35%,35%,30%)",c.xwts="rgb(60%,60%,55%)",c.xwbs="rgb(25%,25%,20%)",c.xwms=e.mixcolor(c.xwts,c.xwbs,.5),c.xwlo="rgb(15%,15%,10%)",c.hi=c.xwts):tinycolor.equals(c.bg,"white")&&tinycolor.equals(c.fg,"black")?(c.xwfg=c.fg,c.xwbg="rgb(60%,60%,55%)",c.xwts="rgb(80%,80%,75%)",c.xwbs="rgb(40%,40%,35%)",c.xwms=e.mixcolor(c.xwts,c.xwbs,.5),c.xwlo="rgb(70%,70%,65%)",c.hi=c.xwbs):(a=tinycolor(c.bg).toRgb(),127.5<Math.sqrt(.299*a.r*a.r+.587*a.g*a.g+.114*a.b*a.b)?(c.xwfg="black",c.xwbg="rgb(60%,60%,55%)",c.xwts="rgb(80%,80%,75%)",c.xwbs="rgb(40%,40%,35%)",c.xwms=e.mixcolor(c.xwts,c.xwbs,.5),c.xwlo="rgb(70%,70%,65%)",c.hi=c.xwts):(c.xwfg="white",c.xwbg="rgb(35%,35%,30%)",c.xwts="rgb(60%,60%,55%)",c.xwbs="rgb(25%,25%,20%)",c.xwms=e.mixcolor(c.xwts,c.xwbs,.5),c.xwlo="rgb(15%,15%,10%)",c.hi=c.xwbs))},e.settheme=function(c,a){c.bg=a.bg,c.fg=a.fg,c.xi=a.xi,c.xwfg=a.xwfg,c.xwbg=a.xwbg,c.xwts=a.xwts,c.xwbs=a.xwbs,c.xwlo=a.xwlo,c.hi=a.hi},e.close=function(c){var a=c.wid_canvas;a.removeEventListener("mousemove",c.onmousemove,!1),a.removeEventListener("mouseup",c.onmouseup,!1),c.parent&&c.parent.parentNode&&c.parent.parentNode.removeChild(c.parent)},e.scrollbar=function(c,a,f,y,t,l,h,g,B,q,r){var v,n,H,I=0,k=new e.SCROLLBAR;switch(v=a.flag!==d?a.flag:a,n=Math.abs(v),H=l-t>y-f?3>c.origin?2:4:2&c.origin?3:1,10>n&&(a=k),(10>n||0===a.action)&&(e.scroll(c,a,e.XW_INIT,d,r),a.flag=v,a.initial_pause=-1,e.scroll_loc(a,f,t,y-f+1,l-t+1,H,r)),a.srange=h.pe-h.ps,n){case 0:f=y=t=1;break;case 1:case 11:f=y=.9*a.srange,t=2;break;case 2:case 12:f=.1*a.srange,y=9*f,t=2;break;case 3:case 13:f=1,y=a.srange-1,t=1;break;default:return 0}return e.scroll_vals(a,h.ps,a.srange,g,B-g,f,y,t,r),0===v?e.scroll(c,a,e.XW_DRAW,d,d):e.scroll(c,a,e.XW_EVENT,q,r)&&(h.ps!==a.smin&&(h.ps=a.smin,I+=1),h.pe!==a.smin+a.srange&&(h.pe=a.smin+a.srange,I+=2)),I},e.scroll=function(c,a,f,y,t){var l;if(a===d)return!1;switch(f){case e.XW_INIT:e.scroll_loc(a,0,0,c.width,20,1,t),e.scroll_vals(a,0,10,0,100,1,10,1,t),a.flag=0,a.action=0,a.initial_pause=.25,a.repeat_pause=.05,a.mxevent=!0,a.repeat_count=0;break;case e.XW_EVENT:if(l=0,a.mxevent)l=c.button_release?-c.button_release:c.button_press;else if("mousedown"===y.type||"mouseup"===y.type){switch(y.which){case 1:l=1;break;case 2:l=2;break;case 3:l=3;break;case 4:l=4;break;case 5:l=5}"mouseup"===y.type&&(l=-l)}else("mousewheel"===y.type||"DOM-MouseScroll"===y.type)&&(y.wheelDelta&&0<y.wheelDelta?l=4:y.wheelDelta&&0>y.wheelDelta&&(l=5));if(0===a.action){if((4===l||5===l)&&(c.xpos=a.x),1!==l&&2!==l&&4!==l&&5!==l||c.xpos<a.x||c.ypos<a.y||c.xpos>a.x+a.w||c.ypos>a.y+a.h)return!1}else if(0>l){a.action=a.repeat_count=0;break}if(1&a.origin?(y=c.xpos-a.x,2&a.origin&&(y=a.w-y)):(y=c.ypos-a.y,2>=a.origin&&(y=a.h-y)),0===a.action){a.repeat_count=0;var h=e.scroll_real2pix(a);if(a.s1=t.s1=h.s1,a.sw=t.sw=h.sw,a.soff=t.soff=y-a.s1,0===a.trange)a.smin=t.smin=a.tmin,a.srange=t.srange=0;else switch(l){case 1:a.action=y>a.a1&&y<a.a2?0<a.soff?e.SB_PAGEINC:e.SB_PAGEDEC:0<a.soff?e.SB_STEPINC:e.SB_STEPDEC;break;case 4:a.action=e.SB_WHEELUP;break;case 5:a.action=e.SB_WHEELDOWN}}else switch(a.action){case e.SB_WHEELUP:case e.SB_WHEELDOWN:case e.SB_EXPAND:case e.SB_SHRINK:case e.SB_FULL:a.action=a.repeat_count=0}case e.XW_COMMAND:switch(l=a.smin,y=a.srange,a.action){case e.SB_STEPINC:l+=a.step;break;case e.SB_STEPDEC:l-=a.step;break;case e.SB_PAGEINC:l+=a.page;break;case e.SB_PAGEDEC:l-=a.page;break;case e.SB_FULL:l=a.tmin,y=a.trange;break;case e.SB_EXPAND:y*=a.scale,l=0>=l&&0<=l+a.srange?l*a.scale:l-(y-a.srange)/2;break;case e.SB_SHRINK:y/=a.scale,l=0>l&&0<=l+a.srange?l+y/a.scale:0===l&&0<=l+a.srange?y/a.scale:l+(a.srange-y)/2;break;case e.SB_WHEELUP:l-=a.page;break;case e.SB_WHEELDOWN:l+=a.page}0<a.trange?(l=Math.max(a.tmin,Math.min(l,a.tmin+a.trange-y)),y=Math.min(y,a.trange)):(l=Math.min(a.tmin,Math.max(l,a.tmin+a.trange-y)),y=Math.max(y,a.trange)),a.smin===l&&a.srange===y?a.action!==e.SB_DRAG&&(a.action=a.repeat_count=0):(a.smin=t.smin=l,a.srange=t.srange=y,a.repeat_count++),f===e.XW_COMMAND&&(e.scroll(c,a,e.XW_UPDATE,d),a.action=0);break;case e.XW_DRAW:case e.XW_UPDATE:e.redrawScrollbar(a,c,f)}return!0},e.scroll_loc=function(c,w,f,y,t,l,h){c!==d&&(c.x=h.x=w,c.y=h.y=f,c.w=h.w=y,c.h=h.h=t,c.origin=h.origin=Math.max(1,Math.min(4,l)),1&c.origin?(c.a2=h.a2=c.w,c.arrow=h.arrow=Math.min(a.trunc((c.w-a.trunc(2*e.GBorder))/3),c.h+e.GBorder)):(c.a2=h.a2=c.h,c.arrow=h.arrow=Math.min(a.trunc((c.h-a.trunc(2*e.GBorder))/3),c.w+e.GBorder)),c.a1=h.a1=c.arrow+e.GBorder,c.a2-=c.arrow+e.GBorder,h.a2-=c.arrow+e.GBorder,c.swmin=h.swmin=Math.min(10,c.a2-c.a1),c.s1=h.s1=0,c.sw=h.sw=0,c.action=h.action=0)},e.scroll_vals=function(c,a,e,f,t,l,h,g,B){c!==d&&(c.smin=B.smin=a,c.srange=B.srange=e,c.tmin=B.tmin=f,c.trange=B.trange=t,c.step=B.step=l,c.page=B.page=h,c.scale=B.scale=Math.max(g,1))},e.draw_symbol=function(c,a,d,f,t,l){var h=new Int32Array(new ArrayBuffer(4)),g=new Int32Array(new ArrayBuffer(4));h[0]=d,g[0]=f,e.draw_symbols(c,a,h,g,1,t,l)},e.draw_symbols=function(c,d,f,y,t,l,h){for(var g=c.active_canvas.getContext("2d"),B=0,q=0,r=0,v=0,n=0,n=!1,H=[],B=0;4>B;B++)H[B]={x:0,y:0};switch(v="",n=0>h,q=Math.abs(h),r=2*q,g.fillStyle=d,g.strokeStyle=d,l){case e.L_CircleSymbol:for(B=0;t>B;B++)H=f[B],c=y[B],g.beginPath(),n?(g.arc(H,c,q,0,360),g.fill()):(g.arc(H,c,q,0,360),g.stroke());break;case e.L_SquareSymbol:if(n)for(B=0;t>B;B++)g.fillRect(f[B]-q,y[B]-q,r,r);else for(B=0;t>B;B++)g.strokeRect(f[B]-q,y[B]-q,r,r);break;case e.L_PixelSymbol:for(r=1,B=0;t>B;B+=r)g.beginPath(),g.arc(f[B],y[B],1,0,2*Math.PI,!0),g.fill();break;case e.L_ITriangleSymbol:q=-q;case e.L_TriangleSymbol:for(r=a.trunc(1.5*q),v=a.trunc(.8*q),H[1].x=-v,H[1].y=r,H[2].x=2*v,H[2].y=0,H[3].x=-v,H[3].y=-r,c=[],B=0;4>B;B++)c[B]={x:0,y:0};if(n)for(B=0;t>B;B++)c[0].x=f[B],c[0].y=y[B]-q,c[1].x=c[0].x+H[1].x,c[1].y=c[0].y+H[1].y,c[2].x=c[1].x+H[2].x,c[2].y=c[1].y+H[2].y,c[3].x=c[2].x+H[3].x,c[3].y=c[2].y+H[3].y,u(g,c);else for(B=0;t>B;B++)c[0].x=f[B],c[0].y=y[B]-q,c[1].x=c[0].x+H[1].x,c[1].y=c[0].y+H[1].y,c[2].x=c[1].x+H[2].x,c[2].y=c[1].y+H[2].y,c[3].x=c[2].x+H[3].x,c[3].y=c[2].y+H[3].y,n=g,C(n,c,void 0),n.stroke(),n.closePath();break;case e.L_PlusSymbol:for(B=0;t>B;B++)v=f[B],n=y[B],F(g,v,n+q,v,n-q),F(g,v+q,n,v-q,n);break;case e.L_HLineSymbol:for(B=0;t>B;B++)v=f[B],n=y[B],F(g,v+q,n,v-q,n);break;case e.L_VLineSymbol:for(B=0;t>B;B++)v=f[B],n=y[B],F(g,v,n+q,v,n-q);break;case e.L_XSymbol:for(B=0;t>B;B++)v=f[B],n=y[B],F(g,v-q,n-q,v+q,n+q),F(g,v+q,n-q,v-q,n+q);break;default:if(v=l,q=a.trunc(c.text_w/2),n)for(B=0;t>B;B++)g.fillText(v.substring(0,2),f[B]-q,y[B]+q)}},e.trace=function(c,w,f,y,t,l,g,k,B,q){if(f===d||y===d)throw"mx.trace requires xpoint and ypoint";if(l===d&&(l=1),g===d&&(g=1),k===d&&(k=0),B===d&&(B=0),q===d&&(q={}),0>=t)a.log.warn("No points to draw");else if(0===g&&0===k)a.log.warn("No line or symbol to draw");else{var r;q.dashed&&(r={mode:"dashed",on:4,off:4});var v=e.origin(c.origin,4,c.stk[c.level]);if(0!==v.xscl&&0!==v.yscl){var n=v.x1,H=v.y1,I=v.xmin,J=1/v.xscl,s=v.ymin,u=1/v.yscl;q.noclip||e.clip(c,n,H,v.x2-n+1,v.y2-H+1);var z=Math.abs(v.xmax-v.xmin),R=Math.abs(v.ymax-v.ymin),N=Math.min(v.xmin,v.xmax),v=Math.min(v.ymin,v.ymax),W=N+z,F=v+R,A=4*Math.ceil(2*f.length),C=new Int32Array(new ArrayBuffer(A)),A=new Int32Array(new ArrayBuffer(A)),x=0;if(0===g){for(var E=l-1;t>=E;E+=l){var G=f[E],L=y[E],K=G>=N&&W>=G&&L>=v&&F>=L;K&&(C[x]=Math.round((G-I)*J)+n,A[x]=Math.round((L-s)*u)+H,x+=1)}0!==k&&x>1&&e.draw_symbols(c,w,C.subarray(0),A.subarray(0),x,k,B)}else if(!0===q.vertsym){for(E=l-1;t>=E;E+=l)G=f[E],L=y[E],G>=N&&W>=G&&(g=Math.round((G-I)*J)+n,e.draw_line(c,w,g,0,g,c.height),L>=v&&F>=L&&(C[x]=g,A[x]=Math.round((L-s)*u)+H,x+=1));0!==k&&x>1&&e.draw_symbols(c,w,C.subarray(0),A.subarray(0),x,k,B)}else if(!0===q.horzsym){for(E=l-1;t>=E;E+=l)G=f[E],L=y[E],L>=v&&F>=L&&(g=Math.round((L-s)*u)+H,e.draw_line(c,w,0,g,c.width,g),G>=N&&W>=G&&(C[x]=Math.round((G-I)*J)+n,A[x]=g,x+=1));0!==k&&x>1&&e.draw_symbols(c,w,C.subarray(0),A.subarray(0),x,k,B)}else{var O;if(q&&q.highlight){for(O=[],O.push({start:n,color:w}),E=0;E<q.highlight.length;E++)q.highlight[E].xstart>=W||q.highlight[E].xend<=N||(L=Math.max(q.highlight[E].xstart,N),G=Math.min(q.highlight[E].xend,W),G>L&&(L=Math.round((L-I)*J)+n,G=Math.round((G-I)*J)+n,O.push({start:L,end:G,color:q.highlight[E].color})));O.sort(function(c,a){return c.start-a.start})}else O=w;var P,Q=(c.stk[c.level].xmax+c.stk[c.level].xmin)/2,T=(c.stk[c.level].ymax+c.stk[c.level].ymin)/2,G=f[0],L=y[0];P=h(0,Q,T,c.stk[c.level].xmin,c.stk[c.level].ymin,G,L),(K=G>=N&&W>=G&&L>=v&&F>=L)?(C[x]=Math.round((G-I)*J)+n,A[x]=Math.round((L-s)*u)+H,x+=1,0!==k&&e.draw_symbols(c,w,C,A,1,k,B)):x=0;for(var S=0,U=!1,E=l;l*(t-1)>=E;E+=l)if(z=G,R=L,G=f[E],L=y[E],P=h(P,Q,T,z,R,G,L),U=G>=N&&W>=G&&L>=v&&F>=L,K&&U)C[x]=Math.round((G-I)*J)+n,A[x]=Math.round((L-s)*u)+H,x+=1;else if(K=U,z-=G,R-=L,0!==z||0!==R){var V={tL:1,tE:0};p(z,N-G,V)&&p(-z,G-W,V)&&p(R,v-L,V)&&p(-R,L-F,V)&&(1>V.tL&&(C[x]=Math.round((G-I+V.tL*z)*J)+n,A[x]=Math.round((L-s+V.tL*R)*u)+H,x+=1),0<V.tE?(C[x]=Math.round((G-I+V.tE*z)*J)+n,A[x]=Math.round((L-s+V.tE*R)*u)+H,x+=1,e.draw_lines(c,O,C.subarray(S,x),A.subarray(S,x),x-S,g,r),0!==k&&x-S>2&&e.draw_symbols(c,w,C.subarray(S+1,x),A.subarray(S+1,x),x-S-1,k,B),S=x):(C[x]=Math.round((G-I)*J)+n,A[x]=Math.round((L-s)*u)+H,x+=1))}P=h(P,Q,T,G,L,c.stk[c.level].xmax,c.stk[c.level].ymin),P=h(P,Q,T,c.stk[c.level].xmax,c.stk[c.level].ymin,c.stk[c.level].xmin,c.stk[c.level].ymin),x-S>0&&(e.draw_lines(c,O,C.subarray(S,x),A.subarray(S,x),x-S,g,r),U&&(S+=1),0!==k&&x-S>1&&e.draw_symbols(c,w,C.subarray(S,x),A.subarray(S,x),x-1,k,B)),q.fillStyle&&(x>1||0!==P)&&e.fill_trace(c,q.fillStyle,C,A,x)}q.noclip||e.clip(c,0,0,0,0)}}},e.draw_mode=function(c,a,e){c.linewidth=a===d?1:a,c.style=e},e.draw_line=function(c,e,f,y,t,l,h,g){var k=c.active_canvas.getContext("2d");h===d&&(h=c.linewidth),g===d&&(g=c.style),"number"==typeof e&&(c.pixel&&0!==c.pixel.length?(e=Math.max(0,Math.min(c.pixel.length,e)),e=z(c.pixel[e].red,c.pixel[e].green,c.pixel[e].blue)):(a.log.warn("COLORMAP not initialized, defaulting to foreground"),e=c.fg)),F(k,f,y,t,l,g,e,h)},e.rubberline=function(c,a,d,e,f){c=c.active_canvas.getContext("2d"),F(c,a,d,e,f,{mode:"xor"},"white",1)},e.fill_trace=function(c,a,d,f,t){var l=c.active_canvas.getContext("2d");if(l.fillStyle=Array.isArray(a)?e.linear_gradient(c,0,0,0,c.b-c.t,a):a,1>t)l.fillRect(c.l,c.t,c.r-c.l,c.b-c.t);else if(a){a=d[0];var h=f[0];l.beginPath(),h===c.t?l.lineTo(c.l,c.t):l.lineTo(c.l,c.b),l.lineTo(a,h);for(var g=1;t>g;g++)a=d[g],h=f[g],l.lineTo(a,h);h===c.t&&l.lineTo(c.r,c.t),l.lineTo(c.r,c.b),f[0]===c.t&&l.lineTo(c.l,c.b),l.closePath(),l.fill()}},e.draw_lines=function(c,e,f,h,t,l,g){var k=c.active_canvas.getContext("2d");if(!(1>t)){var B=f[0],q=h[0];for(l===d&&(l=c.linewidth),g===d&&(g=c.style),g&&"dashed"===g.mode&&(dashOn(k,g.on,g.off)||a.log.warn("WARNING: Dashed lines aren't supported on your browser")),k.lineWidth=l,c=0,"string"==typeof e?e=[{start:0,color:e}]:e instanceof Array||(e.start===d&&(e.start=0),e=[e]),l=0;l<e.length;l++)null!=e[l].end&&e[l].end<B?e.remove(l):e[l].start<B&&(c=l);for(k.strokeStyle=e[c].color,k.beginPath(),k.moveTo(B,q),l=0;t>l;l++)if(B!==f[l]||q!==h[l]){if(B=f[l],q=h[l],g=!1,c>0&&null!=e[c].end&&e[c].end<B)for(g=!0;null!=e[c].end&&e[c].end<B&&(e.remove(c),c-=1,0!==c););if(c+1<e.length&&e[c+1].start<=B)for(g=!0;c+1<e.length&&e[c+1].start<=B;)c++;k.lineTo(B,q),g&&(k.stroke(),k.strokeStyle=e[c].color,k.beginPath(),k.lineTo(B,q))}k.stroke(),dashOff(k),k.beginPath()}},e.clip=function(c,a,d,e,f){c=c.active_canvas.getContext("2d"),0===a&&0===d&&0===e&&0===f?c.restore():(c.save(),c.beginPath(),c.rect(a,d,e,f),c.clip())},e.clear_window=function(c){var a=c.active_canvas.getContext("2d");a.fillStyle=c.bg,a.fillRect(0,0,c.width,c.height)},e.erase_window=function(c){c.active_canvas.getContext("2d").clearRect(0,0,c.width,c.height)},e.rubberbox=function(c,a,d,f,t){e.warpbox(c,c.xpos,c.ypos,c.xpos,c.ypos,0,c.width,0,c.width,a,d,f,t)},e.warpbox=function(c,a,d,e,f,l,g,h,k,q,r,v,n){v||(v={}),c.warpbox=new x,c.warpbox.xo=a,c.warpbox.yo=d,c.warpbox.xl=e,c.warpbox.yl=f,c.warpbox.xmin=l,c.warpbox.xmax=g,c.warpbox.ymin=h,c.warpbox.ymax=k,c.warpbox.func=q,c.warpbox.mode=r,c.warpbox.style=v,c.warpbox.def_style=v,c.warpbox.alt_style=n},e.origin=function(c,a,d){c=Math.max(1,c),a=Math.max(1,a);var f=new e.STKSTRUCT;if(f.xmin=d.xmin,f.xmax=d.xmax,f.ymin=d.ymin,f.ymax=d.ymax,f.xscl=d.xscl,f.yscl=d.yscl,f.x1=d.x1,f.y1=d.y1,f.x2=d.x2,f.y2=d.y2,c!==a){var t=Math.abs(a-c);c=a+c,(2===t||5!==c)&&(f.xmin=d.xmax,f.xmax=d.xmin,f.xscl=-d.xscl),(2===t||5===c)&&(f.ymin=d.ymax,f.ymax=d.ymin,f.yscl=-d.yscl)}return f},e.mult=function(c,a){var d=Math.max(Math.abs(c),Math.abs(a));if(0===d)return 1;var e=.1447648*Math.log(d),e=e|e;return 1>d&&(e-=1),0>e?1/Math.pow(10,-3*e):Math.pow(10,3*e)},e.widget_callback=function(c,a){c.prompt&&3===a.which&&c.prompt.input.onsubmit(),c.widget&&c.widget.callback(a)},e.prompt=function(c,a,f,g,t,l,h,k,B){if(l!==d&&(t=f(l),!t.valid))throw"Prompt default input value not valid due to '"+t.reason+"'";e.onWidgetLayer(c,function(){var q=c.active_canvas.getContext("2d"),r=q.font.indexOf("px"),v=r+3,r=q.font.substr(0,r),q=q.font.substr(v,q.font.length).toString(),q=new CanvasInput({height:c.text_h,fontFamily:q,fontSize:new Number(r),backgroundColor:c.bg,fontColor:c.fg,borderWidth:0,borderRadius:0,padding:0,boxShadow:"none",innerShadow:"none",width:30*c.text_w,value:l!==d?l.toString():"",disableBlur:!0,renderOnReturn:!1,tabToClear:!0}),n=function(a,q){return function(){var r=this.value(),n=f(r);n.valid?(c.prompt=d,this.cleanup(),e.onWidgetLayer(c,function(){e.erase_window(c)}),g(r)):(e.message(c,"Value: '"+r+"' isn't valid due to '"+n.reason+"' - RETRY",d,a,q),setTimeout(function(){e.onWidgetLayer(c,function(){e.erase_window(c)}),c.widget=null},null!=B?B:4e3))}},v=function(c,a,d){return function(q,r){e.onWidgetLayer(c,function(){var v=(d.length+2)*c.text_w,f=v+31*c.text_w+6,w=2*c.text_h+6;q||(q=c.xpos),r||(r=c.ypos);var t=Math.max(0,Math.min(q,c.width-f)),l=Math.max(0,Math.min(r,c.height-w)),g=t+3,h=l+3,D=h+1.5*c.text_h,y=g+c.text_w;e.widgetbox(c,t,l,f,w,g,h,0,""),e.text(c,y,D,d),f=D-1.15*c.text_h,a.x(g+c.text_w+v-c.text_w),a.y(f),a.onsubmit(n(t,f-75)),a.canvas()?a.render():a.canvas(c.active_canvas)})}}(c,q,a);v(h,k),q.focus(),c.prompt={redraw:v,input:q}})},e.floatValidator=function(c,a){return(a!==d&&!1!==a||""!==c)&&isNaN(parseFloat(c))||!isFinite(c)?{valid:!1,reason:"Failed float validation: not a valid floating point number"}:{valid:!0,reason:""}},e.intValidator=function(c,a){return(a===d||!1===a)&&""===c||parseFloat(c)===parseInt(c,10)&&!isNaN(c)?{valid:!0,reason:""}:{valid:!1,reason:"Failed integer validation: not a valid integer"}},e.message=function(c,a,d,f,t,l){e.onWidgetLayer(c,function(){e.render_message_box(c,a,f,t),c.widget={type:l||"ONESHOT",callback:function(a){("mousedown"===a.type||"keydown"===a.type)&&(c.widget=null,e.onWidgetLayer(c,function(){e.erase_window(c)}))}}})},e.render_message_box=function(c,a,d,f){var g,t=a.split(/\r\n|\r|\n/g),l=0;if(1===t.length){if(l=Math.min((c.width-6)/c.text_w-2,a.length),0>=l)return;for(;l>40&&2.5*c.text_h*a.length<c.height*l;)l-=5;var h=0,k=0,q=0,r=0,v=0,n=0,t=[];for(g=!0;k<a.length;){for(var v=k+l-1,n=v=Math.min(v,a.length-1),H=!1,h=k;v>=h&&!H;h++)switch(a[h]){case",":case";":case" ":case":":n=h;break;case"-":case"/":n!==h-1&&(n=h);break;case"@":case"\n":case"\r":g=!1,H=!0,n=h}h===a.length&&(n=v),H?t.push(a.substring(k,n)):(h=a.substring(k,n+1).replace(/^\s+/,""),t.push(h)),k=n+1,r=Math.max(r,t[q].length)}}else for(q=0;q<t.length;q++)l=Math.min((c.width-6)/c.text_w-2,Math.max(l,t[q].length));for(r=t.length,r>6&&(g=!1),h=0,q=Math.max(1,c.height/c.text_h),a=Math.min(r,h+q-1),l=(l+2)*c.text_w+6,r=(a-h+1)*c.text_h+6,d||(d=c.xpos),f||(f=c.ypos),d=Math.max(c.l,Math.min(d,c.r-l)),q=Math.max(c.t,Math.min(f,c.b-r)),f=d+3,n=q+3,e.widgetbox(c,d,q,l,r,f,n,0,""),r=n+c.text_h/3,q=f+c.text_w;a>h;)r+=c.text_h,g&&(q=d+l/2-t[h].length*c.text_w/2),e.text(c,q,r,t[h]),h++},e.draw_round_box=function(c,a,e,f,t,l,h,g,k){c=c.active_canvas.getContext("2d"),k||(k=5),c.beginPath(),c.moveTo(e+k,f),c.lineTo(e+t-k,f),c.quadraticCurveTo(e+t,f,e+t,f+k),c.lineTo(e+t,f+l-k),c.quadraticCurveTo(e+t,f+l,e+t-k,f+l),c.lineTo(e+k,f+l),c.quadraticCurveTo(e,f+l,e,f+l-k),c.lineTo(e,f+k),c.quadraticCurveTo(e,f,e+k,f),c.closePath(),c.lineWidth=1,c.strokeStyle=a,c.stroke(),h!==d&&h>0&&(e=c.globalAlpha,c.globalAlpha=h,c.fillStyle=g?g:a,c.fill(),c.globalAlpha=e)},e.draw_box=function(c,a,e,f,t,l,h,g){var k=c.active_canvas.getContext("2d");if("xor"!==a)k.lineWidth=1,k.strokeStyle=a,k.strokeRect(e,f,t,l);else if("undefined"==typeof Uint8ClampedArray)k.lineWidth=1,k.strokeStyle=c.fg,k.strokeRect(e,f,t,l);else{e=Math.floor(e),f=Math.floor(f),t=Math.floor(t),l=Math.floor(l),c=c.canvas.getContext("2d");for(var q=c.getImageData(e,f,t,1),r=q.data,v=0;v<q.data.length;v++)r[4*v]=255-r[4*v],r[4*v+1]=255-r[4*v+1],r[4*v+2]=255-r[4*v+2],r[4*v+3]=255;for(k.putImageData(q,e,f),q=c.getImageData(e,f+l,t,1),r=q.data,v=0;v<q.data.length;v++)r[4*v]=255-r[4*v],r[4*v+1]=255-r[4*v+1],r[4*v+2]=255-r[4*v+2],r[4*v+3]=255;for(k.putImageData(q,e,f+l),q=c.getImageData(e,f,1,l),r=q.data,v=0;l>v;v++)r[4*v]=255-r[4*v],r[4*v+1]=255-r[4*v+1],r[4*v+2]=255-r[4*v+2],r[4*v+3]=255;for(k.putImageData(q,e,f),q=c.getImageData(e+t,f,1,l),r=q.data,v=0;l>v;v++)r[4*v]=255-r[4*v],r[4*v+1]=255-r[4*v+1],r[4*v+2]=255-r[4*v+2],r[4*v+3]=255;k.putImageData(q,e+t,f)}h!==d&&h>0&&(c=k.globalAlpha,k.globalAlpha=h,k.fillStyle=g?g:a,k.fillRect(e+1,f+1,t-1,l-1),k.globalAlpha=c)},e.set_font=function(c,a){var d=c.canvas.getContext("2d"),e=c.wid_canvas.getContext("2d");if(c.font&&c.font.width===a)d.font=c.font.font,e.font=c.font.font;else{var f=1;do{f+=1,d.font=f+"px Courier New, monospace",e.font=f+"px Courier New, monospace";var l=d.measureText("M");c.text_w=l.width,c.text_h=f}while(c.text_w<a);c.font={font:f+"px Courier New, monospace",width:a}}},e.textline=function(c,a,d,e,f,l){var h=c.active_canvas.getContext("2d");l||(l={}),l.color||(l.color=c.fg),l.width||(l.width=1),F(h,a,d,e,f,l,l.color,l.width)},e.tics=function(c,a,d,e){var f=1,l=c;return a===c?{dtic:1,dtic1:c}:(f=Math.abs(a-c)/d,d=Math.max(f,1e-36),d=Math.log(d)/Math.log(10),0>d?(d=Math.ceil(d),d-=1):d=Math.floor(d),f*=Math.pow(10,-d),d=Math.pow(10,d),l=f*d,e&&l>=5&&5140800>=l?(e=17.5>l?5:37.5>l?15:270>l?60:1050>l?300:2250>l?900:7200>l?3600:16200>l?10800:32400>l?21600:129600>l?43200:518400>l?86400:604800,f=Math.round(l/e)*e):f=1.75>f?d:2.25>f?2*d:3.5>f?2.5*d:7>f?5*d:10*d,0===f&&(f=1),a>=c?(e=Math.floor(c>=0?c/f+.995:c/f-.005),l=e*f):(e=Math.floor(c>=0?c/f+.005:c/f-.995),l=e*f,f*=-1),l+f===l&&(f=a-c),{dtic:f,dtic1:l})},e.drawaxis=function(c,f,h,g,t,l){var k=e.origin(c.origin,1,c.stk[c.level]),p=0,s=0,q=0,r=0,v=0,n=0;g=g===d?30:g,t=t===d?30:t,l.exactbox?(p=Math.floor(k.x1),s=Math.floor(k.y1),q=Math.floor(k.x2),r=Math.floor(k.y2),v=q-p,n=r-s):(p=Math.max(Math.floor(k.x1)-2,0),s=Math.max(Math.floor(k.y1)-2,0),q=Math.min(Math.floor(k.x2)+2,c.width),r=Math.min(Math.floor(k.y2)+2,c.height),v=q-p-4,n=r-s-4);var H=c.active_canvas.getContext("2d");H.fillStyle=l.fillStyle?Array.isArray(l.fillStyle)?e.linear_gradient(c,0,0,0,r-s,l.fillStyle):l.fillStyle:c.bg,H.fillRect(p,s,q-p,r-s),l.noaxisbox||(e.textline(c,p,s,q,s),e.textline(c,q,s,q,r),e.textline(c,q,r,p,r),e.textline(c,p,r,p,s));var I=!1;4===g&&(I=!0),H=!1,4===t&&(H=!0);var J={dtic:0,dtic1:0},M={dtic:0,dtic1:0};0>f?(J.dtic1=k.xmin,J.dtic=(k.xmin-k.xmax)/f):J=e.tics(k.xmin,k.xmax,f,I);var u=1;I||(u=e.mult(k.xmin,k.xmax)),0>h?(M.dtic1=k.ymin,M.dtic=(k.ymin-k.ymax)/h):M=e.tics(k.ymin,k.ymax,h,H),f=1,H||(f=e.mult(k.ymin,k.ymax));
var x=!l.noxtlab;h=!l.noytlab;var z,F,R=Math.max(0,p-4*c.text_w),N=0,N=l.ontop?Math.min(c.height,Math.floor(r+1.5*c.text_h)):Math.max(c.text_h,Math.floor(s-.5*c.text_h));N>0&&(l.noyplab||(F=a.label(t,f)),l.noxplab||(z=a.label(g,u))),z&&F?e.text(c,R,N,F+" vs "+z):z?e.text(c,R,N,z):F&&e.text(c,R,N,F),g=5.5*c.text_w,t=0,t=l.ontop?l.inside?s+1*c.text_h:s-.2*c.text_h:l.inside?r-.5*c.text_h:r+1*c.text_h+2,v=k.xmin!==k.xmax?v/(k.xmax-k.xmin):v/1,u=0!==u?1/u:1,z=Math.min(12,Math.round(v*J.dtic)/c.text_w),F=1;var A="";if(x)if(I)A=a.sec2tod(J.dtic1),F=A.length*c.text_w<(q-p)/2;else for(var C,N=J.dtic1;N<=k.xmax;N+=J.dtic){if(A=e.format_f(N*u,z,z/2),A===C){F=0;break}C=A}for(0===J.dtic&&(J.dtic=k.xmax-J.dtic1+1),R=0,A="",N=J.dtic1;N<=k.xmax;N+=J.dtic)if(C=p+Math.round(v*(N-k.xmin))+2,!(p>C)&&(l.grid&&"y"!==l.grid?(l.gridStyle||(l.gridStyle=e.LEGACY_RENDER?{mode:"dashed",on:1,off:3}:{color:c.xwms,mode:"dashed",on:1,off:3}),e.textline(c,C,r,C,s,l.gridStyle)):(e.textline(c,C,r-2,C,r+2),e.textline(c,C,s-2,C,s+2)),x))if(F){if(A=null,I?C>R&&(A=a.sec2tod(N,!0),R=C+c.text_w*(A.length+1)):(A=e.format_f(N*u,z,z/2),A=E(A,!0)),A){var G=Math.round(A.length/2)*c.text_w;l.inside&&(C=Math.max(p+G,C),C=Math.min(q-G,C)),e.text(c,C-G,t,A)}}else N===J.dtic1&&(I?(A=a.sec2tod(N,!0),l.inside&&(C=Math.floor(Math.max(p+g,C))),e.text(c,C-g,t,A+" + "+a.sec2tod(J.dtic))):(A=(J.dtic1*u).toString(),l.inside&&(C=Math.floor(Math.max(p+g,C))),e.text(c,C-g,t,A+" + "+J.dtic*u)));for(g=l.yonright?l.inside?Math.min(q-6*c.text_w,c.width-5*c.text_w):Math.min(q+c.text_w,c.width-5*c.text_w):l.inside?Math.max(0,p+c.text_w):Math.max(0,Math.floor(p-5.5*c.text_w)),t=.4*c.text_h,v=k.ymin!==k.ymax?-n/(k.ymax-k.ymin):-n/1,u=0!==f?1/f:1,n=k.ymax>=k.ymin?function(c){return c<=k.ymax}:function(c){return c>=k.ymax},J=M.dtic1;n(J);J+=M.dtic)C=r+Math.round(v*(J-k.ymin))-2,C>r||(l.grid&&"x"!==l.grid?(l.gridStyle||(l.gridStyle={mode:"dashed",on:1,off:3}),e.textline(c,p,C,q,C,l.gridStyle)):(e.textline(c,p-2,C,p+2,C),e.textline(c,q-2,C,q+2,C)),!h||l.inside&&(C<s+c.text_h||C>r-2*c.text_h)||(H?(I=a.sec2tod(J),f=C+t-c.text_h,x=I.indexOf("::"),-1!==x&&(f>s&&r>f&&e.text(c,g,f,I.substring(0,x)),x+=1),e.text(c,g,Math.min(r,C+t),I.substring(x+1,x+6)),f=C+t+c.text_h,f>s&&r>f&&"00"!==I.substring(x+7,x+9)&&(I+=".00",e.text(c,g,f,I.substring(x+7,x+12)))):(I=e.format_f(J*u,12,6),I=E(I,l.inside),e.text(c,g,Math.min(r,C+t),I))))},e.inrect=function(c,a,d,e,f,l){return c>=d&&d+f>=c&&a>=e&&e+l>=a};var G={GBorder:3,sidelab:0,toplab:1};e.menu=function(c,a){var h=1.5*c.text_h;if(a){if(!c.widget){a.x=c.xpos,a.y=c.ypos,a.val=0,a.h=2*G.GBorder+h*a.items.length+G.toplab*(h+G.GBorder)-1,a.y=a.y-((G.toplab+Math.max(1,a.val)-.5)*h+(1+G.toplab)*G.GBorder)+1;for(var p=a.title.length,t=0,l=0;l<a.items.length;l++){var s=a.items[l],p=Math.max(p,s.text.length);"checkbox"===s.style&&(p+=2),"separator"===s.style&&(p+=2),s.checked&&"checkbox"!==s.style&&(t=h*l)}a.y-=t,p=(p+2)*c.text_w,a.w=2*G.GBorder+Math.abs(G.sidelab)+p-1,a.x-=a.w/2,c.menu=a,c.widget={type:"MENU",callback:function(l){var h=a;if(l===d)g(c,h);else if("mousemove"===l.type){h.drag_x!==d&&h.drag_y!==d&&2<Math.abs(c.xpos-h.drag_x)&&2<Math.abs(c.ypos-h.drag_y)&&(h.x+=c.xpos-h.drag_x,h.y+=c.ypos-h.drag_y,h.drag_x=c.xpos,h.drag_y=c.ypos);var q=h.x+G.GBorder+Math.max(0,G.sidelab),r=h.w-2*G.GBorder-Math.abs(G.sidelab),v=1.5*c.text_h,n=h.y+G.GBorder+G.toplab*(v+G.GBorder);for(l=0;l<h.items.length;l++){var H=n+v*l,t=h.items[l];t.selected=!1,e.inrect(c.xpos,c.ypos,q,H,r,v)&&(t.selected=!0)}g(c,h)}else if("mouseup"===l.type)h.drag_x=d,h.drag_y=d;else if("mousedown"===l.type)l.preventDefault(),1===l.which?c.xpos>h.x&&c.xpos<h.x+h.w&&c.ypos>h.y&&c.ypos<h.y+1.5*c.text_h?(h.drag_x=c.xpos,h.drag_y=c.ypos):f(c,h):k(c,h);else if("keydown"===l.type&&c.menu)if(h=c.menu,l.preventDefault(),l=getKeyCode(l),13===l)f(c,h);else if(38===l){for(l=0;l<h.items.length;l++){if(t=h.items[l],t.selected){t.selected=!1,h.items[l-1]!==d&&(h.items[l-1].selected=!0);break}l===h.items.length-1&&(t.selected=!0)}g(c,h)}else if(40===l){for(l=0;l<h.items.length;l++){if(t=h.items[l],t.selected){t.selected=!1,h.items[l+1]!==d&&(h.items[l+1].selected=!0);break}l===h.items.length-1&&(h.items[0].selected=!0)}g(c,h)}else if(l>=48&&57>=l||l>=65&&90>=l){for(l=String.fromCharCode(l).toUpperCase(),h.keypresses=h.keypresses===d?l:h.keypresses+l,l=q=0;l<h.items.length;l++)t=h.items[l],t.selected=!1,t.text&&0===t.text.toUpperCase().indexOf(h.keypresses)&&(0===q&&(t.selected=!0),q++);0===q?(h.keypresses=d,g(c,h)):1===q?f(c,h):g(c,h)}}}}g(c,a)}},e.widgetbox=function(a,d,f,h,g,l,k,p,s,q){e.shadowbox(a,d,f,h,g,1,2,"",.75),q&&(g=q.length,g=Math.min(g,h/a.text_w),g=Math.max(g,1),d+=(h-g*a.text_w)/2,f+=3,e.text(a,d,f+(k-f+.7*a.text_h)/2,q,a.xwfg)),p>0&&s>0&&(f=a.active_canvas.getContext("2d"),e.LEGACY_RENDER?(f.fillStyle=a.bg,f.fillRect(l,k,p,s)):(f.save(),f.globalAlpha=.1,f.fillStyle=a.bg,f.fillRect(l,k,p,s),f.restore()))},e.text=function(a,e,f,h,g){var l=a.active_canvas.getContext("2d");if(e=Math.max(0,e),f=Math.max(0,f),0>e||0>f)throw"On No!";l.textBaseline="bottom",l.textAlign="left",l.font=a.font.font,l.fillStyle=g===d?a.fg:g,l.fillText(h,e,f)},e.getcolor=function(a,d,e){for(a=0;6>a&&0===d[a+1].pos;a++);for(;e>d[a].pos&&6>a;)a++;if(0===a||e>=d[a].pos)return z(A(d[a].red),A(d[a].green),A(d[a].blue));e=A((e-d[a-1].pos)/(d[a].pos-d[a-1].pos)*100);var f=255-e;return z(d[a].red/100*e+d[a-1].red/100*f,d[a].green/100*e+d[a-1].green/100*f,d[a].blue/100*e+d[a-1].blue/100*f)},e.redraw_warpbox=function(a){a.warpbox&&(a._animationFrameHandle&&cancelAnimFrame(a._animationFrameHandle),a._animationFrameHandle=requestAnimFrame(function(){K(a)}))},e.format_g=function(a,d,f,h){Math.min(d,f+7),d=Math.abs(a).toString();var g=d.indexOf(".");-1===g&&(d+=".",g=d.length),h=0;var l=d.indexOf("e");-1!==l&&(h=parseInt(d.slice(l+1,d.length),10),d=d.slice(0,l));for(var l=Math.min(f-(d.length-g)+1,f),k=0;l>k;k++)d+="0";if(0!==a)if(1>Math.abs(a))if("0."===d.slice(0,2))for(k=2;k<d.length;k++){if("0"!==d[k]){d="0."+d.slice(k,k+f);break}h-=1}else d=d.slice(0,f+2);else g>f?(h=Math.max(0,g-1),d=d[0]+"."+d.slice(1,f+1)):d=d.slice(0,f+2);return 0===h?d+="    ":(f=e.pad(Math.abs(h).toString(),2,"0"),d=0>h?d+"E-"+f:d+"E+"+f),0>a?"-"+d:" "+d},e.format_f=function(a,d,f){return a=a.toFixed(f).toString(),a=e.pad(a,d+f," ")},e.pad=function(a,d,e){for(;a.length<d;)a=e+a;return a},e.legacy_shadowbox=function(c,d,f,h,g,l,k,p){for(var s=p.length,q=0,r=0,q=0,r=[],v=0;11>v;v++)r[v]={x:0,y:0};if(v=!(1===k||-1===k),0!==k&&0<e.GBorder&&(q=a.trunc(Math.min(h,g)/3),q=Math.max(1,Math.min(q,e.GBorder))),q>0){switch(r[0].x=r[1].x=d,r[8].x=r[9].x=d+h,r[1].y=r[8].y=f,r[0].y=r[9].y=f+g,l){case e.L_ArrowLeft:r[0].y=r[1].y=f+a.trunc(g/2),d+=2,--h;break;case e.L_ArrowRight:r[8].y=r[9].y=f+a.trunc(g/2),--d,--h;break;case e.L_ArrowUp:r[1].x=r[8].x=d+a.trunc(h/2),f+=2,--g;break;case e.L_ArrowDown:r[0].x=r[9].x=d+a.trunc(h/2),--f,--g}r[2]=r[8],r[10]=r[0],d+=q,f+=q,h-=2*q,g-=2*q}switch(r[4].x=r[5].x=d,r[3].x=r[6].x=d+h,r[3].y=r[4].y=f,r[5].y=r[6].y=f+g,l){case e.L_ArrowLeft:r[4].y=r[5].y=f+a.trunc(g/2);break;case e.L_ArrowRight:r[3].y=r[6].y=f+a.trunc(g/2);break;case e.L_ArrowUp:r[3].x=r[4].x=d+a.trunc(h/2);break;case e.L_ArrowDown:r[5].x=r[6].x=d+a.trunc(h/2)}r[7]=r[3],l=c.active_canvas.getContext("2d"),q>0&&(l.fillStyle=k>0?c.xwts:c.xwbs,u(l,r.slice(0,7)),l.fillStyle=0>k?c.xwts:c.xwbs,u(l,r.slice(5,11))),v&&(l.fillStyle=c.xwbg,u(l,r.slice(3,8))),l.fillStyle=c.xwfg,l.textBaseline="alphabetic",v&&s>0&&(s=Math.min(s,a.trunc(h/c.text_w)),s=Math.max(s,1),q=d+a.trunc((h-s*c.text_w)/2),r=f+a.trunc((g+.7*c.text_h)/2),l.fillText(p,q,r))},e.sigplot_shadowbox=function(c,d,f,h,g,l,k,p,s){var q=c.active_canvas.getContext("2d"),r=p.length,v=0>k?c.xwts:c.xwbs;s=s||1;for(var n=[],H=0;11>H;H++)n[H]={x:0,y:0};switch(l){case e.L_ArrowLeft:case e.L_ArrowRight:case e.L_ArrowUp:case e.L_ArrowDown:n=e.chevron(l,d,f,h,g),q.fillStyle=k>0?c.xwts:c.xwbs,u(q,n.slice(0,6));break;default:e.draw_round_box(c,v,d,f,h,g,s,c.xwbg,5,c.xwbs)}q.fillStyle=c.xwfg,q.textBaseline="alphabetic",1!==k&&-1!==k&&r>0&&(r=Math.min(r,a.trunc(h/c.text_w)),r=Math.max(r,1),d+=a.trunc((h-r*c.text_w)/2),c=f+a.trunc((g+.7*c.text_h)/2),q.fillText(p,d,c))},e.shadowbox=e.LEGACY_RENDER?e.legacy_shadowbox:e.sigplot_shadowbox,e.chevron=function(c,d,f,h,g,l){var k=Math.min(h,g);l||(l=.25*k);for(var p=[],s=0;6>s;s++)p[s]={x:0,y:0};var s=a.trunc((h-k)/2+k/4-l/2.828),q=a.trunc((g-k)/2+k/4-l/2.828);switch(c){case e.L_ArrowLeft:p[0].x=d+s,p[0].y=f+a.trunc(k/2),p[1].x=d+s+a.trunc(k/2),p[1].y=f,p[2].x=d+s+a.trunc(k/2+l/1.414),p[2].y=f+a.trunc(l/1.414),p[3].x=d+s+a.trunc(2*l/1.414),p[3].y=f+a.trunc(k/2),p[4].x=d+s+a.trunc(k/2+l/1.414),p[4].y=f+g-a.trunc(l/1.414),p[5].x=d+s+a.trunc(k/2),p[5].y=f+k;break;case e.L_ArrowRight:p[0].x=d+h-s,p[0].y=f+a.trunc(k/2),p[1].x=d+h-s-a.trunc(k/2),p[1].y=f,p[2].x=d+h-s-a.trunc(k/2+l/1.414),p[2].y=f+a.trunc(l/1.414),p[3].x=d+h-s-a.trunc(2*l/1.414),p[3].y=f+a.trunc(k/2),p[4].x=d+h-s-a.trunc(k/2+l/1.414),p[4].y=f+g-a.trunc(l/1.414),p[5].x=d+h-s-a.trunc(k/2),p[5].y=f+k;break;case e.L_ArrowUp:p[0].x=d+a.trunc(k/2),p[0].y=f+q,p[1].x=d,p[1].y=f+q+a.trunc(k/2),p[2].x=d+a.trunc(l/1.414),p[2].y=f+q+a.trunc(k/2+l/1.414),p[3].x=d+a.trunc(k/2),p[3].y=f+q+a.trunc(2*l/1.414),p[4].x=d+h-a.trunc(l/1.414),p[4].y=f+q+a.trunc(k/2+l/1.414),p[5].x=d+k,p[5].y=f+q+a.trunc(k/2);break;case e.L_ArrowDown:p[0].x=d+a.trunc(k/2),p[0].y=f+g-q,p[1].x=d,p[1].y=f+g-q-a.trunc(k/2),p[2].x=d+a.trunc(l/1.414),p[2].y=f+g-q-a.trunc(k/2+l/1.414),p[3].x=d+a.trunc(k/2),p[3].y=f+g-q-a.trunc(2*l/1.414),p[4].x=d+h-a.trunc(l/1.414),p[4].y=f+g-q-a.trunc(k/2+l/1.414),p[5].x=d+k,p[5].y=f+g-q-a.trunc(k/2)}return p},e.ifevent=function(a,e){a.button_press=0,a.button_release=0,a.state_mask=0;var f=e.target.getBoundingClientRect(),h=e.offsetX===d?e.pageX-f.left-window.scrollX:e.offsetX,f=e.offsetX===d?e.pageY-f.top-window.scrollY:e.offsetY;switch(e.type){case"mousedown":switch(a.xpos=Q(h,0,a.width),a.ypos=Q(f,0,a.height),e.which){case 1:a.button_press=1;break;case 2:a.button_press=2;break;case 3:a.button_press=3;break;case 4:a.button_press=4;break;case 5:a.button_press=5}break;case"mouseup":switch(a.xpos=Q(h,0,a.width),a.ypos=Q(f,0,a.height),e.which){case 1:a.button_release=1;break;case 2:a.button_release=2;break;case 3:a.button_release=3;break;case 4:a.button_release=4;break;case 5:a.button_release=5}}},e.scroll_real2pix=function(a){if(0===a.range)return{s1:a.a1,sw:a.a2-a.a1};var d,e;return d=(a.a2-a.a1)/a.trange,e=a.a1+Math.floor(.5+(a.smin-a.tmin)*d),d=e+Math.floor(.5+a.srange*d),e=e>a.a2-a.swmin?a.a2-a.swmin:Math.max(e,a.a1),d=d<a.a1+a.swmin?a.a1+a.swmin:Math.min(d,a.a2),{s1:e,sw:Math.max(d-e,a.swmin)}},e.redrawScrollbar=function(c,d,f){var h,g,l,k,p,s,q,r,v=d.active_canvas.getContext("2d");g=e.scroll_real2pix(c),q=g.s1,r=g.sw,s=q,g=c.x,l=c.y,k=c.w,p=c.h,1&c.origin?(h=l+p/2,2&c.origin&&(s=k-s-r),f===e.XW_DRAW&&(f=c.arrow,e.shadowbox(d,g,l,f,p-1,e.L_ArrowLeft,2,"",0),e.shadowbox(d,g+k-f,l,f-1,p,e.L_ArrowRight,2,"",0)),e.LEGACY_RENDER?(e.draw_line(d,d.fg,g+c.a1,h,g+c.a2,h),e.shadowbox(d,g+s,l,r+1,p,1,2,"",0)):(f=v.createLinearGradient(g+c.a1,0,g+c.a2,0),f.addColorStop(0,d.xwbs),f.addColorStop(.5,d.xwts),f.addColorStop(1,d.xwbs),e.draw_line(d,f,g+c.a1,h,g+c.a2,h,1),f=v.createLinearGradient(0,l,0,l+p),f.addColorStop(.1,d.xwts),f.addColorStop(.75,d.xwbs),e.draw_round_box(d,d.xwbg,g+s,l,r+1,p,1,f,8,d.xwbs))):(h=g+a.trunc(k/2),2>=c.origin&&(s=p-s-r),f===e.XW_DRAW&&(f=c.arrow,e.shadowbox(d,g,l,k-1,f,e.L_ArrowUp,2,"",0),e.shadowbox(d,g,l+p-f,k-1,f,e.L_ArrowDown,2,"",0)),e.LEGACY_RENDER?(e.draw_line(d,d.fg,h,l+c.a1,h,l+c.a2),e.shadowbox(d,g,l+s,k,r+1,1,2,"",0)):(f=v.createLinearGradient(0,l+c.a1,0,l+c.a2),f.addColorStop(0,d.xwbs),f.addColorStop(.5,d.xwts),f.addColorStop(1,d.xwbs),e.draw_line(d,f,h,l+c.a1,h,l+c.a2,1),f=v.createLinearGradient(g,0,g+k,0),f.addColorStop(.1,d.xwts),f.addColorStop(.75,d.xwbs),e.draw_round_box(d,d.xwbg,g-1,l+s,k,r+1,1,f,8,d.xwbs))),c.s1=q,c.sw=r},e.real_to_pixel=function(a,d,f,h){if(a=e.origin(a.origin,4,a.stk[a.level]),0===a.xscl||0===a.yscl)return{x:0,y:0};var g=a.x1,l=a.y1,k=a.xmin,p=1/a.xscl,s=a.ymin,q=1/a.yscl,r=!1,v=!1;return null!==d&&(r=d>a.xmax||d<a.xmin,h&&(d=Math.min(d,a.xmax),d=Math.max(d,a.xmin)),d=Math.round((d-k)*p)+g),null!==f&&(v=f>a.ymin||f<a.ymax,h&&(f=Math.min(f,a.ymin),f=Math.max(f,a.ymax)),f=Math.round((f-s)*q)+l),d=Math.round(d),f=Math.round(f),{x:d,y:f,clipped_x:r,clipped_y:v,clipped:r||v}},e.pixel_to_real=function(a,d,e){d=Math.min(a.r,Math.max(a.l,d)),e=Math.min(a.b,Math.max(a.t,e));var f=a.level;return{x:2!==a.origin&&3!==a.origin?a.stk[f].xmin+(d-a.stk[f].x1)*a.stk[f].xscl:a.stk[f].xmin+(a.stk[f].x2-d)*a.stk[f].xscl,y:2<a.origin?a.stk[f].ymin+(e-a.stk[f].y1)*a.stk[f].yscl:a.stk[f].ymin+(a.stk[f].y2-e)*a.stk[f].yscl}},e.colormap=function(a,d,e){a.pixel=Array(e);for(var f=Array(e),h=100/(Math.max(2,e)-1),g=0;e>g;g++)f[g]=h*g+.5;for(h=0;6>h&&0===d[h+1].pos;h++);for(g=0;e>g;g++){a.pixel[g]=0;for(var k=f[g];6>h&&Math.floor(k)>d[h].pos;)h++;if(0===h||k>=d[h].pos)a.pixel[g]={red:A(d[h].red),green:A(d[h].green),blue:A(d[h].blue)};else{var k=A((k-d[h-1].pos)/(d[h].pos-d[h-1].pos)*100),p=255-k;a.pixel[g]={red:d[h].red/100*k+d[h-1].red/100*p,green:d[h].green/100*k+d[h-1].green/100*p,blue:d[h].blue/100*k+d[h-1].blue/100*p}}}},e.colorbar=function(a,d,f,h,g){for(var k=1;g>k;k++)e.draw_line(a,Math.floor(a.pixel.length*(k-1)/g),d,f+g-k,d+h,f+g-k);e.draw_box(a,a.fg,d+.5,f,h,g)};var T="undefined"==typeof Uint8ClampedArray?U:O;e.shift_image_rows=function(a,d,e){return a=new Uint32Array(d),e>0?(e*=d.width,a.set(a.subarray(0,a.length-e),e)):0>e&&(e=Math.abs(e)*d.width,a.set(a.subarray(e))),d},e.update_image_row=function(a,d,e,f,h,g){f=new Uint32Array(d,f*d.width*4,d.width);var k=1;for(g!==h&&(k=a.pixel.length/Math.abs(g-h)),g=0;g<e.length;g++){var p=Math.floor((e[g]-h)*k),p=Math.max(0,Math.min(a.pixel.length-1,p));(p=a.pixel[p])&&(f[g]=-16777216|p.blue<<16|p.green<<8|p.red)}return d},e.create_image=function(c,d,f,h,g,k){c.active_canvas.getContext("2d"),c.pixel&&0!==c.pixel.length||(a.log.warn("COLORMAP not initialized, defaulting to foreground"),e.colormap(c,a.Mc.colormap[1],16));var p=1;k!==g&&(p=c.pixel.length/Math.abs(k-g)),f=Math.ceil(f),h=Math.ceil(h),k=new ArrayBuffer(f*h*4),k.width=f,k.height=h;for(var s=new Uint32Array(k),u=0;u<s.length;u++){var q=Math.floor((d[(3===c.origin||4===c.origin?Math.floor(u/f):h-Math.floor(u/f)-1)*f+(1===c.origin||4===c.origin?Math.floor(u%f):f-Math.floor(u%f)-1)]-g)*p),q=Math.max(0,Math.min(c.pixel.length-1,q));(q=c.pixel[q])&&(s[u]=-16777216|q.blue<<16|q.green<<8|q.red)}return k},e.put_image=function(c,d,f,h,g,k,p,s,u,q,r){u=c.active_canvas.getContext("2d"),c.pixel&&0!==c.pixel.length||(a.log.warn("COLORMAP not initialized, defaulting to foreground"),e.colormap(c,a.Mc.colormap[1],16)),f=Math.floor(g>0?f*g:-g),h=Math.floor(h*k),k=new ArrayBuffer(f*h*4),k.width=f,k.height=h,g=new Uint32Array(k);for(var v=0;v<g.length;v++){var n=Math.max(0,d[v]),n=Math.min(c.pixel.length-1,n);(n=c.pixel[n])&&(g[v]=-16777216|n.blue<<16|n.green<<8|n.red)}return T(c,u,k,q,r,p,s,f,h),k},e.draw_image=function(a,d,f,h,g,k,p,s){var u=Math.max(f,a.stk[a.level].xmin),q=Math.min(g,a.stk[a.level].xmax),r=Math.max(h,a.stk[a.level].ymin),v=Math.min(k,a.stk[a.level].ymax);if(!(1>=d.width||0===Math.abs(g-f)||1>=d.height||0===Math.abs(k-h))){g=d.width/(g-f);var H,I,J,M,x,C,n=d.height/(k-h),u=Math.floor(u*g)/g,q=Math.ceil(q*g)/g,r=Math.floor(r*n)/n,v=Math.ceil(v*n)/n;1===a.origin?(J=Math.max(0,Math.floor((k-v)*n)),C=Math.min(d.height-J,Math.floor((v-r)*n)),M=Math.max(0,Math.floor((u-f)*g)),x=Math.min(d.width-M,Math.floor((q-u)*g)),H=e.real_to_pixel(a,u,v),I=e.real_to_pixel(a,q,r)):2===a.origin?(J=Math.max(0,Math.floor((k-v)*n)),C=Math.min(d.height-J,Math.floor((v-r)*n)),M=Math.max(0,Math.ceil((u-f)*g)),x=Math.min(d.width-M,Math.floor((q-u)*g)),H=e.real_to_pixel(a,q,v),I=e.real_to_pixel(a,u,r)):3===a.origin?(J=Math.max(0,Math.ceil((r-h)*n)),C=Math.min(d.height-J,Math.floor((v-r)*n)),M=Math.max(0,Math.ceil((u-f)*g)),x=Math.min(d.width-M,Math.floor((q-u)*g)),H=e.real_to_pixel(a,q,r),I=e.real_to_pixel(a,u,v)):4===a.origin&&(J=Math.max(0,Math.ceil((r-h)*n)),C=Math.min(d.height-J,Math.floor((v-r)*n)),M=Math.max(0,Math.floor((u-f)*g)),x=Math.min(d.width-M,Math.floor((q-u)*g)),H=e.real_to_pixel(a,u,r),I=e.real_to_pixel(a,q,v)),f=I.x-H.x,I=I.y-H.y,x=Math.max(1,x),C=Math.max(1,C),h=a.active_canvas.getContext("2d"),h.save(),h.beginPath(),h.rect(a.l,a.t,a.r-a.l,a.b-a.t),h.clip(),T(a,h,d,p,s,H.x,H.y,f,I,M,J,x,C),h.restore()}}}(window.mx,window.m),function(e,a,d,x){e.Layer1D=function(a){this.plot=a,this.ybuf=this.xbuf=x,this.xmax=this.xmin=this.imin=this.xdelta=this.xstart=this.offset=0,this.name="",this.cx=!1,this.hcb=x,this.size=0,this.display=!0,this.color=0,this.line=3,this.thick=1,this.symbol=0,this.radius=3,this.ysub=this.xsub=this.skip=0,this.modified=this.xdata=!1,this.preferred_origin=this.opacity=1,this.pointbufsize=0,this.ypoint=this.xpoint=this.yptr=this.xptr=null,this.options={}},e.Layer1D.prototype={init:function(a,g){this.hcb=a,this.hcb.buf_type="D",this.ybufn=this.xbufn=this.size=this.offset=0,this.hcb.pipe?this.size=g.framesize:2===a["class"]?(d.force1000(a),this.size=a.subsize):this.size=a.size,2>=a["class"]&&(this.xsub=-1,this.ysub=1,this.cx="C"===a.format[0]),this.skip=1,this.cx&&(this.skip=2),this.xstart=a.xstart,this.xdelta=a.xdelta;var f=a.xstart+a.xdelta*(this.size-1);if(this.xmin=Math.min(a.xstart,f),this.xmax=Math.max(a.xstart,f),this.xlab=a.xunits,this.ylab=a.yunits,this.hcb.pipe){this.drawmode="scrolling",this.position=0,this.tle=g.tl,this.ybufn=this.size*Math.max(this.skip*e.PointArray.BYTES_PER_ELEMENT,e.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn);var k=this;d.addPipeWriteListener(this.hcb,function(){k._onpipewrite()})}},_onpipewrite:function(){var a=new e.PointArray(this.ybuf),g=this.tle;if(g===x)g=Math.floor(d.pavail(this.hcb))/this.hcb.spa;else if(d.pavail(this.hcb)<g*this.hcb.spa)return;var f=g*this.hcb.spa;if("lefttoright"===this.drawmode)this.position=0,a.set(a.subarray(0,this.size-f),f);else if("righttoleft"===this.drawmode)this.position=this.size-g,a.set(a.subarray(f),0);else if("scrolling"!==this.drawmode)throw"Invalid draw mode";g=Math.min(g,this.size-this.position),0!==d.grabx(this.hcb,a,g*this.hcb.spa,this.position*this.hcb.spa)&&(this.position=(this.position+g)%this.size,1<this.plot._Gx.autol&&this.plot.rescale())},get_data:function(a,g){var s,f=this.plot._Gx,k=this.hcb,p=this.skip;s=2===k["class"]?k.subsize:k.size;var u=0,p=0;f.index?(u=Math.floor(a),p=Math.floor(g+.5)):0<=k.xdelta?(u=Math.floor((a-k.xstart)/k.xdelta)-1,p=Math.floor((g-k.xstart)/k.xdelta+.5)):(u=Math.floor((g-k.xstart)/k.xdelta)-1,p=Math.floor((a-k.xstart)/k.xdelta+.5)),u=Math.max(0,u),p=Math.min(s,p),f=Math.max(0,Math.min(p-u+1,f.bufmax)),0>k.xdelta&&(u=p-f+1),!(u>=this.imin&&u+f<=this.imin+this.size&&this.ybuf!==x||this.modified)&&2>=k["class"]&&(s=this.offset+u,p=this.skip,this.ybufn=f*Math.max(p*e.PointArray.BYTES_PER_ELEMENT,e.PointArray.BYTES_PER_ELEMENT),(this.ybuf===x||this.ybuf.byteLength<this.ybufn)&&(this.ybuf=new ArrayBuffer(this.ybufn)),p=new e.PointArray(this.ybuf),f=d.grab(k,p,s,f),this.imin=u,this.xstart=k.xstart+u*this.xdelta,this.size=f)},change_settings:function(a){if(a.index!==x)if(a.index)this.xmin=this.xdelta=this.xstart=1,this.xmax=this.size;else{this.xstart=this.hcb.xstart+this.imin*this.xdelta,this.xdelta=this.hcb.xdelta;var d=this.hcb.xstart+this.hcb.xdelta*(this.size-1);this.xmin=Math.min(this.hcb.xstart,d),this.xmax=Math.max(this.hcb.xstart,d)}a.drawmode!==x&&(this.drawmode=a.drawmode,this.position=0,this.ybufn=this.size*Math.max(this.skip*e.PointArray.BYTES_PER_ELEMENT,e.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn))},reload:function(a,e){if(this.hcb.pipe)throw"reload cannot be used with pipe, use push instead";var f=this.hcb.dview.length!==a.length||e;if(e)for(var k in e)this.hcb[k]=e[k];this.hcb.setData(a),this.imin=0,this.xstart=x,this.size=0,k=this.xmin;var p=this.xmax;return f&&(2===this.hcb["class"]&&d.force1000(this.hcb),f=this.hcb.xstart+this.hcb.xdelta*(this.hcb.size-1),this.xmin=Math.min(this.hcb.xstart,f),this.xmax=Math.max(this.hcb.xstart,f),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart,p=k=x),{xmin:k,xmax:p}},push:function(a,g,f){if(g){for(var k in g)this.hcb[k]=g[k],"type"===k&&(this.hcb["class"]=g[k]/1e3);g.subsize&&2===this.hcb["class"]&&(d.force1000(this.hcb),this.size=this.hcb.subsize,this.position=null,this.ybufn=this.size*Math.max(this.skip*e.PointArray.BYTES_PER_ELEMENT,e.PointArray.BYTES_PER_ELEMENT),this.ybuf=new ArrayBuffer(this.ybufn)),k=this.hcb.xstart+this.hcb.xdelta*(this.hcb.size-1),this.xmin=Math.min(this.hcb.xstart,k),this.xmax=Math.max(this.hcb.xstart,k),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart}return d.filad(this.hcb,a,f),g?!0:!1},prep:function(a,g){var f=this.plot._Gx,k=this.plot._Mx,p=Math.ceil(this.size),s=this.skip;if(0!==p){p*e.PointArray.BYTES_PER_ELEMENT>this.pointbufsize&&(this.pointbufsize=p*e.PointArray.BYTES_PER_ELEMENT,this.xptr=new ArrayBuffer(this.pointbufsize),this.yptr=new ArrayBuffer(this.pointbufsize),this.xpoint=new e.PointArray(this.xptr),this.ypoint=new e.PointArray(this.yptr));var z,E,u=new e.PointArray(this.ybuf),x=this.xmin,A=this.xmax;if(5===f.cmode||0<this.xsub)0>=p?(x=f.panxmin,A=f.panxmax):5!==f.cmode?this.xpoint=new e.PointArray(this.xbuf):this.cx?d.vmov(u,s,this.xpoint,1,p):0!==this.line?(E=d.vmxmn(u,p),this.xpoint[0]=E.smax,this.xpoint[1]=E.smin,p=2):this.xpoint=u,p>0&&(E=d.vmxmn(this.xpoint,p),A=E.smax,x=E.smin);else if(p>0){E=this.xstart;var K=this.xdelta,u=p;for(f.index?(z=0,p-=1):K>=0?(z=Math.max(1,Math.min(u,Math.round((a-E)/K)))-1,p=Math.max(1,Math.min(u,Math.round((g-E)/K)+2))-1):(z=Math.max(1,Math.min(u,Math.round((g-E)/K)-1))-1,p=Math.max(1,Math.min(u,Math.round((a-E)/K)+2))-1),p=p-z+1,0>p&&(d.log.debug("Nothing to plot"),p=0),u=new e.PointArray(this.ybuf).subarray(z*s),E+=K*z,z=0;p>z;z++)this.xpoint[z]=f.index?this.imin+z+1:E+z*K}if(f.panxmin>f.panxmax?(f.panxmin=x,f.panxmax=A):(f.panxmin=Math.min(f.panxmin,x),f.panxmax=Math.max(f.panxmax,A)),!(0>=p)){if(this.cx)1===f.cmode?d.cvmag(u,this.ypoint,p):2===f.cmode?25===f.plab?(d.cvpha(u,this.ypoint,p),d.vsmul(this.ypoint,1/(2*Math.PI),this.ypoint,p)):24!==f.plab?d.cvpha(u,this.ypoint,p):d.cvphad(u,this.ypoint,p):3===f.cmode?d.vmov(u,s,this.ypoint,1,p):6<=f.cmode?d.cvmag2(u,this.ypoint,p):4<=f.cmode&&d.vmov(u.subarray(1),s,this.ypoint,1,p);else if(5===f.cmode)d.vfill(this.ypoint,0,p);else if(1===f.cmode||6<=f.cmode)for(z=0;p>z;z++)this.ypoint[z]=Math.abs(u[z]);else for(z=0;p>z;z++)this.ypoint[z]=u[z];return 6<=f.cmode&&(d.vlog10(this.ypoint,f.dbmin,this.ypoint),x=10,7===f.cmode&&(x=20),0<f.lyr.length&&f.lyr[0].cx&&(x/=2),d.vsmul(this.ypoint,x,this.ypoint)),E=d.vmxmn(this.ypoint,p),A=E.smax,x=E.smin,s=A-x,0>s&&(A=x,x=A+s,s=-s),1e-20>=s?(x-=1,A+=1):(x-=.02*s,A+=.02*s),0===k.level&&(f.panymin>f.panymax?(f.panymin=x,f.panymax=A):(f.panymin=Math.min(f.panymin,x),f.panymax=Math.max(f.panymax,A)),1<f.autol&&(x=1/Math.max(f.autol,1),f.panymin=f.panymin*x+k.stk[0].ymin*(1-x),f.panymax=f.panymax*x+k.stk[0].ymax*(1-x))),p}d.log.debug("Nothing to plot")}},draw:function(){var d=this.plot._Mx,g=this.plot._Gx,f=this.color,k=this.symbol,p=this.radius,s=0,u={};u.fillStyle=g.fillStyle,this.options&&(u.highlight=this.options.highlight,u.noclip=this.options.noclip),0===this.line?s=0:(s=1,0<this.thick?s=this.thick:0>this.thick&&(s=Math.abs(this.thick),u.dashed=!0),1===this.line&&(u.vertsym=!0),2===this.line&&(u.horzsym=!0));var z,E,x=g.segment&&5!==g.cmode&&0<this.xsub&&!0,A=this.xdelta;if(this.xdata?(z=this.xmin,E=this.xmax):(z=Math.max(this.xmin,d.stk[d.level].xmin),E=Math.min(this.xmax,d.stk[d.level].xmax),z>=E&&(g.panxmin=Math.min(g.panxmin,this.xmin),g.panxmax=Math.max(g.panxmax,this.xmax))),!g.all){var K=(g.bufmax-1)*A;K>=-0?E=Math.min(E,z+K):z=Math.max(z,E+K)}if(0!==s||0!==k){for(;E>z;)this.hcb.pipe||this.get_data(z,E),K=this.prep(z,E),K>0&&!x&&a.trace(d,f,new e.PointArray(this.xptr),new e.PointArray(this.yptr),K,1,s,k,p,u),g.all?0===this.size?z=E:g.index?z+=K:A>=0?z+=this.size*A:E+=this.size*A:z=E;this.position&&"scrolling"===this.drawmode&&(g=a.real_to_pixel(d,this.position*this.xdelta,0),g.x>d.l&&g.x<d.r&&a.draw_line(d,"white",g.x,d.t,g.x,d.b))}},add_highlight:function(a){this.options.highlight||(this.options.highlight=[]),a instanceof Array?this.options.highlight.push.apply(this.options.highlight,a):this.options.highlight.push(a),this.plot.refresh()},remove_highlight:function(a){if(this.options.highlight){for(var d=this.options.highlight.length;d--;)a!==this.options.highlight[d]&&a!==this.options.highlight[d].id||this.options.highlight.splice(d,1);this.plot.refresh()}},get_highlights:function(){return this.options.highlight?this.options.highlight.slice(0):[]},clear_highlights:function(){this.options.highlight&&(this.options.highlight=x,this.plot.refresh())}};var s=[0,53,27,80,13,40,67,93,7,60,33,87,20,47,73,100];e.Layer1D.overlay=function(h,g,f){var k=h._Gx,p=h._Mx;2===g["class"]&&d.force1000(g),g.buf_type="D";var F=1;2===g["class"]&&0<g.size&&(F=Math.min(g.size/g.subsize,16-k.lyr.length));var u=f.name;delete f.name;for(var C=0;F>C;C++){var A=new e.Layer1D(h);A.init(g,f),A.color=a.getcolor(p,d.Mc.colormap[3],s[k.lyr.length%s.length]),2===g["class"]?(u!==x&&(Array.isArray(u)?A.name=u[C]:(A.name=u,A.name=A.name+"."+a.pad((C+1).toString(),3,"0"))),A.name||(A.name=g.file_name?d.trim_name(g.file_name):"layer_"+k.lyr.length,A.name=A.name+"."+a.pad((C+1).toString(),3,"0")),A.offset=C*g.subsize):(A.name=u!==x?u:g.file_name?d.trim_name(g.file_name):"layer_"+k.lyr.length,A.offset=0);for(var z in f)A[z]!==x&&(A[z]=f[z]);h.add_layer(A)}}}(window.sigplot=window.sigplot||{},mx,m),function(e,a,d,x){e.Layer2D=function(a){this.plot=a,this.xmax=this.xmin=this.imin=this.ydelta=this.ystart=this.xdelta=this.xstart=this.offset=0,this.name="",this.cx=!1,this.hcb=x,this.display=!0,this.color=0,this.line=3,this.thick=1,this.symbol=0,this.radius=3,this.ysub=this.xsub=this.skip=0,this.modified=this.xdata=!1,this.preferred_origin=4,this.opacity=1,this.lpb=x,this.yc=1,this.options={}},e.Layer2D.prototype={init:function(a){var h=this.plot._Gx,g=this.plot._Mx;if(this.hcb=a,this.hcb.buf_type="D",this.hcb.pipe){var f=this;this.frame=this.position=0,this.lps=Math.ceil(Math.max(1,g.b-g.t)),d.addPipeWriteListener(this.hcb,function(){f._onpipewrite()}),this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new e.PointArray(this.lps*this.hcb.subsize)}else this.lps=Math.ceil(a.size);this.ybufn=this.xbufn=this.offset=0,this.drawmode="scrolling",2>=a["class"]&&(this.xsub=-1,this.ysub=1,this.cx="C"===a.format[0]),this.skip=1,this.cx&&(this.skip=2),h.index?(this.xmin=this.xdelta=this.xstart=1,this.xmax=a.subsize,this.ymin=this.ydelta=this.ystart=1,this.ymax=this.size):(this.xstart=a.xstart,this.xdelta=a.xdelta,h=a.xstart+a.xdelta*(a.subsize-1),this.xmin=Math.min(a.xstart,h),this.xmax=Math.max(a.xstart,h),this.ystart=a.ystart,this.ydelta=a.ydelta,h=a.ystart+a.ydelta*(this.lps-1),this.ymin=Math.min(a.ystart,h),this.ymax=Math.max(a.ystart,h)),this.xframe=this.hcb.subsize,this.yframe=this.lps*this.hcb.subsize/this.xframe,0===this.lpb&&(this.lpb=this.yframe),(!this.lpb||0>=this.lpb)&&(this.lpb=16),this.lpb=Math.max(1,this.lpb/this.yc)*this.yc,this.xlab=a.xunits,this.ylab=a.yunits},_onpipewrite:function(){var s=this.plot._Gx,h=this.plot._Mx;if(!(d.pavail(this.hcb)<this.hcb.subsize*this.hcb.spa)){if("falling"===this.drawmode?(this.hcb.ystart+=this.hcb.ydelta,this.ystart=this.hcb.ystart,this.ymin=this.hcb.ystart-this.hcb.ydelta*this.lps,this.ymax=this.hcb.ystart):"rising"===this.drawmode&&(this.hcb.ystart+=this.hcb.ydelta,this.ystart=this.hcb.ystart,this.ymin=this.hcb.ystart-this.hcb.ydelta*this.lps,this.ymax=this.hcb.ystart),"falling"===this.drawmode)this.position=0,this.buf.set(this.buf.subarray(0,(this.lps-1)*this.hcb.subsize*this.hcb.spa),this.hcb.subsize*this.hcb.spa),this.img&&a.shift_image_rows(h,this.img,1);else if("rising"===this.drawmode)this.position=this.lps-1,this.buf.set(this.buf.subarray(this.hcb.subsize*this.hcb.spa),0),this.img&&a.shift_image_rows(h,this.img,-1);else{if("scrolling"!==this.drawmode)throw"Invalid draw mode";this.position>=this.lps&&(this.position=0)}if(0===d.grabx(this.hcb,this.buf,this.hcb.subsize*this.hcb.spa,this.position*this.hcb.subsize*this.hcb.spa))d.log.error("Internal error");else{var g=this.buf.subarray(this.position*this.hcb.subsize*this.hcb.spa,(this.position+1)*this.hcb.subsize*this.hcb.spa),f=new e.PointArray(this.hcb.subsize);this.cx?1===s.cmode?d.cvmag(g,f,f.length):2===s.cmode?25===s.plab?(d.cvpha(g,f,f.length),d.vsmul(f,1/(2*Math.PI),f,f.length)):24!==s.plab?d.cvpha(g,f,f.length):d.cvphad(g,f,f.length):3===s.cmode?d.vmov(g,this.skip,f,1,f.length):4===s.cmode?d.vmov(g.subarray(1),this.skip,f,1,f.length):5===s.cmode?d.vfill(f,0,f.length):6===s.cmode?d.cvmag2logscale(g,s.dbmin,10,f):7===s.cmode&&d.cvmag2logscale(g,s.dbmin,20,f):1===s.cmode?d.vabs(g,f):2===s.cmode?d.vfill(f,0,f.length):3===s.cmode?d.vmov(g,this.skip,f,1,f.length):4===s.cmode?d.vfill(f,0,f.length):5===s.cmode?d.vfill(f,0,f.length):6===s.cmode?d.vlogscale(g,s.dbmin,10,f):7===s.cmode&&d.vlogscale(g,s.dbmin,20,f);for(var g=f[0],k=f[0],p=0;p<f.length;p++)f[p]<g&&(g=f[p]),f[p]>k&&(k=f[p]);var x,u;1===s.autol?(x=g,u=k):1<s.autol&&(u=1/Math.max(s.autol,1),x=s.zmin*u+g*(1-u),u=s.zmax*u+k*(1-u)),0!==(1&s.autoz)&&(s.zmin=x),0!==(2&s.autoz)&&(s.zmax=u),this.img&&a.update_image_row(h,this.img,f,this.position,s.zmin,s.zmax),this.frame+=1,"scrolling"===this.drawmode&&(this.position=(this.position+1)%this.lps),0===h.level&&(s.panymin=this.ymin,s.panymax=this.ymax,h.stk[0].ymin=this.ymin,h.stk[0].ymax=this.ymax)}}},get_data:function(){var a=this.hcb;this.buf||(this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new e.PointArray(this.lps*this.hcb.subsize)),this.hcb.pipe||d.grab(a,this.buf,0,a.subsize)},get_z:function(a,d){return this.zbuf[Math.floor(d/this.hcb.ydelta)*this.hcb.subsize+Math.floor(a/this.hcb.xdelta)]},change_settings:function(a){var d=this.plot._Gx;a.cmode!==x&&(this.img=x,0!==(1&d.autoz)&&(d.zmin=x),0!==(2&d.autoz)&&(d.zmax=x)),(a.zmin!==x||a.zmax!==x||a.autoz!==x)&&(this.img=x),a.cmap!==x&&(this.img=x),a.drawmode!==x&&(this.drawmode=a.drawmode,this.frame=this.position=0,this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new e.PointArray(this.lps*this.hcb.subsize),this.img=x,this.preferred_origin=this.plot._Mx.origin="falling"===this.drawmode?1:4)},push:function(a,h,g){if(h){for(var f in h)this.hcb[f]=h[f],"type"===f&&(this.hcb["class"]=h[f]/1e3);h.subsize&&(this.buf=this.hcb.createArray(null,0,this.lps*this.hcb.subsize*this.hcb.spa),this.zbuf=new e.PointArray(this.lps*this.hcb.subsize)),f=this.hcb.xstart+this.hcb.xdelta*(this.hcb.subsize-1),this.xmin=Math.min(this.hcb.xstart,f),this.xmax=Math.max(this.hcb.xstart,f),this.xdelta=this.hcb.xdelta,this.xstart=this.hcb.xstart,this.ystart=this.hcb.ystart,this.ydelta=this.hcb.ydelta,f=this.hcb.ystart+this.hcb.ydelta*(this.lps-1),this.ymin=Math.min(this.hcb.ystart,f),this.ymax=Math.max(this.hcb.ystart,f)}return d.filad(this.hcb,a,g),h?!0:!1},prep:function(e,h){var u,g=this.plot._Gx,f=this.plot._Mx,k=this.lps,p=this.xmin,F=this.xmax;if(this.get_data(e,h),!(5===g.cmode||0<this.xsub)&&k>0){var C=this.xstart,A=this.xdelta,z=k;g.index?(u=0,k-=1):A>=0?(u=Math.max(1,Math.min(z,Math.round((e-C)/A)))-1,k=Math.max(1,Math.min(z,Math.round((h-C)/A)+2))-1):(u=Math.max(1,Math.min(z,Math.round((h-C)/A)-1))-1,k=Math.max(1,Math.min(z,Math.round((e-C)/A)+2))-1),k=k-u+1,0>k&&(d.log.debug("Nothing to plot"),k=0)}if(g.panxmin>g.panxmax?(g.panxmin=p,g.panxmax=F):(g.panxmin=Math.min(g.panxmin,p),g.panxmax=Math.max(g.panxmax,F)),!(0>=k)){if(!(5===g.cmode||0<this.ysub)&&k>0&&(p=this.ystart,F=this.ydelta,z=k,g.index?(u=0,k-=1):F>=0?(u=Math.max(1,Math.min(z,Math.round((e-p)/F)))-1,k=Math.max(1,Math.min(z,Math.round((h-p)/F)+2))-1):(u=Math.max(1,Math.min(z,Math.round((h-p)/F)-1))-1,k=Math.max(1,Math.min(z,Math.round((e-p)/F)+2))-1),k=k-u+1,0>k&&(d.log.debug("Nothing to plot"),k=0)),g.panymin>g.panxmax?(g.panymin=this.ymin,g.panymax=this.ymax):(g.panymin=Math.min(g.panymin,this.ymin),g.panymax=Math.max(g.panymax,this.ymax)),this.cx?1===g.cmode?d.cvmag(this.buf,this.zbuf,this.zbuf.length):2===g.cmode?25===g.plab?(d.cvpha(this.buf,this.zbuf,this.zbuf.length),d.vsmul(this.zbuf,1/(2*Math.PI),this.zbuf,this.zbuf.length)):24!==g.plab?d.cvpha(this.buf,this.zbuf,this.zbuf.length):d.cvphad(this.buf,this.zbuf,this.zbuf.length):3===g.cmode?d.vmov(this.buf,this.skip,this.zbuf,1,this.zbuf.length):4===g.cmode?d.vmov(this.buf.subarray(1),this.skip,this.zbuf,1,this.zbuf.length):5===g.cmode?d.vfill(this.zbuf,0,this.zbuf.length):6===g.cmode?d.cvmag2logscale(this.buf,g.dbmin,10,this.zbuf):7===g.cmode&&d.cvmag2logscale(this.buf,g.dbmin,20,this.zbuf):1===g.cmode?d.vabs(this.buf,this.zbuf):2===g.cmode?d.vfill(this.zbuf,0,this.zbuf.length):3===g.cmode?d.vmov(this.buf,this.skip,this.zbuf,1,this.zbuf.length):4===g.cmode?d.vfill(this.zbuf,0,this.zbuf.length):5===g.cmode?d.vfill(this.zbuf,0,this.zbuf.length):6===g.cmode?d.vlogscale(this.buf,g.dbmin,10,this.zbuf):7===g.cmode&&d.vlogscale(this.buf,g.dbmin,20,this.zbuf),z=this.zbuf,this.hcb.pipe&&this.frame<this.lps&&(z="rising"===this.drawmode?this.zbuf.subarray(this.zbuf.length-this.frame*this.hcb.subsize):this.zbuf.subarray(0,this.frame*this.hcb.subsize)),F=p=0,0<z.length)for(p=z[0],F=z[0],u=0;u<z.length&&!(u/this.xframe>=this.lpb);u++)z[u]<p&&(p=z[u]),z[u]>F&&(F=z[u]);
if(0!==(1&g.autoz)&&(g.zmin=g.zmin!==x?Math.min(g.zmin,p):p),0!==(2&g.autoz)&&(g.zmax=g.zmax!==x?Math.min(g.zmax,F):F),this.img=a.create_image(f,this.zbuf,this.hcb.subsize,this.lps,g.zmin,g.zmax),this.img.cmode=g.cmode,this.img.cmap=g.cmap,this.img.origin=f.origin,this.hcb.pipe&&this.frame<this.lps)if(g=new Uint32Array(this.img),"rising"===this.drawmode)for(u=0;u<g.length-this.frame*this.hcb.subsize;u++)g[u]=0;else for(u=this.frame*this.hcb.subsize;u<g.length;u++)g[u]=0;return k}d.log.debug("Nothing to plot")},draw:function(){var d=this.plot._Mx,h=this.plot._Gx,g=this.hcb;if(this.hcb.pipe){var f=Math.ceil(Math.max(1,d.b-d.t));if(f!==this.lps&&this.buf){var k=this.hcb.createArray(null,0,f*this.hcb.subsize*this.hcb.spa),p=new e.PointArray(f*this.hcb.subsize);k.set(this.buf.subarray(0,k.length)),p.set(this.zbuf.subarray(0,p.length)),this.buf=k,this.zbuf=p,this.lps=f,this.position>=this.lps&&(this.position=0),f=g.ystart+g.ydelta*(this.lps-1),this.ymin=Math.min(g.ystart,f),this.ymax=Math.max(g.ystart,f),this.plot.rescale()}}if(f=Math.max(this.xmin,d.stk[d.level].xmin),k=Math.min(this.xmax,d.stk[d.level].xmax),f>=k)h.panxmin=Math.min(h.panxmin,this.xmin),h.panxmax=Math.max(h.panxmax,this.xmax);else{var x=Math.max(this.ymin,d.stk[d.level].ymin),u=Math.min(this.ymax,d.stk[d.level].ymax),p=Math.abs(k-f)+1,C=Math.abs(u-x)+1,p=Math.floor(p/g.xdelta),C=Math.floor(C/g.ydelta),p=Math.min(p,g.subsize),C=Math.min(C,g.size),g=a.real_to_pixel(d,f,x),u=a.real_to_pixel(d,k,u),C=(u.y-g.y)/C;h.xe=Math.max(1,Math.round((u.x-g.x)/p)),h.ye=Math.max(1,Math.round(C)),this.img?h.cmode===this.img.cmode&&h.cmap===this.img.cmap&&d.origin===this.img.origin||this.prep(f,k):this.prep(f,k),this.img&&a.draw_image(d,this.img,this.xmin,this.ymin,this.xmax,this.ymax,this.opacity,h.rasterSmoothing),null!==this.position&&"scrolling"===this.drawmode&&(h=a.real_to_pixel(d,0,this.position*this.ydelta),h.y>d.t&&h.y<d.b&&a.draw_line(d,"white",d.l,h.y,d.r,h.y))}}},e.Layer2D.overlay=function(a,h,g){var f=a._Gx;h.buf_type="D";var k=new e.Layer2D(a);k.init(h),k.name=h.file_name?d.trim_name(h.file_name):"layer_"+f.lyr.length,k.change_settings(g),a.add_layer(k)}}(window.sigplot=window.sigplot||{},mx,m),window.sigplot=window.sigplot||{},function(e,a,d){function x(){this.yptr=this.xptr=void 0,this.ymax=this.ymin=this.xmax=this.xmin=this.panymax=this.panymin=this.panxmax=this.panxmin=this.xdelta=this.xstart=this.arety=this.aretx=this.ymrk=this.xmrk=this.rety=this.retx=0,this.zmax=this.zmin=void 0,this.pmt=this.pyscl=this.pxscl=this.dbmin=0,this.format=this.note="",this.modsource=this.modlayer=this.pthk=this.pyl=this.py2=this.py1=this.px2=this.px1=this.pb=this.pt=this.pr=this.pl=0,this.modified=!1,this.ydiv=this.xdiv=this.modmode=0,this.cross=this.expand=this.all=!1,this.grid=!0,this.gridBackground=void 0,this.index=!1,this.legend=this.specs=this.pan=!0,this.xdata=!1,this.show_readout=this.show_y_axis=this.show_x_axis=!0,this.autohide_panbars=this.autohide_readout=this.hide_note=!1,this.panning=void 0,this.panmode=0,this.hold=!1,this.isec=this.nsec=this.iysec=this.sections=0,this.ylab=this.xlab=void 0,this.default_rubberbox_action="zoom",this.default_rubberbox_mode="box",this.wheelscroll_mode_natural=!0,this.scroll_time_interval=10,this.stillPanning=this.repeatPanning=void 0,this.autol=-1,this.wheelZoom=this.rasterSmoothing=this.lineSmoothing=!1,this.wheelZoomPercent=.2,this.inContinuousZoom=!1,this.lyr=[],this.HCB=[],this.plugins=[],this.plotData=document.createElement("canvas"),this.plotData.valid=!1}function s(d,c){var e=d._Mx;a.removeEventListener(e,"mousedown",d.onmousedown,!1),a.menu(e,{title:"SCROLLBAR",refresh:function(){d.refresh()},finalize:function(){a.addEventListener(e,"mousedown",d.onmousedown,!1),d.refresh()},items:[{text:"Expand Range",handler:function(){y(d,a.SB_EXPAND,c)}},{text:"Shrink Range",handler:function(){y(d,a.SB_SHRINK,c)}},{text:"Expand Full",handler:function(){y(d,a.SB_FULL,c)}}]})}function h(c){var e=c._Gx,f=c._Mx;a.removeEventListener(f,"mousedown",c.onmousedown,!1);var n={text:"Cntrls...",menu:{title:"CONTROLS OPTIONS",items:[{text:"Continuous (Disabled)",checked:-2===e.cntrls,handler:function(){c.change_settings({xcnt:-2})}},{text:"LM Click (Disabled)",checked:-1===e.cntrls,handler:function(){c.change_settings({xcnt:-1})}},{text:"Off",checked:0===e.cntrls,handler:function(){c.change_settings({xcnt:0})}},{text:"LM Click",checked:1===e.cntrls,handler:function(){c.change_settings({xcnt:1})}},{text:"Continuous",checked:2===e.cntrls,handler:function(){c.change_settings({xcnt:2})}}]}},h={text:"CX Mode...",menu:{title:"COMPLEX MODE",items:[{text:"Magnitude",checked:1===e.cmode,handler:function(){c.change_settings({cmode:1})}},{text:"Phase",checked:2===e.cmode,handler:function(){c.change_settings({cmode:2})}},{text:"Real",checked:3===e.cmode,handler:function(){c.change_settings({cmode:3})}},{text:"Imaginary",checked:4===e.cmode,handler:function(){c.change_settings({cmode:4})}},{text:"IR: Imag/Real",checked:5===e.cmode,handler:function(){c.change_settings({cmode:5})}},{text:"10*Log10",checked:6===e.cmode,handler:function(){c.change_settings({cmode:6})}},{text:"20*Log10",checked:7===e.cmode,handler:function(){c.change_settings({cmode:7})}}]}},g={text:"Scaling...",menu:{title:"SCALING",items:[{text:"Y Axis",style:"separator"},{text:"Parameters...",checked:0===e.autoy,handler:function(){e.autoy=0,O(c,"Y Axis Min:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].ymin?(""===a&&(a=0),t(c,parseFloat(a),f.stk[f.level].ymax,"Y")):c.refresh()},f.stk[f.level].ymin,void 0,void 0,function(){O(c,"Y Axis Max:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].ymax?(""===a&&(a=0),t(c,f.stk[f.level].ymin,parseFloat(a),"Y")):c.refresh()},f.stk[f.level].ymax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===e.autoy,handler:function(){e.autoy=1}},{text:"Max Auto",checked:2===e.autoy,handler:function(){e.autoy=2}},{text:"Full Auto",checked:3===e.autoy,handler:function(){e.autoy=3}},{text:"X Axis",style:"separator"},{text:"Parameters...",checked:0===e.autox,handler:function(){e.autox=0,O(c,"X Axis Min:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].xmin?(""===a&&(a=0),t(c,parseFloat(a),f.stk[f.level].xmax,"X")):c.refresh()},f.stk[f.level].xmin,void 0,void 0,function(){O(c,"X Axis Max:",a.floatValidator,function(a){parseFloat(a)!==f.stk[f.level].xmax?(""===a&&(a=0),t(c,f.stk[f.level].xmin,parseFloat(a),"X")):c.refresh()},f.stk[f.level].xmax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===e.autox,handler:function(){e.autox=1}},{text:"Max Auto",checked:2===e.autox,handler:function(){e.autox=2}},{text:"Full Auto",checked:3===e.autox,handler:function(){e.autox=3}},{text:"Z Axis",style:"separator"},{text:"Parameters...",checked:0===e.autoz,handler:function(){e.autoz=0,O(c,"Z Axis Min:",a.floatValidator,function(a){parseFloat(a)!==e.zmin&&(""===a&&(a=0),c.change_settings({zmin:a}))},e.zmin,void 0,void 0,function(){O(c,"Z Axis Max:",a.floatValidator,function(a){parseFloat(a)!==e.zmax&&(""===a&&(a=0),c.change_settings({zmax:a}))},e.zmax,void 0,void 0,void 0)})}},{text:"Min Auto",checked:1===e.autoz,handler:function(){c.change_settings({autoz:1})}},{text:"Max Auto",checked:2===e.autoz,handler:function(){c.change_settings({autoz:2})}},{text:"Full Auto",checked:3===e.autoz,handler:function(){c.change_settings({autoz:3})}}]}},k={text:"Settings...",menu:{title:"SETTINGS",items:[{text:"ALL Mode",checked:e.all,style:"checkbox",handler:function(){c.change_settings({all:!e.all})}},{text:"Controls...",menu:{title:"CONTROLS OPTIONS",items:[{text:"Continuous (Disabled)",checked:-2===e.cntrls,handler:function(){c.change_settings({xcnt:-2})}},{text:"LM Click (Disabled)",checked:-1===e.cntrls,handler:function(){c.change_settings({xcnt:-1})}},{text:"Off",checked:0===e.cntrls,handler:function(){c.change_settings({xcnt:0})}},{text:"LM Click",checked:1===e.cntrls,handler:function(){c.change_settings({xcnt:1})}},{text:"Continuous",checked:2===e.cntrls,handler:function(){c.change_settings({xcnt:2})}}]}},{text:"Mouse...",menu:{title:"MOUSE OPTIONS",items:[{text:"LM Drag (Zoom)",checked:"zoom"===e.default_rubberbox_action,handler:function(){e.default_rubberbox_action="zoom"}},{text:"LM Drag (Select)",checked:"select"===e.default_rubberbox_action,handler:function(){e.default_rubberbox_action="select"}},{text:"LM Drag (Disabled)",checked:void 0===e.default_rubberbox_action,handler:function(){e.default_rubberbox_action=void 0}},{text:"Mode...",menu:{title:"MOUSE Mode",items:[{text:"Box",checked:"box"===e.default_rubberbox_mode,handler:function(){e.default_rubberbox_mode="box"}},{text:"Horizontal",checked:"horizontal"===e.default_rubberbox_mode,handler:function(){e.default_rubberbox_mode="horizontal"}},{text:"Vertical",checked:"vertical"===e.default_rubberbox_mode,handler:function(){e.default_rubberbox_mode="vertical"}}]}},{text:"CROSShairs...",menu:{title:"Crosshairs Mode",items:[{text:"Off",checked:!e.cross,handler:function(){e.cross=!1}},{text:"On",checked:!0===e.cross,handler:function(){e.cross=!0}},{text:"Horizontal",checked:"horizontal"===e.cross,handler:function(){e.cross="horizontal"}},{text:"Vertical",checked:"vertical"===e.cross,handler:function(){e.cross="vertical"}}]}},{text:"Mousewheel Natural Mode",checked:e.wheelscroll_mode_natural,style:"checkbox",handler:function(){c.change_settings({wheelscroll_mode_natural:!e.wheelscroll_mode_natural})}}]}},{text:"CROSShairs",checked:e.cross,style:"checkbox",handler:function(){c.change_settings({cross:!e.cross})}},{text:"GRID",checked:e.grid,style:"checkbox",handler:function(){c.change_settings({grid:!e.grid})}},{text:"INDEX Mode",checked:e.index,style:"checkbox",handler:function(){c.change_settings({index:!e.index})}},{text:"LEGEND",checked:e.legend,style:"checkbox",handler:function(){c.change_settings({legend:!e.legend})}},{text:"PAN Scrollbars",checked:e.pan,style:"checkbox",handler:function(){c.change_settings({pan:!e.pan})}},{text:"PHase UNITS...",menu:{title:"PHASE UNITS",items:[{text:"Radians",checked:23===e.plab,handler:function(){c.change_settings({phunits:"R"})}},{text:"Degrees",checked:24===e.plab,handler:function(){c.change_settings({phunits:"D"})}},{text:"Cycles",checked:25===e.plab,handler:function(){c.change_settings({phunits:"C"})}}]}},{text:"SPECS",checked:e.specs,style:"checkbox",handler:function(){c.change_settings({specs:!e.specs})}},{text:"XDIVisions...",handler:function(){O(c,"X Divisions:",function(c){var e=a.intValidator(c),q=d.trunc(f.width/2);return e.valid&&c>q?{valid:!1,reason:"Exceeds maximum number of divisions ("+q+")."}:e},function(a){parseFloat(a)!==e.xdiv&&(""===a&&(a=1),e.xdiv=parseFloat(a)),c.refresh()},e.xdiv,void 0,void 0,void 0)}},{text:"XLABel...",handler:function(){O(c,"X Units:",function(c){return console.log("The value is "+c),a.intValidator(c)},function(a){parseFloat(a)!==e.xlab&&(0>a&&(a=0),e.xlab=parseFloat(a)),c.refresh()},e.xlab,void 0,void 0,void 0)}},{text:"YDIVisions...",handler:function(){O(c,"Y Divisions:",function(c){var e=a.intValidator(c),q=d.trunc(f.height/2);return e.valid&&c>q?{valid:!1,reason:"Exceeds maximum number of divisions ("+q+")."}:e},function(a){parseFloat(a)!==e.ydiv&&(""===a&&(a=1),e.ydiv=parseFloat(a)),c.refresh()},e.ydiv,void 0,void 0,void 0)}},{text:"YINVersion",checked:4===f.origin,style:"checkbox",handler:function(){c.change_settings({yinv:4!==f.origin})}},{text:"YLABel...",handler:function(){O(c,"Y Units:",function(c){return a.intValidator(c)},function(a){parseFloat(a)!==e.ylab&&(0>a&&(a=0),e.ylab=parseFloat(a)),c.refresh()},e.ylab,void 0,void 0,void 0)}},{text:"X-axis",checked:e.show_x_axis,style:"checkbox",handler:function(){c.change_settings({show_x_axis:!e.show_x_axis})}},{text:"Y-axis",checked:e.show_y_axis,style:"checkbox",handler:function(){c.change_settings({show_y_axis:!e.show_y_axis})}},{text:"Readout",checked:e.show_readout,style:"checkbox",handler:function(){c.change_settings({show_readout:!e.show_readout})}},{text:"Invert Colors",checked:f.xi,style:"checkbox",handler:function(){a.invertbgfg(f)}}]}},p={text:"Colormap...",menu:{title:"COLORMAP",items:[{text:"Greyscale",checked:0===e.cmap,handler:function(){c.change_settings({cmap:0})}},{text:"Ramp Colormap",checked:1===e.cmap,handler:function(){c.change_settings({cmap:1})}},{text:"Color Wheel",checked:2===e.cmap,handler:function(){c.change_settings({cmap:2})}},{text:"Spectrum",checked:3===e.cmap,handler:function(){c.change_settings({cmap:3})}},{text:"Sunset",checked:4===e.cmap,handler:function(){c.change_settings({cmap:4})}}]}},s=function(d){return{title:"TRACE OPTIONS",items:[{text:"Dashed...",handler:function(){var n=1;if(void 0!==d)n=Math.abs(c._Gx.lyr[d].thick);else{if(0===e.lyr.length)return;for(var n=Math.abs(c._Gx.lyr[0].thick),f=0;f<e.lyr.length;f++)if(n!==Math.abs(c._Gx.lyr[f].thick)){n=1;break}}O(c,"Line thickness:",a.intValidator,function(a){if(void 0!==d)c._Gx.lyr[d].line=3,c._Gx.lyr[d].thick=-1*a,c._Gx.lyr[d].symbol=0;else for(var d=0;d<e.lyr.length;d++)c._Gx.lyr[d].line=3,c._Gx.lyr[d].thick=-1*a,c._Gx.lyr[d].symbol=0},n)}},{text:"Dots...",handler:function(){var n=3;if(void 0!==d)n=Math.abs(c._Gx.lyr[d].radius);else{if(0===e.lyr.length)return;for(var f=0;f<e.lyr.length;f++)if(n!==Math.abs(c._Gx.lyr[f].radius)){n=3;break}}O(c,"Radius/Shape:",a.intValidator,function(a){var n;if(0>a?(n=3,a=Math.abs(a)):a>0?n=2:(n=1,a=0),void 0!==d)c._Gx.lyr[d].line=0,c._Gx.lyr[d].radius=a,c._Gx.lyr[d].symbol=n;else for(var f=0;f<e.lyr.length;f++)c._Gx.lyr[f].line=0,c._Gx.lyr[f].radius=a,c._Gx.lyr[f].symbol=n},n)}},{text:"Solid...",handler:function(){var n=1;if(void 0!==d)n=Math.abs(c._Gx.lyr[d].thick);else{if(0===e.lyr.length)return;for(var n=Math.abs(c._Gx.lyr[0].thick),f=0;f<e.lyr.length;f++)if(n!==Math.abs(c._Gx.lyr[f].thick)){n=1;break}}O(c,"Line thickness:",a.intValidator,function(a){if(void 0!==d)c._Gx.lyr[d].line=3,c._Gx.lyr[d].thick=a,c._Gx.lyr[d].symbol=0;else for(var n=0;n<e.lyr.length;n++)c._Gx.lyr[n].line=3,c._Gx.lyr[n].thick=a,c._Gx.lyr[n].symbol=0},n)}},{text:"Toggle",style:void 0!==d?"checkbox":void 0,checked:void 0!==d?c._Gx.lyr[d].display:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].display=!c._Gx.lyr[d].display;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].display=!c._Gx.lyr[a].display}},{text:"Symbols...",menu:{title:"SYMBOLS",items:[{text:"Retain Current"},{text:"None",checked:void 0!==d?0===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=0,c._Gx.lyr[d].symbol=0;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=0,c._Gx.lyr[a].symbol=0}},{text:"Pixels",checked:void 0!==d?1===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=1,c._Gx.lyr[d].symbol=1;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=1,c._Gx.lyr[a].symbol=1}},{text:"Circles",checked:void 0!==d?2===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=4,c._Gx.lyr[d].symbol=2;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=4,c._Gx.lyr[a].symbol=2}},{text:"Squares",checked:void 0!==d?3===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=4,c._Gx.lyr[d].symbol=3;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=4,c._Gx.lyr[a].symbol=3}},{text:"Plusses",checked:void 0!==d?4===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=4,c._Gx.lyr[d].symbol=4;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=4,c._Gx.lyr[a].symbol=4}},{text:"X's",checked:void 0!==d?5===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=4,c._Gx.lyr[d].symbol=5;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=4,c._Gx.lyr[a].symbol=5}},{text:"Triangles",checked:void 0!==d?6===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=6,c._Gx.lyr[d].symbol=6;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=6,c._Gx.lyr[a].symbol=6}},{text:"Downward Triangles",checked:void 0!==d?7===c._Gx.lyr[d].symbol:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].radius=6,c._Gx.lyr[d].symbol=7;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].radius=6,c._Gx.lyr[a].symbol=7}}]}},{text:"Line Type...",menu:{title:"LINE TYPE",items:[{text:"Retain Current"},{text:"None",checked:void 0!==d?0===c._Gx.lyr[d].line:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].line=0;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].line=0}},{text:"Verticals",checked:void 0!==d?1===c._Gx.lyr[d].line:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].line=1;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].line=1}},{text:"Horizontals",checked:void 0!==d?2===c._Gx.lyr[d].line:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].line=2;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].line=2}},{text:"Connecting",checked:void 0!==d?3===c._Gx.lyr[d].line:void 0,handler:function(){if(void 0!==d)c._Gx.lyr[d].line=3;else for(var a=0;a<e.lyr.length;a++)c._Gx.lyr[a].line=3}}]}},{text:"Thickness...",handler:function(){var n=1;void 0!==d&&(n=c._Gx.lyr[d].thick),O(c,"Thickness",a.intValidator,function(a){if(""===a&&(a=1),a=Math.max(0,a),void 0!==d)c._Gx.lyr[d].thick=a;else for(var n=0;n<e.lyr.length;n++)c._Gx.lyr[n].thick=a},n,void 0,void 0,void 0)}},{text:"Opacity...",handler:function(){var n=1;void 0!==d&&(n=c._Gx.lyr[d].opacity),O(c,"Opacity:",a.floatValidator,function(a){if(""===a&&(a=1),a=Math.max(0,a),a=Math.min(1,a),void 0!==d)c._Gx.lyr[d].opacity=a;else for(var n=0;n<e.lyr.length;n++)c._Gx.lyr[n].opacity=a},n,void 0,void 0,void 0)}}]}},u={text:"Plugins...",menu:{title:"PLUGINS",items:function(){for(var a=[],c=0;c<e.plugins.length;c++){var d=e.plugins[c];d.impl.menu&&a.push("function"==typeof d.impl.menu?d.impl.menu():d.impl.menu)}return a}()}};a.menu(f,{title:"SIG-PLOT",finalize:function(){f.prompt||a.addEventListener(f,"mousedown",c.onmousedown,!1),c.refresh()},items:[{text:"Refresh"},n,h,g,{text:"View...",menu:{title:"VIEW",items:[{text:"Reset",handler:function(){c.unzoom()}},{text:"Y Axis",style:"separator"},{text:"Expand Range",handler:function(){y(c,a.SB_EXPAND,"YPAN")}},{text:"Shrink Range",handler:function(){y(c,a.SB_SHRINK,"YPAN")}},{text:"Expand Full",handler:function(){y(c,a.SB_FULL,"YPAN")}},{text:"X Axis",style:"separator"},{text:"Expand Range",handler:function(){y(c,a.SB_EXPAND,"XPAN")}},{text:"Shrink Range",handler:function(){y(c,a.SB_SHRINK,"XPAN")}},{text:"Expand Full",handler:function(){y(c,a.SB_FULL,"XPAN")}}]}},{text:"Grid",handler:function(){c.change_settings({grid:!e.grid})}},k,p,{text:"Traces...",menu:function(){var a=c._Gx,d={title:"TRACE",items:[]};d.items.push({text:"All",menu:s()});for(var e=0;e<a.lyr.length;e++)d.items.push({text:a.lyr[e].name,menu:s(e)});return d}},{text:"Files...",menu:{title:"FILES OPTIONS",items:[{text:"Deoverlay File...",menu:function(){var a=c._Gx,d={title:"DEOVERLAY",items:[]};d.items.push({text:"Deoverlay All",handler:function(){c.deoverlay()}});for(var e=0;e<a.lyr.length;e++){var n=function(a){return function(){c.deoverlay(a)}}(e);d.items.push({text:a.lyr[e].name,handler:n})}return d}}]}},u,{text:"Keypress Info",handler:function(){a.message(f,l)}},{text:"Save as...",menu:{title:"SAVE AS",items:[{text:"PNG",handler:function(){var a=c._Mx.active_canvas.toDataURL("image/png"),d=document.createElement("a");d.href=a,d.download="SigPlot."+(new Date).getTime()+".png",d.click()}},{text:"JPG",handler:function(){var a=c._Mx.active_canvas.toDataURL("image/jpg"),d=document.createElement("a");d.href=a,d.download="SigPlot."+(new Date).getTime()+".jpg",d.click()}},{text:"SVG",handler:function(){var a=c._Mx.active_canvas.toDataURL("image/svg"),d=document.createElement("a");d.href=a,d.download="SigPlot."+(new Date).getTime()+".svg",d.click()}}]}},{text:"Exit",handler:function(){var c=document.createEvent("Event");c.initEvent("sigplotexit",!0,!0),a.dispatchEvent(f,c)}}]})}function g(c){return function(e,f,n,h,g,k){var l,p=c._Gx,s=c._Mx,t=Math.min(f,h),u=Math.min(n,g),x=Math.abs(h-f);l=Math.abs(g-n),void 0===k||"zoom"===k?1===e.which&&(2>x&&2>l?(x=!1,l=c._Mx,f=l.xpos,n=l.ypos,h=l.text_h,g=l.text_w,k=" ",f<l.l-g&&n<=l.b&&n>=l.t?(k="YCENTER",x=!0):n>l.b+d.trunc(.5*g)&&n<=l.b+d.trunc(d.trunc(3*h)/2)&&f>=l.l&&f<=l.r&&(k="XCENTER",x=!0),l=k,x?" "!==l&&Q(c,l,0,e):1===p.cntrls&&(f=document.createEvent("Event"),f.initEvent("mtag",!0,!0),f.x=p.xmrk,f.y=p.ymrk,f.xpos=t,f.ypos=u,f.w=void 0,f.h=void 0,f.shift=e.shiftKey,a.dispatchEvent(s,f))):(c.pixel_zoom(f,n,h,g),c.refresh())):"select"===k&&(f=document.createEvent("Event"),f.initEvent("mtag",!0,!0),p=T(c,t,u),n=T(c,t+x,u+l),f.x=p.x,f.y=p.y,f.xpos=t,f.ypos=u,f.w=Math.abs(n.x-p.x),f.h=Math.abs(n.y-p.y),f.wpxl=x,f.hpxl=l,f.shift=e.shiftKey,a.dispatchEvent(s,f))}}function f(c,e){var f=c._Mx,n=c._Gx;n.xmin=void 0===e.xmin?0:e.xmin,n.xmax=void 0===e.xmax?0:e.xmax;var h=void 0!==e.xmin,g=void 0!==e.xmax,l=void 0===e.cmode?"":e.cmode.toUpperCase();n.ylab=e.ylab,n.ymin=void 0===e.ymin?0:e.ymin,n.ymax=void 0===e.ymax?0:e.ymax;var p=void 0!==e.ymin,s=void 0!==e.ymax;n.zmin=e.zmin,n.zmax=e.zmax;var t=void 0!==e.zmin,u=void 0!==e.zmax;void 0!==e.colors&&a.setbgfg(f,e.colors.bg,e.colors.fg,f.xi),void 0!==e.xi&&a.invertbgfg(f),n.forcelab=void 0===e.forcelab?!0:e.forcelab,n.all=void 0===e.all?!1:e.all,n.expand=void 0===e.expand?!1:e.expand,n.xlab=e.xlab,n.segment=void 0===e.segment?!1:e.segment,n.plab=24;var x=void 0===e.phunits?"D":e.phunits;"R"===x[0]?n.plab=23:"C"===x[0]&&(n.plab=25),n.xdiv=void 0===e.xdiv?5:e.xdiv,n.ydiv=void 0===e.ydiv?5:e.ydiv,f.origin=1,e.yinv&&(f.origin=4),n.pmt=void 0===e.pmt?1:e.pmt,n.bufmax=void 0===e.bufmax?32768:e.bufmax,n.sections=void 0===e.nsec?0:e.nsec,n.anno_type=void 0===e.anno_type?0:e.anno_type,n.xfmt=void 0===e.xfmt?"":e.xfmt,n.yfmt=void 0===e.yfmt?"":e.yfmt,n.index=void 0===e.index?!1:e.index,(x=n.index||"IN"===l.slice(0,2))&&(h&&1===n.xmin&&(h=!1),g&&1===n.xmin&&(g=!1)),n.xdata=!1,n.note="",n.hold=0,n.always_show_marker=e.always_show_marker||!1,d.vstype("D"),e.inputs||k(c,!1);var w=l.slice(0,2);("IN"===w||"AB"===w||"__"===w)&&(w=l.slice(2,4)),n.cmode=0<n.lyr.length&&n.lyr[0].cx?1:3,"MA"===w&&(n.cmode=1),"PH"===w&&(n.cmode=2),"RE"===w&&(n.cmode=3),"IM"===w&&(n.cmode=4),("LO"===w||"D1"===w)&&(n.cmode=6),("L2"===w||"D2"===w)&&(n.cmode=7),("RI"===w||"IR"===w)&&(n.index?alert("Imag/Real mode not permitted in INDEX mode"):n.cmode=5),n.basemode=n.cmode,c.change_settings({cmode:n.cmode}),n.dbmin=1e-20,6<=n.cmode&&(l=10,7===n.cmode&&(l=20),"L"===w[0]?0<n.lyr.length&&n.lyr[0].cx?(n.ymin=Math.max(n.ymin,1e-10),n.ymax=Math.max(n.ymax,1e-10)):(n.ymin=Math.max(n.ymin,1e-20),n.ymax=Math.max(n.ymax,1e-20)):0<n.lyr.length&&n.lyr[0].cx?(n.ymin=Math.max(-18*l,n.ymin),n.ymax=Math.max(-18*l,n.ymax),n.dbmin=1e-37):Math.min(n.ymin,n.ymax)<-20*l&&(n.ymin=Math.max(-37*l,n.ymin),n.ymax=Math.max(-37*l,n.ymax),n.dbmin=Math.pow(10,Math.min(n.ymin,n.ymax)/l))),f.level=0,x&&!n.index&&(h&&(n.xmin=n.xstart+n.xdelta*(n.xmin-1)),h&&(n.xmax=n.xstart+n.xdelta*(n.xmax-1))),n.autox=void 0===e.autox?-1:e.autox,0>n.autox&&(n.autox=0,h||(n.autox+=1),g||(n.autox+=2)),n.autoy=void 0===e.autoy?-1:e.autoy,0>n.autoy&&(n.autoy=0,p||(n.autoy+=1),s||(n.autoy+=2)),n.autoz=void 0===e.autoz?-1:e.autoz,0>n.autoz&&(n.autoz=0,t||(n.autoz+=1),u||(n.autoz+=2)),n.autol=void 0===e.autol?-1:e.autol,h||(n.xmin=void 0),g||(n.xmax=void 0),G(c,{get_data:!0},n.xmin,n.xmax,n.xlab,n.ylab),h||(n.xmin=f.stk[0].xmin),g||(n.xmax=f.stk[0].xmax),p||(n.ymin=f.stk[0].ymin),s||(n.ymax=f.stk[0].ymax),n.xmin>n.xmax&&(f.stk[0].xmin=n.xmax,n.xmax=n.xmin,n.xmin=f.stk[0].xmin),n.ymin>n.ymax&&(f.stk[0].ymin=n.ymax,n.ymax=n.ymin,n.ymin=f.stk[0].ymin),f.stk[0].xmin=n.xmin,f.stk[0].xmax=n.xmax,f.stk[0].ymin=n.ymin,f.stk[0].ymax=n.ymax,n.panxmin=Math.min(n.panxmin,n.xmin),n.panxmax=Math.max(n.panxmax,n.xmax),n.panymin=Math.min(n.panymin,n.ymin),n.panymax=Math.max(n.panymax,n.ymax),n.xmin=f.stk[0].xmin,n.ymin=f.stk[0].ymin,a.set_font(f,Math.min(7,f.width/64)),n.ncolors=void 0===e.ncolors?16:e.ncolors,n.cmap=void 0===e.xc?-1:e.xc,0>n.ncolors&&(n.ncolors*=-1,n.cmap=Math.max(1,n.cmap)),(1>n.cmap||5<n.cmap)&&(n.cmap=2===n.cmode?2:1),a.colormap(f,d.Mc.colormap[n.cmap],n.ncolors),n.cntrls="leftmouse"===e.xcnt?1:"continuous"===e.xcnt?2:void 0===e.xcnt?1:e.xcnt,n.default_rubberbox_mode=void 0===e.rubberbox_mode?"box":e.rubberbox_mode,n.default_rubberbox_action=void 0===e.rubberbox_action?"zoom":e.rubberbox_action,n.cross=void 0===e.cross?!1:e.cross,n.grid=void 0===e.nogrid?!0:!e.nogrid,n.fillStyle=e.fillStyle,n.gridBackground=e.gridBackground,n.gridStyle=e.gridStyle,n.wheelZoom=e.wheelZoom,n.wheelZoomPercent=e.wheelZoomPercent,n.legend=void 0===e.legend?!1:e.legend,n.legendBtnLocation={x:0,y:0,width:0,height:0},n.pan=void 0===e.nopan?!0:!e.nopan,n.nomenu=void 0===e.nomenu?!1:e.nomenu,n.modmode=0,n.modlayer=-1,n.modsource=0,n.modified=e.mod&&0<n.lyr.length,n.nmark=0,n.iabsc=0,n.index&&(n.iabsc=1),n.specs=!e.nospecs,n.scroll_time_interval=void 0===e.scroll_time_interval?n.scroll_time_interval:e.scroll_time_interval,n.autohide_readout=e.autohide_readout,n.autohide_panbars=e.autohide_panbars,n.specs?(n.show_x_axis=!e.noxaxis,n.show_y_axis=!e.noyaxis,n.show_readout=!e.noreadout,n.specs=n.show_x_axis||n.show_y_axis||n.show_readout?!0:!1):(n.show_x_axis=!1,n.show_y_axis=!1,n.show_readout=!1),n.hide_note=e.hide_note||!1,n.xmrk=0,n.ymrk=0,e.nodragdrop||(a.addEventListener(f,"dragover",function(a){a.preventDefault()},!1),a.addEventListener(f,"drop",function(a){return function(c){var d=c.dataTransfer.files;0<d.length&&(c.preventDefault(),a.load_files(d))}}(c),!1))}function k(a,c){var d=a._Gx,e=a._Mx;if(c){var f=d.HCB[0];d.xstart=f.xstart,d.xdelta=f.xdelta}else d.xstart=0,d.xdelta=1,d.autol=-1;e.origin=1}function p(c,e){var f=c._Mx,n=c._Gx;if(e>0&&(e>=4&&n.show_readout&&!n.hide_note&&a.text(f,f.width-n.lbtn-(n.note.length+1)*f.text_w,f.text_h,n.note),e>=4&&K(c),e>=1&&n.legend)){for(var f=c._Mx,n=c._Gx,h=f.canvas.getContext("2d"),g=0,k=0,l=0,p=0,s=0,t=0,u=0,w=g=0,x=0,p=f.text_w,u=23*p,g=(n.lyr.length+1)*f.text_h,s=f.r-u,t=f.t,k=s+2,l=t+2,w=u-5,x=g-5,y=0,g=u=0;g<n.lyr.length;g++){var z=h.measureText(n.lyr[g].name).width;z>y&&(y=z)}for(y>98&&(u=y-98,w+=u,k-=u),h.strokeStyle=f.fg,h.fillStyle=f.bg,h.fillRect(k,l,w,x),h.strokeRect(k,l,w,x),g=0;g<n.lyr.length;g++)k=s+4*p,l=t+g*f.text_h+f.text_h,g===n.modlayer&&a.text(f,s+p-u,l+Math.floor(f.text_w/2),"**"),n.lyr[g].display&&(x=n.lyr[g].color,0<n.lyr[g].line&&(w=d.sign(Math.min(p,Math.abs(n.lyr[g].thick)),n.lyr[g].thick),0>w||w===a.L_dashed?a.draw_line(f,x,k-u,l-3,k+2*p-u,l-3,Math.abs(w),{mode:"dashed",on:4,off:4}):a.draw_line(f,x,k-u,l-3,k+2*p-u,l-3,Math.abs(w))),0<n.lyr[g].symbol&&(w=0>n.lyr[g].radius?-d.trunc(.6*p):Math.min(n.lyr[g].radius,d.trunc(.6*p)),a.draw_symbol(f,x,k+p-u,l-3,n.lyr[g].symbol,w))),k+=3*p,l+=.3*f.text_h,a.text(f,k-u,l,n.lyr[g].name)}}function F(a){for(var e,c=a._Gx,d=a._Mx.canvas.getContext("2d"),f=0;f<c.plugins.length;)c.plugins[f].impl.refresh&&(e=c.plugins[f].canvas,e.width!==a._Mx.canvas.width&&(e.width=a._Mx.canvas.width),e.height!==a._Mx.canvas.height&&(e.height=a._Mx.canvas.height),e.getContext("2d").clearRect(0,0,e.width,e.height),c.plugins[f].impl.refresh(e),d.drawImage(e,0,0)),f+=1}function u(a){if(a=a._Gx,0===a.HCB.length)a.note="";else if(void 0===a.HCB[0].plotnote){for(var c=[],d=0;d<a.HCB.length;d++)a.HCB[d].file_name&&c.push(a.HCB[d].file_name);a.note=c.join("|").toUpperCase()}}function C(c,d){var e=c._Mx,f=c._Gx;if(!(d>=f.lyr.length)&&f.lyr[d].display&&0===f.hold){f.lyr[d].draw();var g=document.createEvent("Event");g.initEvent("lyrdraw",!0,!0),g.index=d,g.name=f.lyr[d].name,g.layer=f.lyr[d],a.dispatchEvent(e,g)}}function A(c){var d=c._Gx;c=c._Mx,d.cross&&(("vertical"===d.cross||!0===d.cross)&&c.xpos>=c.l&&c.xpos<=c.r&&d.cross_xpos!==c.xpos&&(void 0!==d.cross_xpos&&a.rubberline(c,d.cross_xpos,c.t,d.cross_xpos,c.b),a.rubberline(c,c.xpos,c.t,c.xpos,c.b),d.cross_xpos=c.xpos),("horizontal"===d.cross||!0===d.cross)&&c.ypos>=c.t&&c.ypos<=c.b&&d.cross_ypos!==c.ypos&&(void 0!==d.cross_ypos&&a.rubberline(c,c.l,d.cross_ypos,c.r,d.cross_ypos),a.rubberline(c,c.l,c.ypos,c.r,c.ypos),d.cross_ypos=c.ypos))}function z(c){var d=c._Gx;if(c=c._Mx,null!==d.xmrk&&null!==d.ymrk){var e=c.active_canvas.getContext("2d");e.beginPath(),e.strokeStyle=c.xwfg,e.fillStyle=c.xwfg;var f=a.real_to_pixel(c,d.xmrk,d.ymrk);e.arc(f.x,f.y,2,0,360),e.stroke(),e.textBaseline="alphabetic",e.textAlign="left",e.fillStyle=c.fg,e.font=c.font.font;var g="x:"+a.format_g(d.xmrk,6,3,!0);e.fillText(g,f.x+5,f.y-5),g="y:"+a.format_g(d.ymrk,6,3,!0),e.fillText(g,f.x+5,f.y-5+c.text_h)}}function E(a,c){var d=a._Mx,e=a._Gx;e.xdata=!1;for(var f=0;f<e.lyr.length;f++)e.lyr[f].xdata=5===c?!0:!1,e.lyr[f].xdata&&(e.xdata=!0);if(c!==e.cmode)if(5===c&&e.index)alert("Imag/Real mode not permitted in INDEX mode");else if(0>=e.lyr.length)e.cmode=c,P(a);else if(c>0){f=e.cmode,e.cmode=c;var g=e.autox,h=e.autoy;if(e.autox=3,e.autoy=3,5===c||5===f)e.panxmin=1,e.panxmax=-1,e.panymin=1,e.panymax=-1,d.level=0,c===e.basemode?(d.stk[0].xmin=e.xmin,d.stk[0].xmax=e.xmax,d.stk[0].ymin=e.ymin,d.stk[0].ymax=e.ymax):5===c||5===e.basemode?G(a,{get_data:!0}):(d.stk[0].xmin=e.xmin,d.stk[0].xmax=e.xmax,G(a,{get_data:!0},e.xmin,e.xmax));else for(c===e.basemode?(e.panymin=1,e.panymax=-1,d.stk[0].ymin=e.ymin,d.stk[0].ymax=e.ymax):G(a,{},d.stk[d.level].xmin,d.stk[d.level].xmax),f=1;f<=d.level;f++)d.stk[f].ymin=d.stk[0].ymin,d.stk[f].ymax=d.stk[0].ymax;e.autox=g,e.autoy=h,a.refresh()}}function K(c){var d,e=c._Mx,f=c._Gx;if(f.pan&&!e.widget){d=e.level;var g={ps:e.stk[d].ymin,pe:e.stk[d].ymax},h=g.ps!==f.panymin||g.pe!==f.panymax,h=h&&0<e.level;!f.autohide_panbars||h&&c.mouseOnCanvas||f.panning?(a.scrollbar(e,0,f.pyl,f.pyl+f.pthk,e.t,e.b,g,f.panymin,f.panymax,void 0,e.scrollbar_y),e.stk[d].ymin=g.ps,e.stk[d].ymax=g.pe):(g=e.canvas.getContext("2d"),g.fillStyle=e.bg,g.fillRect(f.pyl,e.t,f.pyl+f.pthk,e.b-e.t)),f.pl<e.width&&(g={ps:e.stk[d].xmin,pe:e.stk[d].xmax},h=(h=g.ps!==f.panxmin||g.pe!==f.panxmax)&&(!f.all||0<e.level),!f.autohide_panbars||h&&c.mouseOnCanvas||f.panning?(a.scrollbar(e,0,f.pl,f.pr,f.pt,f.pt+f.pthk,g,f.panxmin,f.panxmax,void 0,e.scrollbar_x),e.stk[d].xmin=g.ps,e.stk[d].xmax=g.pe):(g=e.canvas.getContext("2d"),g.fillStyle=e.bg,g.fillRect(f.pl,f.pt-1,f.pr-f.pl,f.pthk+4)))}}function Q(c,d,e,f){var k,l,p,s,g=c._Mx,h=c._Gx;s=new a.SCROLLBAR,l=new a.SCROLLBAR;var t=!1;return k=g.level,0<h.panmode?(s.flag=11,l.flag=11):(s.flag=-12,l.flag=-12),0===e&&(s.action=0,l.action=0),"Y"===d.substring(0,1)?(s=g.stk[k].ymin,e=g.stk[k].ymax,p=e-s,"YPAN"===d?(d=g.scrollbar_y,e={ps:s,pe:e},a.scrollbar(g,l,h.pyl,h.pyl+h.pthk,g.t,g.b,e,h.panymin,h.panymax,f,d),s=e.ps,e=e.pe,0!==l.action&&a.scroll(g,l,a.XW_UPDATE,void 0,d)):"YCENTER"===d&&(s-=p*(g.ypos-(g.t+g.b)/2)/(g.b-g.t),e=s+p),(s!==g.stk[k].ymin||e!==g.stk[k].ymax)&&(g.stk[k].ymin=s,g.stk[k].ymax=e,h.cmode===h.basemode&&1===g.level&&(h.ymin=Math.min(h.ymin,s),h.ymax=Math.max(h.ymax,e)),this.inPan=!0,f=document.createEvent("Event"),f.initEvent("ypan",!0,!0),f.level=g.level,f.xmin=g.stk[g.level].xmin,f.ymin=g.stk[g.level].ymin,f.xmax=g.stk[g.level].xmax,f.ymax=g.stk[g.level].ymax,a.dispatchEvent(g,f),this.inPan=!1,c.refresh(),t=!0)):(l=g.stk[k].xmin,e=g.stk[k].xmax,p=e-l,"XPAN"===d?(d=g.scrollbar_x,e={ps:l,pe:e},a.scrollbar(g,s,h.pl,h.pr,h.pt,h.pt+h.pthk,e,h.panxmin,h.panxmax,f,d),l=e.ps,e=e.pe,0!==s.action&&a.scroll(g,s,a.XW_UPDATE,void 0,d)):"XCENTER"===d&&(l+=p*(g.xpos-(g.l+g.r)/2)/(g.r-g.l),l!==g.stk[k].xmin&&(e=l+p)),(g.stk[k].xmin!==l||g.stk[k].xmax!==e)&&(g.stk[k].xmin=l,g.stk[k].xmax=e,h.xdata||1!==g.level||(h.xmin=g.stk[1].xmin,h.xmax=g.stk[1].xmax),this.inPan=!0,f=document.createEvent("Event"),f.initEvent("xpan",!0,!0),f.level=g.level,f.xmin=g.stk[g.level].xmin,f.ymin=g.stk[g.level].ymin,f.xmax=g.stk[g.level].xmax,f.ymax=g.stk[g.level].ymax,a.dispatchEvent(g,f),this.inPan=!1,c.refresh(),t=!0)),t}function U(c,d,e){var h,k,l,f=c._Mx,g=c._Gx;if("XPAN"===d)l=c._Mx.scrollbar_x;else{if("YPAN"!==d)throw"Unable to drag scrollbar - scrollAction is not 'XPAN' or 'YPAN'!!";l=c._Mx.scrollbar_y}l.flag=-12,k=f.level,"XPAN"===d?(h=f.stk[k].xmin,k=f.stk[k].xmax):"YPAN"===d?(h=f.stk[k].ymin,k=f.stk[k].ymax):k=h=void 0;
var p=l;if(p.action=a.SB_DRAG,"YPAN"===d){var s=f.scrollbar_y.trange/f.scrollbar_y.h;4===p.origin&&(s*=-1),e=e.screenY-g.panning.ypos,e*=s,g.panning.ymin-e<g.panymin?(k=g.panymin+(k-h),h=g.panymin):g.panning.ymax-e>g.panymax?(h=g.panymax-(k-h),k=g.panymax):(h=g.panning.ymin-e,k=g.panning.ymax-e)}else"XPAN"===d&&(s=f.scrollbar_x.trange/f.scrollbar_x.w,3===p.origin&&(s*=-1),e=e.screenX-g.panning.xpos,e*=s,g.panning.xmin+e<g.panxmin?(k=g.panxmin+(k-h),h=g.panxmin):g.panning.xmax+e>g.panxmax?(h=g.panxmax-(k-h),k=g.panxmax):(h=g.panning.xmin+e,k=g.panning.xmax+e));l.smin=h,l.srange=k-h,a.redrawScrollbar(l,f,void 0),t(c,l.smin,l.smin+l.srange,d.slice(0,1)),this.inPan=!0,g=document.createEvent("Event"),"XPAN"===d?g.initEvent("xpan",!0,!0):"YPAN"===d&&g.initEvent("ypan",!0,!0),g.level=f.level,g.xmin=f.stk[f.level].xmin,g.ymin=f.stk[f.level].ymin,g.xmax=f.stk[f.level].xmax,g.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,g),this.inPan=!1,l.action=0,c.refresh()}function O(c,d,e,f,g,h,k,l){var p=c._Mx;if(p.prompt)throw"Prompt already exists! Can only have one prompt at a time!";a.disableListeners(p),c.disable_listeners();var s=function(c,d){return function(e){d(e),a.enableListeners(p),c.enable_listeners(),c.refresh(),void 0!==l&&l()}},t=function(){c.refresh()};try{a.prompt(p,d,e,s(c,f),t,g,h,k,5e3)}catch(u){console.log("ERROR: Failed to set up prompt due to: "+u)}}function P(c){var e=c._Mx,f=c._Gx,n=e.canvas.getContext("2d");if(0===f.sections&&(f.isec=0),f.aretx=f.retx,f.arety=f.rety,f.dretx=f.retx-f.xmrk,f.drety=f.rety-f.ymrk,5===f.cmode&&1===f.iabsc&&(f.iabsc=2),1===f.iabsc?(f.aretx=Math.round((f.aretx-f.xstart)/f.xdelta),f.index||(f.aretx+=1),f.dretx=Math.round(f.dretx/f.xdelta)):2===f.iabsc&&(0!==f.aretx&&(f.aretx=1/f.aretx),0!==f.arety&&(f.arety=1/f.arety),0!==f.dretx&&(f.dretx=1/f.dretx),0!==f.drety&&(f.drety=1/f.drety)),f.show_readout&&!e.widget){n.fillStyle=e.bg;var g=Math.floor(e.height-2.5*e.text_h);n.fillRect(e.text_w,g,49*e.text_w,g+1.5*e.text_h);var g=Math.floor(e.height-.5*e.text_h),h=Math.max(f.pr+e.text_w,e.width-2*e.text_w);if(n.fillStyle=e.bg,n.fillRect(h,g-e.text_h,e.text_w,e.text_h),!f.autohide_readout||c.mouseOnCanvas||f.panning){var k;0===f.iabsc&&4===f.ylab?(n=(d.sec2tspec(f.arety)+"                ").substring(0,16),k=(d.sec2tspec(f.drety,"delta")+"                ").substring(0,16)):(n=a.format_g(f.arety,16,9,!0),k=a.format_g(f.drety,16,9)),0===f.iabsc&&4===f.xlab?(g=(d.sec2tspec(f.aretx)+"                ").substring(0,16),c=(d.sec2tspec(f.dretx,"delta")+"                ").substring(0,16)):(g=a.format_g(f.aretx,16,9,!0),c=a.format_g(f.dretx,16,9)),n="y: "+n+" dy: "+k+" L="+e.level+" "+Y[f.cmode-1],c="x: "+g+" dx: "+c+" "+B[f.iabsc],3===f.iabsc&&(n=0===f.dretx?n.substr(0,20)+"sl: Inf             "+n.substr(40,n.length):n.substr(0,20)+"sl: "+a.format_g(f.drety/f.dretx,16,9)+n.substr(40,n.length)),g=Math.floor(e.height-1.5*e.text_h),a.text(e,e.text_w,g,n),g=Math.floor(e.height-.5*e.text_h),a.text(e,e.text_w,g,c),a.LEGACY_RENDER&&h<e.width&&(0<f.cntrls?a.text(e,h,g,"C"):a.text(e,h,g," ")),a.colorbar(e,49*e.text_w-3,e.height-2.5*e.text_h,e.text_w,2*e.text_h)}}}function G(a,c,d,e,f,g){var h=a._Mx;a=a._Gx,c=!0===c.get_data,a.panxmin=1,a.panxmax=-1,a.panymin=1,a.panymax=-1;var k=void 0===d,l=void 0===e;if(0===a.lyr.length)a.panxmin=-1,a.panxmax=1,a.panymin=-1,a.panymax=1;else for(void 0===f&&(a.xlab=a.lyr[0].xlab),void 0===g&&(a.ylab=a.lyr[0].ylab),f=0;f<a.lyr.length;f++)if(k&&(d=a.lyr[f].xmin),l&&(e=a.lyr[f].xmax),a.xlab!==a.lyr[f].xlab&&(a.xlab=0),a.ylab!==a.lyr[f].ylab&&(a.ylab=0),c&&a.lyr[f].get_data(d,e),0<a.autox||0<a.autoy)for(;e>d;)a.lyr[f].get_data(d,e),g=a.lyr[f].prep(d,e),a.all&&a.expand?0===a.lyr[f].size?d=e:a.index?d+=g:0<=a.lyr[f].xdelta?d+=a.lyr[f].size*a.lyr[f].xdelta:e+=a.lyr[f].size*a.lyr[f].xdelta:d=e;else a.lyr[f].prep(1,-1);if(f=a.panxmax-a.panxmin,0>f&&(a.panxmax=a.panxmin,a.panxmin=a.panxmax+f,f=-f),1e-20>=f&&(a.panxmin-=1,a.panxmax+=1),0!==(1&a.autox)&&k&&(h.stk[0].xmin=a.panxmin),0!==(2&a.autox)&&l&&(h.stk[0].xmax=a.panxmax,!a.all&&!a.xdata))for(f=0;f<a.lyr.length;f++)e=Math.min(a.lyr[f].xmax,h.stk[0].xmax),g=Math.abs((e-a.lyr[f].xmin)/a.lyr[f].xdelta)-a.bufmax+1,g>0&&(h.stk[0].xmax=e-g*Math.abs(a.lyr[f].xdelta));0!==(1&a.autoy)&&(h.stk[0].ymin=a.panymin),0!==(2&a.autoy)&&(h.stk[0].ymax=a.panymax)}function T(c,d,e){var f=c._Gx;return c=a.pixel_to_real(c._Mx,d,e),f.index&&(c.x*=f.xdelta),c}function c(a,c,d,e,f,g){return a>=d&&d+f>=a&&c>=e&&e+g>=c}function w(a){var c=!1,e=a._Gx,f=a._Mx,g=f.xpos,h=f.ypos,k=" ";return a.mouseOnCanvas?(e.pan&&g>f.r&&h>=f.t&&h<=f.b?(k="YPAN",f.xpos=e.pyl+d.trunc(e.pthk/2),c=!0):e.pan&&g>=e.pl&&g<=e.pr&&(e.show_readout&&h>e.pt-2||!e.show_readout&&h<=e.pt+e.pthk+2)&&(k="XPAN",f.ypos=e.pt+d.trunc(e.pthk/2),c=!0),{inPanRegion:c,command:k}):!1}function D(c,d){var e,f,g;return 1&d.origin?(g=c.x-d.x,2&d.origin&&(g=d.w-g)):(g=c.y-d.y,2>=d.origin&&(g=d.h-g)),f=a.scroll_real2pix(d),e=f.s1,f=f.sw,g>=e&&e+f>=g?!0:!1}function y(c,d,e){var g,f=c._Mx;"XPAN"===e?g=f.scrollbar_x:"YPAN"===e&&(g=f.scrollbar_y),g.action=d,g.step=.1*g.srange,g.page=9*g.step,g.scale=2,a.scroll(f,g,a.XW_COMMAND,void 0,g),t(c,g.smin,g.smin+g.srange,e.slice(0,1)),this.inPan=!0,c=document.createEvent("Event"),"XPAN"===e?c.initEvent("xpan",!0,!0):"YPAN"===e&&c.initEvent("ypan",!0,!0),c.level=f.level,c.xmin=f.stk[f.level].xmin,c.ymin=f.stk[f.level].ymin,c.xmax=f.stk[f.level].xmax,c.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,c),this.inPan=!1}function t(a,c,d,e){var f=a._Mx,g=a._Gx,h=f.level;"X"===e?(f.stk[h].xmin!==c||f.stk[h].xmax!==d)&&(f.stk[h].xmin=c,f.stk[h].xmax=d,g.xdata||1!==f.level||(g.xmin=f.stk[1].xmin,g.xmax=f.stk[1].xmax),a.refresh()):"Y"!==e||c===f.stk[h].ymin&&d===f.stk[h].ymax||(f.stk[h].ymin=c,f.stk[h].ymax=d,g.cmode===g.basemode&&1===f.level&&(g.ymin=Math.min(g.ymin,c),g.ymax=Math.max(g.ymax,d)),a.refresh())}var l="Keypress Table:\n--------------\n?    - Main help box.\nA    - Toggle display x,y readouts:\n       (absc) -> (index) -> (1/absc) -> (time).\nB    - Toggle LM Drag Mode:\n       (box) -> (horizontal) -> (vertical).\nC    - Toggle controls.\nL    - Toggle legend.\nM    - Pops up main menu\nR    - Toggle display specs (x/y readout)\nS    - Toggle display specs and axes.\nT    - Popup box with timecode value at mouse.\nX    - Popup box with X value at mouse.\nY    - Popup box with Y value at mouse.\nF    - Toggle fullscreen.\n";e.browserIsCompatible=function(){var a=document.createElement("canvas").getContext?!0:!1,c="ArrayBuffer"in window;return a&&c},e.PointArray=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)||"undefined"==typeof Float64Array||Float64Array.emulated||!Float64Array.BYTES_PER_ELEMENT?Float32Array:Float64Array,e.Plot=function(q,r){if(!e.browserIsCompatible())throw"Browser is not compatible";var k=this._Mx=a.open(q);return this._Gx=new x,this._Gx.parent=q,this.mouseOnCanvas=!1,r||(r={}),f(this,r),this._refresh(),this.onmousemove=function(c){return function(d){var e=c._Mx,f=c._Gx,g=d.target.getBoundingClientRect(),q=void 0===d.offsetX?d.pageX-g.left-window.scrollX:d.offsetX;d=void 0===d.offsetX?d.pageY-g.top-window.scrollY:d.offsetY,g=T(c,q,d),f.retx=g.x,f.rety=g.y,e.widget||(P(c),g=document.createEvent("Event"),g.initEvent("mmove",!0,!0),g.xpos=q,g.ypos=d,g.x=f.retx,g.y=f.rety,a.dispatchEvent(e,g)&&(f.cross&&(e.warpbox?(void 0!==f.cross_xpos&&a.rubberline(e,f.cross_xpos,e.t,f.cross_xpos,e.b),void 0!==f.cross_ypos&&a.rubberline(e,e.l,f.cross_ypos,e.r,f.cross_ypos),f.cross_xpos=void 0,f.cross_ypos=void 0):A(c)),2===f.cntrls&&(g=document.createEvent("Event"),g.initEvent("mtag",!0,!0),g.x=f.retx,g.y=f.rety,g.xpos=q,g.ypos=d,a.dispatchEvent(e,g))))}}(this),this.ontouchmove=function(a){return function(c){c.preventDefault(),a.onmousemove(c)}}(this),this.throttledOnMouseMove=d.throttle(this._Gx.scroll_time_interval,this.onmousemove),a.addEventListener(k,"mousemove",this.throttledOnMouseMove,!1),this.onmouseout=function(a){return function(c){c=a._Gx;var d=a._Mx;a.mouseOnCanvas&&(a.mouseOnCanvas=!1,c.autohide_readout&&P(a),c.autohide_panbars&&K(a),d.prompt&&d.prompt.input.enableBlur())}}(this),a.addEventListener(k,"mouseout",this.onmouseout,!1),this.onmouseover=function(a){return function(c){c=a._Gx;var d=a._Mx;a.mouseOnCanvas=!0,c.autohide_panbars&&K(a),d.prompt&&d.prompt.input.disableBlur()}}(this),a.addEventListener(k,"mouseover",this.onmouseover,!1),this.onmousedown=function(d){return function(e){e.preventDefault();var f=d._Mx,q=d._Gx;f.widget&&"ONESHOT"===f.widget.type&&(f.widget=null,d.refresh()),a.ifevent(f,e);var r=document.createEvent("Event");if(r.initEvent("mdown",!0,!0),r.xpos=f.xpos,r.ypos=f.ypos,r.x=q.retx,r.y=q.rety,r.which=e.which,!a.dispatchEvent(f,r))return!1;var k=w(d);if(k.inPanRegion){if(e.preventDefault()," "!==k.command){var l=null,r=null;if("XPAN"===k.command?l=f.scrollbar_x:"YPAN"===k.command&&(l=f.scrollbar_y),2===e.which)r={x:f.xpos,y:f.ypos},void 0!==l&&D(r,l)&&s(d,k.command);else if(" "!==k.command&&(r={x:f.xpos,y:f.ypos},!D(r,l)&&1===e.which)){Q(d,k.command,0,e);var p=function(){D({x:f.xpos,y:f.ypos},l)?q.stillPanning&&(window.clearInterval(q.stillPanning),q.repeatPanning=void 0):Q(d,k.command,0,e)};q.stillPanning=window.setTimeout(function(){q.repeatPanning=window.setInterval(p,50)},250)}}}else if(1===e.which)if(c(f.xpos,f.ypos,q.legendBtnLocation.x,q.legendBtnLocation.y,q.legendBtnLocation.width,q.legendBtnLocation.height))d.change_settings({legend:!q.legend});else{q.xmrk=q.retx,q.ymrk=q.rety,P(d);var r={opacity:0,return_value:"zoom"},v={opacity:.4,fill_color:f.hi,return_value:"select"};"zoom"===q.default_rubberbox_action?a.rubberbox(f,g(d),q.default_rubberbox_mode,r,v):"select"===q.default_rubberbox_action&&a.rubberbox(f,g(d),q.default_rubberbox_mode,v,r),(q.always_show_marker||q.show_marker)&&d.redraw()}else 2===e.which&&(q.nomenu||h(d));return!1}}(this),this.ontouchstart=function(a){return function(c){c.preventDefault(),a.onmousedown({which:1})}}(this),a.addEventListener(k,"mousedown",this.onmousedown,!1),this.docMouseUp=function(a){return function(c){var d=a._Gx;return 1===c.which&&(d.panning=void 0,a._Mx.scrollbar_x.action=0,a._Mx.scrollbar_y.action=0),d.stillPanning&&(window.clearTimeout(d.stillPanning),d.stillPanning=void 0),d.repeatPanning&&(window.clearInterval(d.repeatPanning),d.repeatPanning=void 0),!1}}(this),document.addEventListener("mouseup",this.docMouseUp,!1),this.mouseup=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");if(g.initEvent("mup",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,g=a.dispatchEvent(f,g))if(3===d.which)d.preventDefault(),c.unzoom(1),c.refresh();else if(2===d.which&&e.nomenu&&(g=document.createEvent("Event"),g.initEvent("showmenu",!0,!0),g.x=d.x||d.clientX,g.y=d.y||d.clientY,g=a.dispatchEvent(f,g))){d.stopPropagation&&d.stopPropagation(),d.cancelBubble=!0,a.removeEventListener(f,"mousedown",c.onmousedown,!1);var q=function(){try{var d=document.createEvent("Event");d.initEvent("hidemenu",!0,!0),a.dispatchEvent(f,d)&&a.addEventListener(f,"mousedown",c.onmousedown,!1)}finally{document.removeEventListener("mouseup",q,!1)}};document.addEventListener("mouseup",q,!1)}}}(this),this.ontouchend=function(){return function(a){a.preventDefault()}}(this),a.addEventListener(k,"mouseup",this.mouseup,!1),this.mouseclick=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");return g.initEvent("mclick",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,a.dispatchEvent(f,g),!1}}(this),a.addEventListener(k,"click",this.mouseclick,!1),this.mousedblclick=function(c){return function(d){d.preventDefault();var e=c._Gx,f=c._Mx;a.ifevent(c._Mx,d);var g=document.createEvent("Event");return g.initEvent("mdblclick",!0,!0),g.xpos=f.xpos,g.ypos=f.ypos,g.x=e.retx,g.y=e.rety,g.which=d.which,a.dispatchEvent(f,g),!1}}(this),a.addEventListener(k,"dblclick",this.mousedblclick,!1),this.dragMouseDownHandler=function(a){return function(c){var d=a._Mx,e=a._Gx,f=w(a);if(f.inPanRegion&&(c.preventDefault()," "!==f.command)){var g;"XPAN"===f.command?g=d.scrollbar_x:"YPAN"===f.command&&(g=d.scrollbar_y);var q={x:d.xpos,y:d.ypos};void 0!==g&&D(q,g)&&1===c.which&&(e.panning={axis:f.command,xpos:c.screenX,ypos:c.screenY,xmin:d.stk[d.level].xmin,xmax:d.stk[d.level].xmax,ymin:d.stk[d.level].ymin,ymax:d.stk[d.level].ymax})}}}(this),window.addEventListener("mousedown",this.dragMouseDownHandler,!1),this.dragMouseMoveHandler=function(a){return function(c){var d=a._Gx;if(void 0!==d.panning)try{U(a,d.panning.axis,c)}catch(e){console.log("Error: "+e)}}}(this),this.throttledDragOnMouseMove=d.throttle(this._Gx.scroll_time_interval,this.dragMouseMoveHandler),window.addEventListener("mousemove",this.throttledDragOnMouseMove,!1),this.dragMouseUpHandler=function(a){return function(c){var d=a._Gx;1===c.which&&(d.panning=void 0)}}(this),window.addEventListener("mouseup",this.dragMouseUpHandler,!1),this.onresize=function(c){return function(){a.checkresize(c._Mx)&&c.refresh()}}(this),this.wheelHandler=function(c){var e=c._Mx,f=c._Gx,g=d.throttle(100,function(d){var g;"XPAN"===d.command?g=e.scrollbar_x:"YPAN"===d.command&&(g=e.scrollbar_y),g.action=f.wheelscroll_mode_natural?0>event.deltaY?a.SB_WHEELDOWN:a.SB_WHEELUP:0>event.deltaY?a.SB_WHEELUP:a.SB_WHEELDOWN,g.step=.1*g.srange,g.page=9*g.step,a.scroll(e,g,a.XW_COMMAND,void 0,g),t(c,g.smin,g.smin+g.srange,d.command.slice(0,1))}),q=d.throttle(100,function(){var a=f.wheelZoomPercent||.2;f.wheelscroll_mode_natural?0<event.deltaY&&(a*=-1):0>event.deltaY&&(a*=-1),"x"===f.wheelZoom?c.percent_zoom(a,1,!0):"y"===f.wheelZoom?c.percent_zoom(1,a,!0):c.percent_zoom(a,a,!0)});return function(d){a.ifevent(e,d);var r=w(c);c.mouseOnCanvas&&(d.preventDefault(),r.inPanRegion?g(r):f.wheelZoom&&q())}}(this),window.addWheelListener(window,this.wheelHandler,!1),window.addEventListener("resize",this.onresize,!1),r.nokeypress||(this.onkeypress=function(c){return function(e){var f=c._Mx,g=c._Gx;if(c.mouseOnCanvas&&(!f.widget||"MENU"!==f.widget.type))if(f.widget&&"ONESHOT"===f.widget.type)f.widget=null,c.refresh();else{var q=getKeyCode(e),r=document.createEvent("Event");r.initEvent("plotkeypress",!0,!0),r.keyCode=q,r.shiftKey=e.shiftKey,r.ctrlKey=e.ctrlKey,r.altKey=e.altKey,r.metaKey=e.metaKey,(r=a.dispatchEvent(f,r))&&(97===q?(g.iabsc=(g.iabsc+1)%4,P(c)):108===q?c.change_settings({legend:!g.legend}):103===q?c.change_settings({grid:!g.grid}):98===q||2===q?f.warpbox&&(f.warpbox.mode="box"===f.warpbox.mode?"horizontal":"horizontal"===f.warpbox.mode?"vertical":"box",a.redraw_warpbox(f)):99===q?c.change_settings({xcnt:-1*g.cntrls}):114===q?c.change_settings({show_readout:!g.show_readout}):115===q?c.change_settings({specs:!g.specs}):120===q?(e=c._Gx,f=c._Mx,g=e.aretx.toString(),1===e.iabsc?a.message(f,"INDEX = "+g):2===e.iabsc?a.message(f,"1/X = "+g):a.message(f,"X = "+g)):121===q?(e=c._Gx,f=c._Mx,g=e.arety.toString(),2===e.iabsc?a.message(f,"1/Y = "+g):a.message(f,"Y = "+g)):122===q?(e=c._Gx,f=c._Mx,e.zmin&&e.zmax&&(g="",g=1===e.lyr.length?"Z = "+e.lyr[0].get_z(e.retx,e.rety).toString():"TODO",a.message(f,g))):116===q?(e=c._Gx,f=c._Mx,0<e.lyr.length&&(g=e.lyr[0].hcb,1===g.xunits?a.message(f,"Time = "+d.sec2tod(g.timecode+e.retx)):a.message(f,"Time = UNK"))):109===q?g.nomenu||(r=document.createEvent("Event"),r.initEvent("showmenu",!0,!0),r.x=f.x,r.y=f.y,(r=a.dispatchEvent(f,r))&&h(c)):63===q?a.message(f,"To zoom, press and drag the left mouse (LM) over the region of interest and release. To unzoom, press right mouse (RM).  Press the middle mouse (MM) button or press the by selecting 'Keypress Info' from the main menu."):102===q?(a.fullscreen(f),c.refresh()):9===q&&e.ctrlKey?c.change_settings({invert:null}):107===q&&(g.show_marker=!g.show_marker,c.redraw()))}}}(this),setKeypressHandler(this.onkeypress)),this},e.Plot.prototype={add_plugin:function(a,c){if(void 0===c&&(c=Number.MAX_VALUE),0>=c)throw"Invalid plugin zorder";a.init(this);var d=document.createElement("canvas");d.width=this._Mx.canvas.width,d.height=this._Mx.canvas.height,this._Gx.plugins.push({impl:a,zorder:c,canvas:d}),this._Gx.plugins.sort(function(a,c){return a.zorder-c.zorder}),this.refresh()},remove_plugin:function(a){for(var c=0;c<this._Gx.plugins.length;c++)this._Gx.plugins[c].impl===a&&(a.dispose&&a.dispose(),this._Gx.plugins[c].canvas.parentNode&&this._Gx.plugins[c].canvas.parentNode.removeElement(this._Gx.plugins[c].canvas));this._Gx.plugins.sort(function(a,c){return a.zorder-c.zorder}),this.refresh()},addListener:function(c,d){a.addEventListener(this._Mx,c,d,!1)},removeListener:function(c,d){a.removeEventListener(this._Mx,c,d,!1)},change_settings:function(c){for(var e=this._Gx,f=this._Mx,g=0;g<e.lyr.length;g++)e.lyr[g].change_settings(c);if(void 0!==c.grid&&(e.grid=null===c.grid?!e.grid:c.grid),void 0!==c.gridBackground&&(e.gridBackground=c.gridBackground),void 0!==c.gridStyle&&(e.gridStyle=c.gridStyle),void 0!==c.wheelZoom&&(e.wheelZoom=c.wheelZoom),void 0!==c.wheelZoomPercent&&(e.wheelZoomPercent=c.wheelZoomPercent),void 0!==c.autol&&(e.autol=c.autol),void 0!==c.index&&c.index!==e.index&&(e.index=null===c.index?!e.index:c.index,e.index&&1!==e.iabsc?e.iabsc=1:e.index||1!==e.iabsc||(e.iabsc=0),G(this,{get_data:!1},void 0,void 0),this.unzoom()),void 0!==c.all&&(e.all=null===c.all?!e.all:c.all),void 0!==c.show_x_axis&&(e.show_x_axis=null===c.show_x_axis?!e.show_x_axis:c.show_x_axis,e.specs=e.show_x_axis||e.show_y_axis||e.show_readout),void 0!==c.show_y_axis&&(e.show_y_axis=null===c.show_y_axis?!e.show_y_axis:c.show_y_axis,e.specs=e.show_x_axis||e.show_y_axis||e.show_readout),void 0!==c.show_readout&&(e.show_readout=null===c.show_readout?!e.show_readout:c.show_readout,e.specs=e.show_x_axis||e.show_y_axis||e.show_readout),void 0!==c.specs&&(e.specs=null===c.specs?!e.specs:c.specs,e.specs?(e.show_x_axis=!0,e.show_y_axis=!0,e.show_readout=!0):(e.show_x_axis=!1,e.show_y_axis=!1,e.show_readout=!1)),void 0!==c.xcnt&&(e.cntrls="leftmouse"===c.xcnt?1:"continuous"===c.xcnt?2:"disable"===c.xcnt&&0<e.cntrls?-1*e.cntrls:"enable"===c.xcnt&&0>e.cntrls?-1*e.cntrls:c.xcnt),void 0!==c.legend&&(e.legend=null===c.legend?!e.legend:c.legend,p(this,-1),g=e.lbtn-2,e.show_readout?(e.legendBtnLocation={x:this._Mx.width-e.lbtn,y:2,width:g,height:g},a.shadowbox(this._Mx,this._Mx.width-e.lbtn,2,g,g,1,-1,"L")):(e.legendBtnLocation={x:this._Mx.width-e.lbtn,y:2,width:g,height:g},a.shadowbox(this._Mx,this._Mx.width-e.lbtn,2,g,g,1,1,"L")),p(this,1)),void 0!==c.pan&&(e.pan=null===c.pan?!e.pan:c.pan),void 0!==c.cross&&(e.cross=null===c.cross?!e.cross:c.cross,e.cross?(e.cross_xpos=void 0,e.cross_ypos=void 0,A(this)):(void 0!==e.cross_xpos&&a.rubberline(f,e.cross_xpos,f.t,e.cross_xpos,f.b),void 0!==e.cross_ypos&&a.rubberline(f,f.l,e.cross_ypos,f.r,e.cross_ypos),e.cross_xpos=void 0,e.cross_ypos=void 0)),void 0!==c.cmode&&E(this,c.cmode),void 0!==c.phunits){var h=c.phunits,g=this._Gx,k=this._Mx,l=g.plab;if("R"===h?l=23:"D"===h&&(l=24),"C"===h&&(l=25),l!==g.plab&&(h=[Math.PI,180,.5],h=h[l-23]/h[g.plab-23],g.plab=l,2===g.cmode)){for(l=0;l<=k.level;l++)k.stk[l].ymin*=h,k.stk[l].ymax*=h,k.stk[l].yscl*=h;g.panymin*=h,g.panymax*=h,this.refresh()}}void 0!==c.rubberbox_action&&(e.default_rubberbox_action=c.rubberbox_action),void 0!==c.rubberbox_mode&&(e.default_rubberbox_mode=c.rubberbox_mode),void 0!==c.wheelscroll_mode_natural&&(e.wheelscroll_mode_natural=c.wheelscroll_mode_natural),void 0!==c.colors&&(c.colors.fg||(c.colors.fg=f.fg),c.colors.bg||(c.colors.bg=f.bg),a.setbgfg(f,c.colors.bg,c.colors.fg,f.xi)),void 0!==c.cmap&&(e.cmap=null===c.cmap?2===e.cmode?2:1:c.cmap,a.colormap(f,d.Mc.colormap[e.cmap],e.ncolors)),void 0!==c.yinv&&(f.origin=c.yinv?4:1),void 0!==c.rasterSmoothing&&(e.rasterSmoothing=null===c.rasterSmoothing?!e.rasterSmoothing:c.rasterSmoothing),void 0!==c.fillStyle&&(e.fillStyle=c.fillStyle),void 0!==c.invert&&(null===c.invert?a.invertbgfg(f):!0===c.invert?a.setbgfg(this,"white","black"):a.setbgfg(this,"black","white")),void 0!==c.nomenu&&(e.nomenu=null===c.nomenu?!e.nomenu:c.nomenu),void 0!==c.ymin&&t(this,c.ymin,f.stk[0].ymax,"Y"),void 0!==c.ymax&&t(this,f.stk[0].ymin,c.ymax,"Y"),void 0!==c.xmin&&t(this,c.xmin,f.stk[0].xmax,"X"),void 0!==c.xmax&&t(this,f.stk[0].xmin,c.xmax,"X"),void 0!==c.zmin&&(e.zmin=c.zmin,e.autoz&=2),void 0!==c.zmax&&(e.zmax=c.zmax,e.autoz&=1),void 0!==c.autoz&&(e.autoz=c.autoz,0!==(1&e.autoz)&&(e.zmin=void 0),0!==(2&e.autoz)&&(e.zmax=void 0)),void 0!==c.note&&(e.note=c.note),this.refresh(),void 0!==c.pan&&P(this)},reread:function(){for(var c=this._Gx,d=[],e=0;e<c.lyr.length;e++)d[e]=c.lyr[e];e=c.HCB.slice(),this.deoverlay();for(var f=0;f<e.length;f++)this.overlay_bluefile(e[f]);for(e=0;e<c.lyr.length;e++)c.lyr[e].symbol=d[e].symbol,c.lyr[e].radius=d[e].radius;this.refresh(),c=document.createEvent("Event"),c.initEvent("reread",!0,!0),a.dispatchEvent(this._Mx,c)},cleanup:function(){},reload:function(a,c,d){var e=this._Mx,f=this._Gx;0>a||a>=f.lyr.length||void 0===f.lyr[a].reload||(a=f.lyr[a].reload(c,d),0===e.level&&G(this,{get_data:!1},a.xmin,a.xmax),this.refresh())},rescale:function(){0===this._Mx.level&&G(this,{get_data:!1},void 0,void 0),this.refresh()},push:function(a,c,d,e){var f=this._Mx,g=this._Gx;0>a||a>=g.lyr.length||void 0===g.lyr[a].push||(a=g.lyr[a].push(c,d,e),0===f.level&&a&&G(this,{get_data:!1}),this.refresh())},overlay_array:function(a,c,e){return d.log.debug("Overlay array"),a=d.initialize(a,c),this.overlay_bluefile(a,e)},overlay_pipe:function(a,c){d.log.debug("Overlay pipe"),a||(a={}),a.pipe=!0;var e=d.initialize(null,a);return this.overlay_bluefile(e,c)},overlay_websocket:function(a,c,e){d.log.debug("Overlay websocket: "+a),a=new WebSocket(a,"plot-data"),a.binaryType="arraybuffer";var f=this;c||(c={}),c.pipe=!0;var g=d.initialize(null,c);g.ws=a;var h=this.overlay_bluefile(g,e);return a.onopen=function(){},a.onmessage=function(){return function(a){a.data instanceof ArrayBuffer?(a=g.createArray(a.data),f.push(h,a)):"string"==typeof a.data&&(f._Gx.lyr[h].hcb||d.log.warning("Couldn't find header for layer "+h),a=JSON.parse(a.data),f.push(h,[],a))}}(a),h},overlay_href:function(a,c,e){d.log.debug("Overlay href: "+a);try{this.show_spinner();var f=function(a,c){return function(d){try{if(d){var f=a.overlay_bluefile(d,e);c&&c(d,f)}else alert("Failed to load data")}finally{a.hide_spinner()}}}(this,c);(new BlueFileReader).read_http(a,f)}catch(g){console.log(g),alert("Failed to load data"),this.hide_spinner()}},show_spinner:function(){this._Gx.spinner||(X.color=this._Mx.xwfg,this._Gx.spinner=new Spinner(X).spin(this._Gx.parent))},hide_spinner:function(){this._Gx.spinner&&this._Gx.spinner.stop(),this._Gx.spinner=void 0},add_layer:function(c){var e=this._Gx,d=this._Mx,f=document.createEvent("Event");f.initEvent("lyradd",!0,!0),f.index=e.lyr.length,f.name=c.name,f.layer=c,a.dispatchEvent(d,f)&&e.lyr.push(c)},get_layer:function(a){var c=this._Gx;return a>=0&&a<c.lyr.length?c.lyr[a]:null},overlay_bluefile:function(a,c){d.log.debug("Overlay bluefile: "+a.file_name);var f=this._Mx,g=this._Gx;c=c||{};var h=0===g.HCB.length;g.HCB.push(a),1===g.HCB.length&&k(this,!0);var l=g.lyr.length;if(void 0===c.layerType?1===a["class"]?e.Layer1D.overlay(this,a,c):2===a["class"]&&e.Layer2D.overlay(this,a,c):c.layerType.overlay(this,a,c),E(this,g.cmode),h)if(0===g.HCB.length)k(this,!1);else{g.basemode=g.cmode;var p,s;0===(g.autox&&1)&&(p=g.xmin),0===(g.autox&&2)&&(s=g.xmin),G(this,{get_data:!0},p,s),f.level=0,0!==(g.autox&&1)&&(g.xmin=f.stk[0].xmin),0!==(g.autox&&2)&&(g.xmax=f.stk[0].xmax),0!==(g.autoy&&1)&&(g.ymin=f.stk[0].ymin),0!==(g.autoy&&2)&&(g.ymax=f.stk[0].ymax),f.resize=!0,f.origin=g.lyr[0].preferred_origin?g.lyr[0].preferred_origin:1}else for(f=l;f<g.lyr.length;f++)C(this,f);return u(this),this.refresh(),g.HCB.length-1},load_files:function(a,c){for(var e=function(a){return function(e){a.overlay_bluefile(e,c)}}(this),d=0;d<a.length;d++){var f=a[d];(new BlueFileReader).read(f,e)}},deoverlay:function(a){var c=this._Gx;if(0<c.HCB.length)if(void 0===a)for(a=c.HCB.length-1;a>=0;a--)this.remove_layer(a);else if(0>a){if(a=c.HCB.length+a,0>a)return;this.remove_layer(a)}else a<c.HCB.length&&this.remove_layer(a);0===c.lyr.length&&(k(this,!1),G(this,{}))},remove_layer:function(c){var e=this._Gx,d="",f=null;if(c>=0&&c<e.HCB.length){for(d=e.HCB[c].file_name,f=e.HCB[c],e.HCB[c]=null;c<e.HCB.length-1;c++)e.HCB[c]=e.HCB[c+1];e.HCB.length-=1}for(c=e.lyr.length-1;c>=0;c--)if(e.lyr[c].hcb===f){var g=c,h=this._Gx,k=this._Mx,l=document.createEvent("Event");if(l.initEvent("lyrdel",!0,!0),l.index=g,l.name=h.lyr[g].name,l.layer=h.lyr[g],a.dispatchEvent(k,l)){if(h.lyr[g].ybufn=0,h.lyr[g].ybuf=null,g<h.lyr.length-1)for(;g<h.lyr.length-1;g++)h.lyr[g]=h.lyr[g+1];h.lyr.length-=1,0<h.HCB.length&&(h.panxmin=1,h.panxmax=-1,h.panymin=1,h.panymax=-1)}}u(this),this.refresh(),e=document.createEvent("Event"),e.initEvent("file_deoverlayed",!0,!0),""!==d&&(e.fileName=d),a.dispatchEvent(this._Mx,e)},pixel_zoom:function(a,c,e,d,f){a=T(this,a,c),e=T(this,e,d),this.zoom(a,e,f)},percent_zoom:function(a,c,e){var d=this._Mx,f=this._Gx,g=0;1>Math.abs(a)&&(g=Math.abs(d.stk[d.level].xmax-d.stk[d.level].xmin),g=g*a/2),a=0,1>Math.abs(c)&&(a=Math.abs(d.stk[d.level].ymax-d.stk[d.level].ymin),a=a*c/2),c={x:Math.max(d.stk[d.level].xmin+g,f.panxmin),y:Math.max(d.stk[d.level].ymin+a,f.panymin)},d={x:Math.min(d.stk[d.level].xmax-g,f.panxmax),y:Math.min(d.stk[d.level].ymax-a,f.panymax)},this.zoom(c,d,e)},zoom:function(c,d,e){var f=this._Mx,g=this._Gx;if(!(9<=f.level)){if(void 0===c.x&&(c.x=f.stk[f.level].xmin),void 0===c.y&&(c.y=f.stk[f.level].ymin),void 0===d.x&&(d.x=f.stk[f.level].xmax),void 0===d.y&&(d.y=f.stk[f.level].ymax),d.x<c.x){var h=d.x;d.x=c.x,c.x=h}d.y<c.y&&(h=d.y,d.y=c.y,c.y=h),h={},h.xscl=f.stk[f.level].xscl,h.yscl=f.stk[f.level].yscl,h.xmin=c.x,h.xmax=d.x,h.ymin=c.y,h.ymax=d.y,g.index&&(h.xmin=Math.min(h.xmin/g.xdelta),h.xmax=Math.min(h.xmax/g.xdelta)),e&&g.inContinuousZoom?f.stk[f.level]=h:(f.stk.push(h),f.level=f.stk.length-1),g.inContinuousZoom=e,this.inZoom=!0,c=document.createEvent("Event"),c.initEvent("zoom",!0,!0),c.level=f.level,c.inContinuousZoom=g.inContinuousZoom,c.xmin=f.stk[f.level].xmin,c.ymin=f.stk[f.level].ymin,c.xmax=f.stk[f.level].xmax,c.ymax=f.stk[f.level].ymax,a.dispatchEvent(f,c),this.inZoom=!1,this.refresh()}},unzoom:function(c){var d=this._Mx,e=this._Gx;if(0!==d.level){for(c||(c=d.stk.length);c>0&&0!==d.level;)d.stk.pop(),d.level=d.stk.length-1,c-=1;e.inContinuousZoom=!1,this.inZoom=!0,c=document.createEvent("Event"),c.initEvent("unzoom",!0,!0),c.level=d.level,c.xmin=d.stk[d.level].xmin,c.ymin=d.stk[d.level].ymin,c.xmax=d.stk[d.level].xmax,c.ymax=d.stk[d.level].ymax,a.dispatchEvent(d,c),this.inZoom=!1,this.refresh()}},mimic:function(a,c){var d=this;if(!c)throw"mimic must be called with at least one event mask";c.zoom?a.addListener("zoom",function(a){d.inZoom||d.zoom({x:a.xmin,y:a.ymin},{x:a.xmax,y:a.ymax},a.inContinuousZoom)}):c.xzoom?a.addListener("zoom",function(a){d.inZoom||d.zoom({x:a.xmin,y:void 0},{x:a.xmax,y:void 0},a.inContinuousZoom)}):c.yzoom&&a.addListener("zoom",function(a){d.inZoom||d.zoom({x:void 0,y:a.ymin},{x:void 0,y:a.ymax},a.inContinuousZoom)}),c.unzoom&&a.addListener("unzoom",function(a){d.inZoom||a.level<d._Mx.level&&d.unzoom(d._Mx.level-a.level)}),(c.pan||c.xpan)&&a.addListener("xpan",function(a){d.inPan||t(d,a.xmin,a.xmax,"X")}),(c.pan||c.ypan)&&a.addListener("ypan",function(a){d.inPan||t(d,a.ymin,a.ymax,"Y")})},redraw:function(){var a=this._Gx,c=this._Mx,d=c.canvas.getContext("2d");a.plotData.valid?(d.drawImage(a.plotData,c.l-1,c.t-1,c.r-c.l+2,c.b-c.t+2,c.l-1,c.t-1,c.r-c.l+2,c.b-c.t+2),F(this),a.cross_xpos=void 0,a.cross_ypos=void 0,A(this),(a.always_show_marker||a.show_marker)&&z(this)):this.refresh()},refresh:function(){var c=this;a.render(this._Mx,function(){c._refresh()})},enable_listeners:function(){var c=this._Mx;a.addEventListener(c,"mousedown",this.onmousedown,!1),a.addEventListener(c,"mousemove",this.throttledOnMouseMove,!1),document.addEventListener("mouseup",this.docMouseUp,!1),a.addEventListener(c,"mouseup",this.mouseup,!1),window.addEventListener("mousedown",this.dragMouseDownHandler,!1),window.addEventListener("mousemove",this.throttledDragOnMouseMove,!1),window.addEventListener("mouseup",this.dragMouseUpHandler,!1),window.addEventListener("wheel",this.wheelHandler,!1),window.addEventListener("mousewheel",this.wheelHandler,!1),window.addEventListener("DOMMouseScroll",this.wheelHandler,!1),window.addEventListener("keypress",this.onkeypress,!1)},disable_listeners:function(){var c=this._Mx;a.removeEventListener(c,"mousedown",this.onmousedown,!1),a.removeEventListener(c,"mousemove",this.throttledOnMouseMove,!1),document.removeEventListener("mouseup",this.docMouseUp,!1),a.removeEventListener(c,"mouseup",this.mouseup,!1),window.removeEventListener("mousedown",this.dragMouseDownHandler,!1),window.removeEventListener("mousemove",this.throttledDragOnMouseMove,!1),window.removeEventListener("mouseup",this.dragMouseUpHandler,!1),window.removeEventListener("wheel",this.wheelHandler,!1),window.removeEventListener("mousewheel",this.wheelHandler,!1),window.removeEventListener("DOMMouseScroll",this.wheelHandler,!1),window.removeEventListener("keypress",this.onkeypress,!1)},checkresize:function(){a.checkresize(this._Mx)&&this.refresh()},_refresh:function(){var c=this._Mx,d=this._Gx;if(c.canvas.getContext("2d"),!d.hold){a.set_font(c,Math.min(8,c.width/64)),d.pthk=1.5*c.text_w,d.specs?(c.l=!0===d.show_y_axis?6*c.text_w:1,c.r=!0===d.pan?c.width-(d.pthk+2*c.text_w):c.width-2,d.show_readout?(c.t=2*c.text_h,c.b=d.show_x_axis?c.height-4*c.text_h:c.height-3*c.text_h):(c.t=d.pan?d.pthk+2*c.text_w:1,c.b=d.show_x_axis?c.height-3*c.text_h/2:c.height-2),d.pl=d.show_readout?50*c.text_w:35*c.text_w,d.pr=Math.max(d.pl+9*c.text_w,c.r),d.pt=d.show_readout?d.show_x_axis?c.b+c.text_h+(c.height-c.b-c.text_h-d.pthk)/2:c.b+(c.height-c.b-d.pthk)/2:(c.t-d.pthk)/2,d.lbtn=c.text_h+c.text_w+2):(d.pan?(c.t=d.pthk+2*c.text_w,c.r=c.width-(d.pthk+c.text_w)):(c.t=1,c.r=c.width-2),c.b=c.height-2,c.l=1,d.pl=c.l,d.pr=c.r,d.pt=(c.t-d.pthk)/2,d.lbtn=0),d.pyl=c.r+(c.width-c.r-d.pthk)/2+1;var e=c.level;c.stk[e].x1=c.l,c.stk[e].y1=c.t,c.stk[e].x2=c.r,c.stk[e].y2=c.b,c.stk[e].xscl=(c.stk[e].xmax-c.stk[e].xmin)/(c.r-c.l),c.stk[e].yscl=(c.stk[e].ymax-c.stk[e].ymin)/(c.b-c.t),e=T(this,c.xpos,c.ypos),d.retx=e.x,d.rety=e.y,(0===d.panning||0!==d.panning)&&(d.plotData.valid=!1,a.clear_window(c));var e=d.xlab,f=d.ylab;if(void 0===e&&(e=30),d.index&&(e=0),void 0===f&&(f=0<d.lyr.length&&d.lyr[0].cx,1===d.cmode?f=28:2===d.cmode?f=d.plab:3===d.cmode&&f?f=21:4===d.cmode?f=22:5===d.cmode?(f=22,e=21):f=6===d.cmode?26:7===d.cmode?27:0),d.specs){if(0===d.sections){var g={grid:d.grid};2===d.panning&&(g.noxtlab=!0),d.show_x_axis||(g.noxtics=!0,g.noxtlab=!0,g.noxplab=!0),d.show_y_axis||(g.noytics=!0,g.noytlab=!0,g.noyplab=!0),!d.specs||d.show_readout||d.pan||(g.noyplab=!0,g.noxplab=!0),d.gridBackground&&(g.fillStyle=d.gridBackground),d.gridStyle&&(g.gridStyle=d.gridStyle),a.drawaxis(c,d.xdiv,d.ydiv,e,f,g)}e=d.lbtn-2,d.show_readout&&d.pan&&(d.legend?(d.legendBtnLocation={x:c.width-d.lbtn,y:2,width:e,height:e},a.shadowbox(c,c.width-d.lbtn,2,e,e,1,-2,"L")):(d.legendBtnLocation={x:c.width-d.lbtn,y:2,width:e,height:e},a.shadowbox(c,c.width-d.lbtn,2,e,e,1,2,"L")),P(this))}else d.grid&&0<=d.sections&&(g={grid:!0,noaxisbox:!0,noxtics:!0,noxtlab:!0,noxplab:!0,noytics:!0,noytlab:!0,noyplab:!0},a.drawaxis(c,d.xdiv,d.ydiv,e,f,g));for(e=0;e<d.lyr.length;e++)C(this,e);p(this,4),c.r>c.l&&c.b>c.t&&(d.plotData.width=c.canvas.width,d.plotData.height=c.canvas.height,d.plotData.getContext("2d").drawImage(c.canvas,0,0),d.plotData.valid=!0),F(this),d.cross_xpos=void 0,d.cross_ypos=void 0,A(this),(d.always_show_marker||d.show_marker)&&z(this)}}};var X={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},Y="Ma Ph Re Im IR Lo L2".split(" "),B=["(absc)","(indx)","(1/ab)","(dydx)"]
}(window.sigplot,window.mx,window.m),function(k,g,r,d){k.AnnotationPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.annotations=[]},k.AnnotationPlugin.prototype={init:function(a){var c=this;this.plot=a;var b=this.plot._Mx;this.onmousemove=function(a){if(0!==c.annotations.length&&!c.options.prevent_hover)if(a.xpos<b.l||a.xpos>b.r)c.set_highlight(!1);else if(a.ypos>b.b||a.ypos<b.t)c.set_highlight(!1);else{for(var h=!1,e=0;e<c.annotations.length;e++){var f=c.annotations[e],l=d,p=d;f.absolute_placement&&(l=f.x,p=f.y),f.pxl_x!==d&&(l=f.pxl_x),f.pxl_y!==d&&(p=f.pxl_y);var k=g.real_to_pixel(b,f.x,f.y);l===d&&(l=k.x),p===d&&(p=k.y);var k=l,q=p;f.value instanceof HTMLImageElement||f.value instanceof HTMLCanvasElement||f.value instanceof HTMLVideoElement?(k-=f.width/2,q-=f.height/2):q-=f.height,g.inrect(a.xpos,a.ypos,k,q,f.width,f.height)?f.highlight||(c.set_highlight(!0,[f],l,p),h=!0):f.highlight&&(c.set_highlight(!1,[f]),h=!0)}c.plot&&h&&c.plot.refresh()}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(){},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(){},document.addEventListener("mouseup",this.onmouseup,!1)},set_highlight:function(a,c,b,n){c=c||this.annotations;for(var d=0;d<c.length;d++){var e=document.createEvent("Event");e.initEvent("annotationhighlight",!0,!0),e.annotation=c[d],e.state=a,e.x=b,e.y=n,g.dispatchEvent(this.plot._Mx,e)&&(c[d].highlight=a)}},menu:function(){var a=function(b){return function(){b.options.display=!b.options.display,b.plot.redraw()}}(this),c=function(b){return function(){b.annotations=[],b.plot.redraw()}}(this);return{text:"Annotations...",menu:{title:"ANNOTATIONS",items:[{text:"Display",checked:this.options.display,style:"checkbox",handler:a},{text:"Clear All",handler:c}]}}},add_annotation:function(a){return this.annotations.push(a),this.plot.redraw(),this.annotations.length},clear_annotations:function(){this.annotations=[],this.plot.redraw()},refresh:function(a){if(this.options.display){var c=this.plot._Mx,b=a.getContext("2d"),n=this;b.save(),b.beginPath(),b.rect(c.l,c.t,c.r-c.l,c.b-c.t),b.clip(),g.onCanvas(c,a,function(){for(var a=n.annotations.length-1;a>=0;a--){var e=n.annotations[a],f=d,l=d;e.absolute_placement&&(f=e.x,l=e.y),e.pxl_x!==d&&(f=e.pxl_x),e.pxl_y!==d&&(l=e.pxl_y);var k=g.real_to_pixel(c,e.x,e.y);f===d&&(f=k.x),l===d&&(l=k.y),g.inrect(f,l,c.l,c.t,c.r-c.l,c.b-c.t)&&(e.value instanceof HTMLImageElement||e.value instanceof HTMLCanvasElement||e.value instanceof HTMLVideoElement?(e.width=e.value.width,e.height=e.value.height,b.drawImage(e.value,f-e.width/2,l-e.height/2)):(b.font=e.font||"bold italic 20px new century schoolbook",b.fillStyle=e.highlight?e.highlight_color||c.hi:e.color||c.fg,b.globalAlpha=1,e.width=b.measureText(e.value).width,e.height=b.measureText("M").width,b.textBaseline="alphabetic",b.textAlign="left",b.fillText(e.value,f,l)),e.highlight&&e.popup&&g.render_message_box(c,e.popup,f+5,l+5))}}),b.restore()}},dispose:function(){this.annotations=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(k,g,r,d){k.SliderPlugin=function(a){this.options=a!==d?a:{},this.options.display===d&&(this.options.display=!0),this.options.style===d&&(this.options.style={}),this.options.direction===d&&(this.options.direction="vertical"),this.paired_slider=this.location=this.position=d},k.SliderPlugin.prototype={init:function(a){this.plot=a;var c=a._Mx,b=this;this.onmousemove=function(a){if(b.location!==d&&!b.options.prevent_drag)if(a.xpos<c.l||a.xpos>c.r)b.set_highlight(!1);else if(a.ypos>c.b||a.ypos<c.t)b.set_highlight(!1);else{var h=b.options.style.lineWidth!==d?b.options.style.lineWidth:1;b.dragging?(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?(b.location=a.xpos,b.position=h.x):"horizontal"===b.options.direction?(b.location=a.ypos,b.position=h.y):"both"===b.options.direction&&(b.location.x=a.xpos,b.position.x=h.x,b.location.y=a.ypos,b.position.y=h.y),b.plot.redraw(),a.preventDefault()):c.warpbox||("vertical"===b.options.direction?b.set_highlight(Math.abs(b.location-a.xpos)<h+5?!0:!1):"horizontal"===b.options.direction?b.set_highlight(Math.abs(b.location-a.ypos)<h+5?!0:!1):"both"===b.options.direction&&b.set_highlight(Math.abs(b.location.x-a.xpos)<h+5&&Math.abs(b.location.y-a.ypos)<h+5?!0:!1))}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){if(b.location!==d&&!(b.options.prevent_drag||a.xpos<c.l||a.xpos>c.r||a.ypos>c.b||a.ypos<c.t||a.slider_drag)){var h=b.options.style.lineWidth!==d?b.options.style.lineWidth:1;"vertical"===b.options.direction?Math.abs(b.location-a.xpos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault()):"horizontal"===b.options.direction?Math.abs(b.location-a.ypos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault()):"both"===b.options.direction&&Math.abs(b.location.x-a.xpos)<h+5&&Math.abs(b.location.y-a.ypos)<h+5&&(b.dragging=!0,a.slider_drag=!0,a.preventDefault())}},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(a){b.dragging&&(b.dragging=!1,a=document.createEvent("Event"),a.source=b,a.initEvent("slidertag",!0,!0),"both"===b.options.direction?(a.location=b.location?JSON.parse(JSON.stringify(b.location)):d,a.position=b.position?JSON.parse(JSON.stringify(b.position)):d):(a.location=b.location,a.position=b.position),g.dispatchEvent(c,a),a=document.createEvent("Event"),a.initEvent("sliderdrag",!0,!0),"both"===b.options.direction?(a.location=b.location?JSON.parse(JSON.stringify(b.location)):d,a.position=b.position?JSON.parse(JSON.stringify(b.position)):d):(a.location=b.location,a.position=b.position),g.dispatchEvent(c,a))},document.addEventListener("mouseup",this.onmouseup,!1)},addListener:function(a,c){var b=this;g.addEventListener(this.plot._Mx,a,function(a){return a.source===b?c(a):void 0},!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},pair:function(a){if(a){if(a.direction!==this.direction)throw"paired sliders must use the same direction setting";this.paired_slider=a}else this.paired_slider=null},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},set_position:function(a){if(!this.dragging){if("both"===this.options.direction){if(this.position!==d&&this.position.x===a.x&&this.position.y===a.y)return}else if(this.position===a)return;this.set_highlight(!1);var c=this.plot._Mx;this.position="both"===this.options.direction?a?JSON.parse(JSON.stringify(a)):d:a,a="both"===this.options.direction?g.real_to_pixel(c,this.position.x,this.position.y):g.real_to_pixel(c,this.position,this.position),"vertical"===this.options.direction?this.location=a.x:"horizontal"===this.options.direction?this.location=a.y:"both"===this.options.direction&&(this.location={x:a.x,y:a.y}),a=document.createEvent("Event"),a.initEvent("slidertag",!0,!0),"both"===this.options.direction?(a.location=this.location?JSON.parse(JSON.stringify(this.location)):d,a.position=this.position?JSON.parse(JSON.stringify(this.position)):d):(a.location=this.location,a.position=this.position),g.dispatchEvent(c,a),this.plot.redraw()}},set_location:function(a){if(!this.dragging){if("both"===this.options.direction){if(this.location!==d&&this.location.x===a.x&&this.location.y===a.y)return}else if(this.location===a)return;this.set_highlight(!1);var c=this.plot._Mx;this.location="both"===this.options.direction?a?JSON.parse(JSON.stringify(a)):d:a,a="both"===this.options.direction?g.pixel_to_real(c,a.x,a.y):g.pixel_to_real(c,a,a),"vertical"===this.options.direction?this.position=a.x:"horizontal"===this.options.direction?this.position=a.y:"both"===this.options.direction&&(this.position={x:a.x,y:a.y}),a=document.createEvent("Event"),a.initEvent("slidertag",!0,!0),"both"===this.options.direction?(a.location=this.location?JSON.parse(JSON.stringify(this.location)):d,a.position=this.position?JSON.parse(JSON.stringify(this.position)):d):(a.location=this.location,a.position=this.position),g.dispatchEvent(c,a),this.plot.redraw()}},get_position:function(){return this.position},get_location:function(){return this.location},refresh:function(a){if(this.options.display&&this.position!==d){var c=this.plot._Mx;a=a.getContext("2d"),a.lineWidth=this.options.style.lineWidth!==d?this.options.style.lineWidth:1,a.lineCap=this.options.style.lineCap!==d?this.options.style.lineCap:"square",a.strokeStyle=this.options.style.strokeStyle!==d?this.options.style.strokeStyle:c.fg,(this.dragging||this.highlight)&&(a.lineWidth=Math.ceil(1.2*a.lineWidth));var b;if(b="both"===this.options.direction?g.real_to_pixel(c,this.position.x,this.position.y):g.real_to_pixel(c,this.position,this.position),"vertical"===this.options.direction){if(b.x<c.l||b.x>c.r)return;this.location=b.x}else if("horizontal"===this.options.direction){if(b.y<c.t||b.y>c.b)return;this.location=b.y}else if("both"===this.options.direction){if(b.x<c.l||b.x>c.r||b.y<c.t||b.y>c.b)return;this.location.x=b.x,this.location.y=b.y}if("vertical"===this.options.direction?(a.beginPath(),a.moveTo(this.location+.5,c.t),a.lineTo(this.location+.5,c.b),a.stroke()):"horizontal"===this.options.direction?(a.beginPath(),a.moveTo(c.l,this.location+.5),a.lineTo(c.r,this.location+.5),a.stroke()):"both"===this.options.direction&&(a.beginPath(),a.moveTo(c.l,this.location.y+.5),a.lineTo(c.r,this.location.y+.5),a.closePath(),a.moveTo(this.location.x+.5,c.t),a.lineTo(this.location.x+.5,c.b),a.stroke()),this.dragging||this.highlight){if("vertical"===this.options.direction){a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(this.position,6,3,!0).trim();var n=a.measureText(b).width;this.location+5+n>c.r?(a.textAlign="right",a.fillText(b,this.location-5,c.t+10)):a.fillText(b,this.location+5,c.t+10)}else"horizontal"===this.options.direction&&(a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(this.position,6,3,!0).trim(),this.location-c.text_h-5>c.t?a.fillText(b,c.l+10,this.location-5):a.fillText(b,c.l+10,this.location+5+c.text_h));if(this.paired_slider)if("vertical"===this.options.direction){b=this.position-this.paired_slider.position;var n=this.location-this.paired_slider.location,h=c.t+Math.round((c.b-c.t)/2);g.textline(c,this.location,h,this.paired_slider.location,h,{mode:"dashed",on:3,off:3}),a.textBaseline="alphabetic",a.textAlign="center",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(b,6,3,!0),a.fillText(b,this.location-Math.round(n/2),h-5)}else"horizontal"===this.options.direction&&(b=this.position-this.paired_slider.position,n=this.location-this.paired_slider.location,h=c.l+Math.round((c.r-c.l)/2),g.textline(c,h,this.location,h,this.paired_slider.location,{mode:"dashed",on:3,off:3}),a.textBaseline="alphabetic",a.textAlign="left",a.fillStyle=this.options.style.textStyle!==d?this.options.style.textStyle:c.fg,a.font=c.font.font,b=g.format_g(b,6,3,!0),a.fillText(b,h+5,this.location-Math.round(n/2)))}}},dispose:function(){this.plot.removeListener("mmove",this.onmousemove),document.removeEventListener("mouseup",this.onmouseup,!1),this.position=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(k,g,r,d){k.AccordionPlugin=function(a){this.options=a!==d?a:{},this.options.display===d&&(this.options.display=!0),this.options.center_line_style===d&&(this.options.center_line_style={}),this.options.edge_line_style===d&&(this.options.edge_line_style={}),this.options.fill_style===d&&(this.options.fill_style={}),this.options.direction===d&&(this.options.direction="vertical"),this.loc_2=this.loc_1=this.center_location=this.width=this.center=d},k.AccordionPlugin.prototype={init:function(a){this.plot=a;var c=this.plot._Mx,b=this;this.onmousemove=function(a){if(b.center_location!==d&&!b.options.prevent_drag)if(a.xpos<c.l||a.xpos>c.r)b.set_highlight(!1);else if(a.ypos>c.b||a.ypos<c.t)b.set_highlight(!1);else{var h=b.options.center_line_style.lineWidth!==d?b.options.center_line_style.lineWidth:1,e=b.options.edge_line_style.lineWidth!==d?b.options.edge_line_style.lineWidth:1;b.dragging||b.edge_dragging?(b.dragging&&(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?(b.center_location=a.xpos,b.center=h.x):"horizontal"===b.options.direction&&(b.center_location=a.ypos,b.center=h.y)),b.edge_dragging&&(h=g.pixel_to_real(c,a.xpos,a.ypos),"vertical"===b.options.direction?b.width=2*Math.abs(b.center-h.x):"horizontal"===b.options.direction&&(b.width=2*Math.abs(b.center-h.y))),b.plot&&b.plot.refresh(),a.preventDefault()):c.warpbox||("vertical"===b.options.direction?(b.set_highlight(Math.abs(b.center_location-a.xpos)<h+5?!0:!1),b.set_edge_highlight(Math.abs(b.loc_1-a.xpos)<e+5||Math.abs(b.loc_2-a.xpos)<e+5?!0:!1)):"horizontal"===b.options.direction&&(b.set_highlight(Math.abs(b.center_location-a.ypos)<h+5?!0:!1),b.set_edge_highlight(Math.abs(b.loc_1-a.ypos)<e+5||Math.abs(b.loc_2-a.ypos)<e+5?!0:!1)))}},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){if(b.center_location!==d&&!(a.xpos<c.l||a.xpos>c.r||a.ypos>c.b||a.ypos<c.t)){var h=b.options.center_line_style.lineWidth!==d?b.options.center_line_style.lineWidth:1,e=b.options.edge_line_style.lineWidth!==d?b.options.edge_line_style.lineWidth:1;"vertical"===b.options.direction?Math.abs(b.loc_1-a.xpos)<e+5||Math.abs(b.loc_2-a.xpos)<e+5?(b.edge_dragging=!0,a.preventDefault()):Math.abs(b.center_location-a.xpos)<h+5&&(b.dragging=!0,a.preventDefault()):"horizontal"===b.options.direction&&(Math.abs(b.loc_1-a.ypos)<e+5||Math.abs(b.loc_2-a.ypos)<e+5?(b.edge_dragging=!0,a.preventDefault()):Math.abs(b.center_location-a.ypos)<h+5&&(b.dragging=!0,a.preventDefault()))}},this.plot.addListener("mdown",this.onmousedown),this.onmouseup=function(a){b.dragging=!1,b.edge_dragging=!1,a=document.createEvent("Event"),a.initEvent("accordiontag",!0,!0),a.center=b.center,a.width=b.width,g.dispatchEvent(c,a)},document.addEventListener("mouseup",this.onmouseup,!1)},addListener:function(a,c){g.addEventListener(this.plot._Mx,a,c,!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},set_edge_highlight:function(a){a!==this.edge_highlight&&(this.edge_highlight=a,this.plot.redraw())},set_center:function(a){if(this.center=a,this.plot){a=this.plot._Mx;var c=document.createEvent("Event");c.initEvent("accordiontag",!0,!0),c.center=this.center,c.width=this.width,g.dispatchEvent(a,c),this.plot.redraw()}},set_width:function(a){if(this.width=a,this.plot){a=this.plot._Mx;var c=document.createEvent("Event");c.initEvent("accordiontag",!0,!0),c.center=this.center,c.width=this.width,g.dispatchEvent(a,c),this.plot.redraw()}},get_center:function(){return this.center},get_width:function(){return this.width},refresh:function(a){if(this.plot&&this.options.display&&this.center!==d&&this.width!==d){var c=this.plot._Mx,b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),a=g.real_to_pixel(c,this.center,this.center);var n=g.real_to_pixel(c,this.center-this.width/2,this.center-this.width/2),h=g.real_to_pixel(c,this.center+this.width/2,this.center+this.width/2);"vertical"===this.options.direction?(this.center_location=a.x,this.loc_1=Math.max(c.l,n.x),this.loc_2=Math.min(c.r,h.x)):"horizontal"===this.options.direction&&(this.center_location=a.y,this.loc_1=Math.max(c.t,h.y),this.loc_2=Math.min(c.b,n.y)),this.options.shade_area&&0<this.loc_2-this.loc_1&&(a=b.globalAlpha,b.globalAlpha=this.options.fill_style.opacity!==d?this.options.fill_style.opacity:.4,b.fillStyle=this.options.fill_style.fillStyle!==d?this.options.fill_style.fillStyle:c.hi,"vertical"===this.options.direction?b.fillRect(this.loc_1,c.t,this.loc_2-this.loc_1,c.b-c.t):"horizontal"===this.options.direction&&b.fillRect(c.l,this.loc_1,c.r-c.l,this.loc_2-this.loc_1),b.globalAlpha=a),(this.options.draw_edge_lines||this.edge_highlight||this.edge_dragging)&&(b.lineWidth=this.options.edge_line_style.lineWidth!==d?this.options.edge_line_style.lineWidth:1,b.lineCap=this.options.edge_line_style.lineCap!==d?this.options.edge_line_style.lineCap:"square",b.strokeStyle=this.options.edge_line_style.strokeStyle!==d?this.options.edge_line_style.strokeStyle:c.fg,(this.edge_dragging||this.edge_highlight)&&(b.lineWidth=Math.ceil(1.2*b.lineWidth)),"vertical"===this.options.direction?(b.beginPath(),b.moveTo(this.loc_1+.5,c.t),b.lineTo(this.loc_1+.5,c.b),b.stroke(),b.beginPath(),b.moveTo(this.loc_2+.5,c.t),b.lineTo(this.loc_2+.5,c.b),b.stroke()):"horizontal"===this.options.direction&&(b.beginPath(),b.moveTo(c.l,this.loc_1+.5),b.lineTo(c.r,this.loc_1+.5),b.stroke(),b.beginPath(),b.moveTo(c.l,this.loc_2+.5),b.lineTo(c.r,this.loc_2+.5),b.stroke())),this.options.draw_center_line&&(b.lineWidth=this.options.center_line_style.lineWidth!==d?this.options.center_line_style.lineWidth:1,b.lineCap=this.options.center_line_style.lineCap!==d?this.options.center_line_style.lineCap:"square",b.strokeStyle=this.options.center_line_style.strokeStyle!==d?this.options.center_line_style.strokeStyle:c.fg,(this.dragging||this.highlight)&&(b.lineWidth=Math.ceil(1.2*b.lineWidth)),"vertical"===this.options.direction?(b.beginPath(),b.moveTo(this.center_location+.5,c.t),b.lineTo(this.center_location+.5,c.b),b.stroke()):"horizontal"===this.options.direction&&(b.beginPath(),b.moveTo(c.l,this.center_location+.5),b.lineTo(c.r,this.center_location+.5),b.stroke()))}},dispose:function(){this.width=this.center_location=this.center=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(k,g,r,d){k.BoxesPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.boxes=[]},k.BoxesPlugin.prototype={init:function(a){this.plot=a},menu:function(){var a=function(a){return function(){a.options.display=!a.options.display,a.plot.redraw()}}(this),c=function(a){return function(){a.boxes=[],a.plot.redraw()}}(this);return{text:"Annotations...",menu:{title:"ANNOTATIONS",items:[{text:"Display",checked:this.options.display,style:"checkbox",handler:a},{text:"Clear All",handler:c}]}}},add_box:function(a){return this.boxes.push(a),this.plot.redraw(),this.boxes.length},refresh:function(a){if(this.options.display){var c=this.plot._Mx;a=a.getContext("2d");var b,d,h,e,f,l;a.save(),a.beginPath(),a.rect(c.l,c.t,c.r-c.l,c.b-c.t),a.clip();for(var k=0;k<this.boxes.length;k++)b=this.boxes[k],!0===b.absolute_placement?(d=b.x+c.l,h=b.y+c.t,e=b.w,f=b.h):(f=g.real_to_pixel(c,b.x,b.y),l=g.real_to_pixel(c,b.x+b.w,b.y+b.h),d=f.x,h=f.y,e=l.x-f.x,f=f.y-l.y),a.strokeStyle=b.strokeStyle||c.fg,a.lineWidth=b.lineWidth||1,1===a.lineWidth%2&&(d+=.5,h+=.5),a.strokeRect(d,h,e,f),b.text&&(a.save(),a.font=b.font||c.text_H+"px Courier New, monospace",a.globalAlpha=1,a.textAlign="end",a.fillStyle=a.strokeStyle,b.font&&(a.font=b.font),d-=c.text_w,h-=c.text_h/3,f=a.measureText(b.text).width,d-f<c.l&&(d+=e),a.fillText(b.text,d,h),a.restore());a.restore()}},dispose:function(){this.boxes=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),function(k,g,r,d){k.PlaybackControlsPlugin=function(a){this.options=a===d?{}:a,this.options.display===d&&(this.options.display=!0),this.options.size=this.options.size||25,this.options.lineWidth=this.options.lineWidth||2,this.state="paused",this.highlight=!1},k.PlaybackControlsPlugin.prototype={init:function(a){this.plot=a;var c=this,b=this.plot._Mx;this.onmousemove=function(a){b.warpbox||c.set_highlight(c.ismouseover(a.xpos,a.ypos)?!0:!1)},this.plot.addListener("mmove",this.onmousemove),this.onmousedown=function(a){b.warpbox||c.ismouseover(a.xpos,a.ypos)&&a.preventDefault()},this.plot.addListener("mdown",this.onmousedown),this.onmouseclick=function(a){!b.warpbox&&c.ismouseover(a.xpos,a.ypos)&&(c.toggle(),a.preventDefault())},this.plot.addListener("mclick",this.onmouseclick)},set_highlight:function(a){a!==this.highlight&&(this.highlight=a,this.plot.redraw())},toggle:function(a){if(a||(a="paused"===this.state?"playing":"paused"),a!==this.state&&this.plot){var c=this.plot._Mx,b=document.createEvent("Event");b.initEvent("playbackevt",!0,!0),b.state=a,g.dispatchEvent(c,b)&&(this.state=a),this.plot.redraw()}},addListener:function(a,c){g.addEventListener(this.plot._Mx,a,c,!1)},removeListener:function(a,c){g.removeEventListener(this.plot._Mx,a,c,!1)},ismouseover:function(a,c){var b=this.position();return Math.pow(a-b.x,2)+Math.pow(c-b.y,2)<Math.pow(this.options.size/2,2)},position:function(){if(this.options.position)return this.options.position;if(this.plot){var a=this.plot._Mx,c=this.options.size/2;return{x:a.l+c+this.options.lineWidth+1,y:a.t+c+this.options.lineWidth+1}}return{x:null,y:null}},refresh:function(a){var c,b,d;if(this.options.display){var h=this.plot._Mx,e=a.getContext("2d");e.lineWidth=this.options.lineWidth;var f=this.options.size/2;this.highlight&&(e.lineWidth+=2,f+=1);var g=this.position();if(e.beginPath(),e.arc(g.x,g.y,f-e.lineWidth,0,2*Math.PI,!0),e.closePath(),e.strokeStyle=this.options.strokeStyle||h.fg,e.stroke(),this.options.fillStyle&&(e.fillStyle=this.options.fillStyle,e.fill()),"paused"===this.state){var k;b=.8*f+(g.x-f),a=1.45*f+(g.x-f),k=.8*f+(g.x-f),d=.56*f+(g.y-f),c=f+(g.y-f),f=1.45*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.lineTo(k,f),e.closePath(),e.fillStyle=this.options.strokeStyle||h.fg,e.fill()}else e.lineCap="round",e.lineWidth=Math.floor(Math.min(1,this.options.size/8)),b=.8*f+(g.x-f),a=.8*f+(g.x-f),d=f/2+(g.y-f),c=1.5*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.closePath(),e.stroke(),b=f+f/5+(g.x-f),a=f+f/5+(g.x-f),d=f/2+(g.y-f),c=1.5*f+(g.y-f),e.beginPath(),e.moveTo(b,d),e.lineTo(a,c),e.closePath(),e.stroke();e.restore()}},dispose:function(){this.boxes=this.plot=d}}}(window.sigplot=window.sigplot||{},mx,m),angular.module("webSCA").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("views/device-managers.html",'<h2>Device Managers</h2><div class=container><div class=row><div class=col-md-3><div class="panel panel-default"><div class=panel-heading>Device Managers</div><ul class="list-group selection"><a ng-repeat="item in redhawk.deviceManagers" ng-click=setManager(item.id) ng-class="{\'active\': (setManager() == item.id) }" class=list-group-item><b>{{item.name}}</b></a> <a class=list-group-item ng-hide=redhawk.deviceManagers><i>No Device Managers found</i></a></ul><div class=panel-footer><div class="text-right text-muted"><small>{{redhawk.deviceManagers.length}} Device Managers</small></div></div></div></div><div class=col-md-9><div class="panel panel-default" ng-show=manager><div class=panel-heading><h3 class=panel-title>{{manager.name}}<status info=manager.status></status><small>{{manager.id}}</small><json-source json-data=manager></json-source></h3></div><div class=panel-body><div class=container-fluid><div class=row><div class=col-md-6><div class=row><div class=col-md-12><h4><span class="glyphicon glyphicon-tasks"></span> Devices</h4></div><div class=col-md-12><ul class=list-group><li ng-repeat="(label, device) in manager.devices" class=list-group-item><device id=device.id manager-id=manager.id domain-id=manager.domainId></device></li></ul></div></div></div><div class=col-md-6><properties info=manager.properties can-edit=false configure=configure(properties)></properties></div></div></div></div></div><div class="center-block text-center text-muted" ng-hide=manager><div class="panel panel-default"><div class=panel-body><h2><i class="icon-eye-close icon-3x"></i></h2><h3>No Device Manager Selected</h3><p>Try selecting one from the list on the left.</p></div></div></div></div></div></div>'),$templateCache.put("views/device.html",'<h2>Device Details</h2><div id=device class=container><div class=row><div class="col-md-10 col-md-offset-1"><div class="panel panel-default"><div class=panel-heading><h3><strong>{{device.name}}</strong><status info=device.status></status><div class="label label-default"><span ng-if=device.started>Started</span><span ng-if=!device.started>Stopped</span></div><small>{{device.id}}</small></h3></div><div class=panel-body><properties info=device.properties></properties></div></div></div></div></div>'),$templateCache.put("views/overview.html",'<h2>Overview</h2><div class=container><div class=row><div class="col-md-10 col-md-offset-1"><div class="panel panel-default"><div class=panel-heading><h3><strong>{{domain.name}}</strong><status info=domain.status></status><small>{{domain.id}}<json-source json-data=domain></json-source></small></h3></div><div class=panel-body><div class=container-fluid><div class=row><div class=col-md-12><div class=row><div class=col-md-6><div class="text-center overview-nav"><a href=#/waveforms><h1 class=text-info>{{domain.applications.length}}</h1><h3 class=number-header>Waveforms</h3></a></div></div><div class=col-md-6><div class="text-center overview-nav"><a href=#/deviceManagers><h1 class=text-info>{{domain.deviceManagers.length}}</h1><h3 class=number-header>Device Managers</h3></a></div></div></div></div></div><div class=row><div class=col-md-12><properties info=domain.properties can-edit=true configure=configure(properties)></properties></div></div></div></div></div></div></div></div>'),$templateCache.put("views/plot.html",'<div class=container><div class=row><div class=col-md-12><h2>{{sri.streamID}}</h2><dl class=dl-horizontal><dt>Waveform Id</dt><dd>{{waveformId}}</dd><dt>Component Id</dt><dd>{{componentId}}</dd><dt>Port Name</dt><dd>{{name}}</dd></dl></div></div><div class=row><div class=col-md-8><div class="well plot-container"><div id=plot></div><div id=raster></div></div></div><div class=col-md-4><div class="panel panel-default"><div class=panel-heading ng-click="showOptions = !showOptions"><span class=glyphicon ng-class="{\'glyphicon-chevron-down\': showOptions, \'glyphicon-chevron-right\': !showOptions}"></span> Plotting Options</div><div class=panel-body ng-class="{\'collapse\': !showOptions}"><form role=form class=form-horizontal><div class="checkbox col-sm-offset-2 col-sm-10"><label><input type=checkbox ng-model=useSRISettings value=1> Use SRI settings</label></div><div class=form-group ng-repeat="(key, value) in plotOverrides"><label for={{key}} class="col-sm-2 control-label">{{key}}</label><div class=col-sm-10><input ng-hide=useSRISettings type=number class="form-control input-sm" ng-change=updateCustomSettings() ng-model=customSettings[key] id={{key}} value="{{value}}"> <input ng-show=useSRISettings type=number class="form-control input-sm" ng-model=customSettings[key] id={{key}} disabled="disabled"></div></div></form></div></div><h4>SRI</h4><table class=table><thead><tr><th>Name</th><th>Value</th></tr></thead><tr ng-repeat="(name, item) in sri | orderBy:name"><td>{{name}}</td><td>{{item}}</td></tr></table></div></div><div class=row></div></div>'),$templateCache.put("views/preferences.html",'<h2>Preferences</h2><div class=container><div class=row><div class=container-fluid><div class=row><div class=col-md-6><div class="panel panel-primary"><div class=panel-heading><h4 class=panel-title>REDHAWK Hosts</h4></div><div class=panel-body><p>Use the following hosts for REDHAWK domain discovery:</p><ul class=list-group><li class=list-group-item ng-repeat="host in user.hosts">{{host}} <i class="pull-right icon-remove-sign" ng-click=remove_host($index)></i> <span ng-if=user.hoststatus[host] class="pull-right label label-danger" tooltip="{{user.hoststatus[host] && user.hoststatus[host].error}}">Error</span></li><div class="alert alert-info" ng-show=!user.hosts.length>Host list is empty</div></ul><form ng-submit=add_host(newhost)><div class=input-group><input class=form-control ng-model=newhost placeholder="Hostname/IP Address"><span class=input-group-btn><button class="btn btn-default" type=button ng-click=add_host(newhost)>Add</button></span></div></form><p></p><p></p>If a domain is missing in the domain selector, it could be caused by:<ul><li>DomainManager not running on host</li><li>The CORBA nameService is down</li><li>Network connectivity between the web server and the host</li><li>A firewall restricting ports (CORBA has issues with most firewalls)</li></ul></div></div></div></div></div></div></div>'),$templateCache.put("views/waveforms.html",'<h2>Waveforms</h2><div class=container><div class=row><div class=col-md-3><div class="panel panel-default"><div class=panel-heading><div class=row><div class=col-md-7><select ng-model=selectedWaveform ng-options="item for item in waveforms" class=form-control></select></div><div class=col-md-5><button class="btn btn-default btn-block" ng-click=launch(selectedWaveform) ng-class="{\'disabled\': !selectedWaveform}">Launch</button></div></div></div><ul class="list-group selection"><a ng-repeat="item in domain.applications" ng-click=setWaveform(item.id) ng-class="{\'active\': (setWaveform() == item.id) }" class=list-group-item><b>{{item.name}}</b></a> <a class=list-group-item ng-hide=domain.applications><i>No Waveforms Running</i></a></ul><div class=panel-footer><div class="text-right text-muted"><small>{{domain.applications.length}} Waveforms Running</small></div></div></div></div><div class=col-md-9><waveform ng-show=domain.applications.length id=currentWaveform domain-id=domain._restId></waveform><div class="center-block text-center text-muted" ng-hide=domain.applications.length><div class="panel panel-default"><div class=panel-body><h2><i class="icon-eye-close icon-3x"></i></h2><h3>No Waveform Selected</h3><p>Try selecting one from the list on the left or launching a new one.</p></div></div></div></div></div></div>')}]),angular.module("webSCA").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("components/redhawk/templates/component.html",'<div class=container-fluid><div class=row><div class=col-md-8><h6 class=list-group-item-heading><strong>{{component.name}}</strong><br><small>{{component.id}}</small></h6><div><start-status info=component.started></start-status></div></div><div class=col-md-4><div class=btn-group><div class=btn-group><button class="btn btn-default btn-sm dropdown-toggle" data-toggle=dropdown><span class="glyphicon glyphicon-bullhorn"></span> <span class=caret></span></button><ul class=dropdown-menu role=menu><li ng-repeat="port in component.ports"><a ng-if=port.canPlot ng-class="{\'disabled\': !port.plotType}" href=#/plot/waveform/{{component.waveform.id}}/component/{{component.id}}/port/{{port.name}}/{{port.plotType}}>{{port.name}}</a></li></ul></div><div class=btn-group><properties info=component.properties can-edit=true configure=configure(properties) compact=true></properties></div></div></div></div></div>'),$templateCache.put("components/redhawk/templates/device.html","<div class=conatainer-fluid><div class=row><div class=col-md-9><h6><a href=#/manager/{{managerId}}/device/{{id}}><strong>{{device.name}}</strong></a><br><small>{{device.id}}</small></h6></div><div class=col-md-3><start-status class=pull-right info=device.started></start-status></div></div></div>"),$templateCache.put("components/redhawk/templates/file-system.html",'<div class="panel panel-default"><div class=panel-heading><h5 class=panel-title><strong><span class="glyphicon glyphicon-hdd"></span> {{filesystem.cwd || \'/\'}}</strong><json-source json-data=filesystem></json-source></h5></div><div class=list-group><a class=list-group-item ng-click=loadFileSystem(filesystem.parent)><span class="glyphicon glyphicon-circle-arrow-left"></span> Up</a><div ng-repeat="item in filesystem.data.children track by $index"><a ng-if=item.directory class=list-group-item ng-click="loadFileSystem(filesystem.cwd+\'/\'+item.name)"><span class="glyphicon glyphicon-folder-open"></span> <small>{{item.name}}</small></a><div ng-if=!item.directory class=dropdown><a class=list-group-item id=dropdownMenu-{{$id}} data-toggle=dropdown><span class="glyphicon glyphicon-file"></span> <small>{{item.name}}</small> <span class=caret></span></a><ul class=dropdown-menu role=menu aria-labelledby=dropdownMenu-{{$id}}><li role=presentation ng-class="{\'disabled\': !item.canView}"><a role=menuitem ng-click="fileViewer(filesystem.cwd+\'/\'+item.name)"><i class=icon-code></i> File Viewer</a></li><li role=presentation class=divider></li><li role=presentation><a role=menuitem tabindex=-1 href="{{fileUrl(filesystem.cwd+\'/\'+item.name)}}"><span class="glyphicon glyphicon-download"></span> Download</a></li><li role=presentation ng-class="{\'disabled\': !item.canLaunch}"><a role=menuitem tabindex=-1 ng-click="launchWaveform(filesystem.cwd+\'/\'+item.name, item.launchName+\'-\'+$id)"><span class="fa fa-paper-plane"></span> Launch</a></li></ul></div></div></div></div>'),$templateCache.put("components/redhawk/templates/file-viewer.html",'<div class=modal-header><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title><span class="glyphicon glyphicon-file"></span> File Viewer <small>{{path}}</small></h4></div><div class=modal-body><div hljs include=path></div></div><div class=modal-footer><a class="btn btn-link" href={{path}}><span class="glyphicon glyphicon-download"></span> Download</a> <button type=button class="btn btn-default" ng-click=close()>Close</button></div>'),$templateCache.put("components/redhawk/templates/properties.html",'<div ng-if=!compact><h4 ng-if="title === undefined ? true : title"><i class=icon-gears></i> Properties<json-source json-data=properties></json-source></h4><div class=container-fluid onload=this.tooltip()><form role=form class=form-inline ng-submit=submit()><table class="table table-striped table-condensed"><tr><th>Label</th><th>Value</th></tr><tr ng-repeat="prop in properties | orderBy: \'name\'" ng-class="{\'text-muted\': !prop.canEdit}"><td data-toggle=tooltip data-placement=auto title={{prop.description.trim()}}><span>{{prop.name}} <span class=name ng-if=!prop.name>{{prop.id}}</span> <span class="label label-default" ng-if="prop.scaType == \'simpleSeq\'">Sequence</span> <span class="label label-default" ng-if="prop.scaType == \'struct\'">Struct</span> <span class="label label-default" ng-if="prop.scaType == \'structSeq\'">Struct Sequence</span></span></td><td><div ng-if="prop.canEdit && edit" class=form-group><select ng-if="prop.type == \'boolean\'" class=form-control ng-model=form[prop.id] ng-options="o.value as o.name for o in booleanSelectOptions"></select><select ng-if=prop.enumerations class=form-control ng-model=form[prop.id] ng-options="value as label for (label, value) in prop.enumerations"></select><input ng-if="prop.type != \'boolean\' && !prop.enumerations" class=form-control ng-model=form[prop.id] value="{{prop.value}}"> <span ng-if=prop.definition.units>{{prop.definition.units}}</span></div><div ng-if="!prop.canEdit || !edit"><span class=value ng-if="prop.scaType == \'simple\'">{{prop.value}}</span> <span ng-if="prop.scaType == \'simpleSeq\'" ng-repeat="item in prop.value track by $index">{{item}}</span> <span ng-if="prop.scaType == \'sequence\'"><property info=prop></property></span><div ng-if="prop.scaType == \'struct\'"><property info=prop></property></div><div ng-if="prop.scaType == \'structSeq\'"><property info=prop></property></div><span ng-if=prop.definition.units>{{prop.definition.units}}</span></div></td></tr><tr ng-if=canEdit><td colspan=2><button type=submit class="btn btn-default" ng-if=edit>Configure</button> <a class="btn btn-link" ng-click=toggleEdit()><i ng-class="{\'icon-unlock\': edit, \'icon-lock\': !edit}"></i></a></td></tr></table></form></div></div><span ng-if=compact><button class="btn btn-sm btn-default" data-toggle=modal data-target=#properties-{{$id}}><i class=icon-gears></i></button><div class="modal fade" id=properties-{{$id}} tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal aria-hidden=true>&times;</button><h4 class=modal-title><i class=icon-gears></i> Properties <small><json-source json-data=properties></json-source></small></h4></div><div class=modal-body><properties info=properties can-edit=canEdit configure="configure({properties: properties})" title=false></properties></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>Close</button></div></div></div></div></span>'),$templateCache.put("components/redhawk/templates/property.html",'<div ng-if="prop.scaType == \'simple\'" class="well well-sm"><span class=name>{{prop.name}}:</span> <span class=name ng-if=!prop.name>{{prop.id}} (id)</span> <span class=value ng-class="{muted: !prop.canEdit}">{{prop.value}}</span> <span ng-if="[prop.scaType == \'simpleSeq\']" ng-repeat="item in prop.value track by $index">{{item}}</span></div><div ng-if="prop.scaType == \'simpleSeq\'" class="well well-sm"><span class=name>{{prop.name}}:</span> <span class=name ng-if=!prop.name>{{prop.id}} (id)</span> <span class=value ng-class="{\'text-muted\': !prop.canEdit}">{{prop.value}}</span> <span ng-if="prop.scaType == \'simpleSeq\'" ng-repeat="item in prop.value track by $index">{{item}}</span></div><div ng-if="prop.scaType == \'struct\'"><dl class=dl-horizontal><span ng-repeat="(k,v) in prop.value"><dt>{{k}}</dt><dd>{{v}}</dd></span></dl></div><div ng-if="prop.scaType == \'structSeq\'"><dl class=dl-horizontal ng-repeat="struct in prop.value"><span ng-repeat="(k,v) in struct"><dt>{{k}}</dt><dd>{{v}}</dd></span></dl></div>'),$templateCache.put("components/redhawk/templates/status.html",'<span ng-switch on=status.severity><span ng-switch-when=OK><span class="label label-success">{{status.severity}}</span></span> <span ng-switch-when=WARNING><span class="label label-warning">{{status.severity}}</span></span> <span ng-switch-when=ERROR><span class="label label-danger">{{status.severity}}</span></span> <span ng-switch-default><span class="label label-default">{{status.severity}}</span></span></span>'),$templateCache.put("components/redhawk/templates/waveform.html",'<div class="panel panel-default"><div class=panel-heading><h3 class=panel-title><b>{{waveform.name}}</b><status info=waveform.status></status><small>{{waveform.id}}</small> <small><json-source json-data=waveform></json-source></small></h3></div><div class=panel-body><div class=container-fluid><div class=row><div class="col-md-6 well"><div class=row><div class=col-md-8><h4><i class=icon-power-off></i> Status</h4></div><div class=col-md-4><start-status class=pull-right info=waveform.started></start-status></div><div class=col-md-12><div class=btn-toolbar><div class=btn-group><button class="btn btn-default btn-lg" ng-if=!waveform.started ng-click=waveform.start()><span class="glyphicon glyphicon-play"></span></button> <button class="btn btn-default btn-lg" ng-if=waveform.started ng-click=waveform.stop()><span class="glyphicon glyphicon-stop"></span></button> <button class="btn btn-default btn-lg" ng-click=waveform.release()><span class="glyphicon glyphicon-eject"></span></button></div></div></div></div><div class=row><div class=col-md-12><div ng-repeat="msg in messages" class=alert ng-class="{\'alert-danger\': msg.is_warning, \'alert-info\': !msg.is_warning}"><small>{{msg.text}}</small></div></div></div><div class=row><div class=col-md-12><div><h4><span class="glyphicon glyphicon-briefcase"></span> Components</h4><ul class=list-group><li ng-repeat="comp in waveform.components" class=list-group-item><component id=comp.id waveform-id=waveform.id domain-id=domainId></component></li></ul></div><div><h4><span class="glyphicon glyphicon-bullhorn"></span> Ports</h4><ul class=list-group><li ng-repeat="port in waveform.ports" class=list-group-item><a ng-if=port.canPlot href=#plot/waveform/{{waveform.id}}/port/{{port.name}}/{{port.plotType}}>{{port.name}}</a></li></ul></div></div></div></div><div class=col-md-6><div><properties info=waveform.properties can-edit=true configure=configure(properties)></properties></div></div></div></div></div></div>'),$templateCache.put("components/websca/templates/add-domain.html",'<div class=modal-content><div class=modal-header><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title>Connect to Domain</h4></div><div class=modal-body><form class=form-horizontal role=form><div class=form-group><label for=id class="col-sm-2 control-label">Id</label><div class=col-sm-10><input ng-model=id id=id class=form-control></div></div><div class=form-group><label for=name class="col-sm-2 control-label">Name</label><div class=col-sm-10><input ng-model=name id=name class=form-control></div></div><div class=form-group><label for=uri class="col-sm-2 control-label">URI</label><div class=col-sm-10><input ng-model=uri id=uri class=form-control></div></div></form></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click="add(id, name, uri)">Add</button> <button type=button class="btn btn-default" ng-click=close()>Close</button></div></div>'),$templateCache.put("components/websca/templates/json-source.html",'<div class=modal-content><div class=modal-header><button type=button class=close ng-click=close()>&times;</button><h4 class=modal-title>JSON</h4></div><div class=modal-body><div hljs source="json | json" language=json></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=close()>Close</button></div></div>')
}]);